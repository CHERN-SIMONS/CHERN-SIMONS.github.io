<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Learning Notes">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Learning Notes">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learning Notes">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Learning Notes</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Learning Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/23/python_education/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/23/python_education/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-23T12:16:04+08:00">
                2019-03-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>1.</h1>
<h1>2. 程序文件结构</h1>
<h1>3. 虚拟环境搭建</h1>
<h1>4. python编程语言基础技术框架</h1>
<h2>对象引用与变量</h2>
<p>python将<strong>所有数据</strong>存为内存对象；而<strong>变量</strong>是指向内存对象的引用；变量名本身也是对象，也存在内存中，只是一个指针指向于数据。</p>
<p>例如</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">"Tom"</span></span><br><span class="line">name = <span class="string">"Jerry"</span></span><br></pre></td></tr></table></figure></p>
<p>只是将name指向Tom，第二个就是重新将指针指向Jerry，但是Tom此时没有被销毁，还在内存中。</p>
<p><strong>动态类型</strong>：在任何时候，只要需要，某个对象引用都可以重新引用一个不同的对象（可以是不同的数据类型）；内置函数**type()**返回给定数据的数据类型。</p>
<p>因而，在Python中，<strong>=</strong>  就是将变量名与内存中的某对象绑定：如果对象事先存在，就直接绑定，否则由 &quot;=“ 直接创建引用的对象。</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">"Tom"</span></span><br><span class="line">print(id(name))</span><br><span class="line">print(name)</span><br><span class="line"></span><br><span class="line">test = <span class="string">"Tom"</span></span><br><span class="line">print(id(test))</span><br></pre></td></tr></table></figure></p>
<p>最后连个地址都是同一个，说明Tom已经存在内存中了，我们直接引用它。</p>
<h2>变量</h2>
<p>保留字：系统本身的命令</p>
<p>命令惯例：1. 单一下划线 _x 的变量名不会被 from module import * 导入</p>
<ol start="2">
<li>前后有下划线的变量 _<em>x</em>_ 是系统定义的变量名</li>
<li>一两个下划线开头，但是结尾没有下划线的变量名 __x 是类的本地变量</li>
<li>交互模式下，变量名 _ 用于保留最后表达式的结果，类似于mathematica中的%。</li>
</ol>
<p>注意：变量名没有类型，对象才有。</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="number">3.14</span></span><br><span class="line">print(type(name))</span><br><span class="line"></span><br><span class="line">name = <span class="string">"Tom"</span></span><br><span class="line">print(type(name))</span><br></pre></td></tr></table></figure></p>
<p>最后输出结果本别是浮点类型和字符串类型，所以name只是一个名字，只有对象才有。</p>
<h2>组合数据类型</h2>
<p>数据结构：通过某种方式（例如对元素进行编号）组织在一起的数据的集合</p>
<p>Python常用的组合数据类型：</p>
<ol>
<li>序列类型：列表 &quot;[]&quot;，元祖 &quot;()&quot;，字符串</li>
<li>集合类型：集合</li>
<li>映射类型：字典 {}</li>
</ol>
<p>字符串也可以切片处理，和列表很像。字典，列表都是可变对象；而元祖不可变。</p>
<p>可以用函数 **len() ** 获取元素个数。</p>
<p>注意：1. python 中，组合数据类型也是对象，所以可以嵌套，例如[&quot;hello&quot;,&quot;world&quot;,[1,2,3]]</p>
<ol start="2">
<li>实质上，列表和元祖并不真正存贮数据，而是<strong>存放对象引用</strong>。</li>
<li>对象可以具有其可以被调用的特定方法。</li>
</ol>
<h2>控制流语句</h2>
<p>控制流语句是过程式编程语言的比本控制机制。</p>
<p>python常见的控制流语句：</p>
<ol>
<li>if</li>
<li>while</li>
<li>for … in</li>
<li>try</li>
</ol>
<p>其中try是异常处理。</p>
<h2>算术操作符</h2>
<h2>输入/输出</h2>
<p>input()</p>
<p>print()</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"String %format1 %format2 ……"</span>, %(variable1,variable2,……))</span><br></pre></td></tr></table></figure></p>
<p>其中的format可以是各种类型的写法</p>
<ol>
<li>d,i 十进制整数或者长整数</li>
<li>u 无符号整数或长整数</li>
<li>o 八进制整数或者长整数</li>
<li>x 十六进制整数或者长整数</li>
<li>X 十六进制整数(大写字母)</li>
<li>f 浮点数</li>
<li>e 浮点数，如 2.34878e$\pm$7374</li>
<li>E 浮点数，如2.34878E$\pm$7374</li>
<li>g,G 指数小于-4或者更高精度时使用%e或者%E，否则使用%f，这是一个自动化处理浮点型格式</li>
<li>s 字符串或者任意对象。格式化代码使用str() 生成字符串</li>
<li>r 同repr() 生成的字符串</li>
<li>c 单个字符</li>
<li>% 字面量%</li>
</ol>
<p>除此之外，还能对输出类型给限定</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%[(name)][flag][width][.precision]typecode</span><br></pre></td></tr></table></figure></p>
<p>flag : &quot;-&quot; 左对齐，默认又对齐，&quot;+&quot; 带上数值符号， &quot;0&quot; 零填充</p>
<p>width：制定最小宽度的数字，用多大宽度显示字符串</p>
<p>[.precision]：精度，例如&amp;10f，就是总小数点后10位</p>
<p>name是字典的索引，typecode就是要输出的类型，可以辅助做类型转换，例如</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">'x'</span>:<span class="number">21</span>,<span class="string">'y'</span>:<span class="number">27.7482</span>,<span class="string">'z'</span>:<span class="number">65</span>&#125;</span><br><span class="line">print(<span class="string">"we= %(x)-10d %(y)0.3g"</span> %d)</span><br></pre></td></tr></table></figure></p>
<h2>函数的创建与调用</h2>
<p>函数是实现模块化编程的基本组件。</p>
<p>python使用def定义函数；函数可以<strong>参数化</strong>，通过传递不同的参数来调用</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">funct</span><span class="params">(name)</span>:</span></span><br><span class="line">  print(name)</span><br></pre></td></tr></table></figure></p>
<p>每个python函数都有一个返回值，默认为None，也可以使用&quot;return value&quot;明确定义返回值</p>
<p>def语句会创建一个函数对象，并同时创建一个指向函数的对象引用：</p>
<ol>
<li>函数也是对象，可以存储在组合数据类型中，也可以作为参数传递给其他函数</li>
<li>**callable() ** 可用于测试函数是否可调用</li>
</ol>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">funct</span><span class="params">(name)</span>:</span></span><br><span class="line">  print(name)</span><br><span class="line">callable(funct)</span><br></pre></td></tr></table></figure></p>
<p>内置函数：<strong>range()  dir()  id() type() dir()  help() len() callable()</strong> 等等可以直接使用</p>
<p>range()生成序列</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">range(<span class="number">2</span>,<span class="number">11</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<p>可以生成从2到11的偶数。</p>
<p>python标准库拥有众多内置模块，这些模块拥有大量函数：</p>
<ol>
<li>
<p>python模块实际上就是包含python代码的.py文件，其拥有自定义的函数与类及变量等</p>
</li>
<li>
<p>导入模块使用import语句进行，后跟模块名称（不能指定模块文件名的后缀,py）</p>
</li>
<li>
<p>导入一个模块后，可以访问其内部包含的任意函数、类及变量</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">x = random.choice([<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>])</span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure></p>
</li>
</ol>
<h1>5. Python编程风格</h1>
<p>注释：#</p>
<p>续行： \ ； &quot;&quot;&quot; &quot;&quot;&quot; 为闭合操作符，单一语句跨多行</p>
<p>注意缩进相同的代码块表示同一等级</p>
<p>若用if, while这些开头，那么最后一定是冒号</p>
<p>模块： 每一个python脚本文件都可以被当成是一个模块；模块里的代码可以是一段直接执行的脚本，也可以是一些类似库函数的代码，从而可由别的模块执行导入(import)。</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mod</span><br><span class="line">name = <span class="string">"123"</span></span><br><span class="line">mod.print(name)</span><br></pre></td></tr></table></figure></p>
<p>调用方法需要用点。</p>
<p>整体语法格式</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/env python  #起始行</span></span><br><span class="line"><span class="string">"this is a test module"</span>  <span class="comment">#跨行用三引号，模块文档</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os <span class="comment">#模块导入</span></span><br><span class="line"></span><br><span class="line">debug = <span class="keyword">True</span>  <span class="comment">#全局变量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooClass</span> <span class="params">(object)</span>:</span>					<span class="comment">#类定义</span></span><br><span class="line">  <span class="string">"Foo class"</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="string">"test function"</span></span><br><span class="line">  foo = FooClass()							<span class="comment">#实例化</span></span><br><span class="line">  <span class="keyword">if</span> debug:</span><br><span class="line">    print(<span class="string">'ran test()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:			<span class="comment">#主程序</span></span><br><span class="line">  test()</span><br></pre></td></tr></table></figure></p>
<p>主程序：无论当前模块是被别的模块都如还是作为脚本直接执行，都会执行这部分代码</p>
<p>注意：所有模块都有能力执行代码</p>
<ol>
<li>最高级别的python语句(没有缩进的)在模块被导入时就会执行，无论是否真的需要执行</li>
<li>妥当的做法：除了那些真正需要执行的代码之外，所有的功能代码都通过函数建立，因此仅仅才主程序模块中编写大量的顶级可执行代码；用于被导入的模块只应该存在较少的顶级执行代码</li>
</ol>
<p>每个模块都有一个名为_<em>name</em>_ 的内置变量，此变量值会更具调用次模块的方式发生变化：</p>
<ol>
<li>如果此文件被作为模块导入，则__name__的值为模块名称</li>
<li>如果此文件被直接执行，则 _<em>name</em>_ 的值  ___ name__</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/13/Research-Records20190113/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/13/Research-Records20190113/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-13T07:45:29+08:00">
                2019-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>Research on 13/3/2019</h1>
<p>​	We could make a ephemeris for Earth and Mercury in terms of
$$
\begin{align}
	\ddot{\vec{r}}<em>{Mercury} = &amp; -\frac{GM}{r^2}\vec{n}+\vec{a}</em>{3-body}+\vec{a}<em>{PPN}+\vec{a}</em>{\eta_{DM}}\
	\ddot{\vec{R}}<em>{Earth} = &amp; -\frac{Gm}{R^2}\vec{N}+\vec{A}</em>{3-body}+\vec{A}<em>{PPN}+\vec{a}</em>{\eta_{DM}}
\end{align}
$$
which implies that the relative acceleration is  irrelevant to fifth interaction.
$$
\begin{align}
	\ddot{\vec{D}} = -\frac{GM}{r^2}\vec{n}+\frac{Gm}{R^2}\vec{N}+\vec{a}<em>{3-body}-\vec{A}</em>{3-body}+\vec{a}<em>{PPN}-\vec{A}</em>{PPN}
\end{align}
$$
Actually according to  osculationg orbit method (Will), the 5 integral constants $p,e,\iota,\Omega,\omega$ are varied with time (exact) or true anomaly (first-order approximation)
$$
\begin{align}
	\frac{dp}{dt} = &amp; 2 \sqrt{\frac{p^3}{Gm}} \frac{1}{1+e\cos f}\mathcal{S}\
	\frac{de}{dt} = &amp; \sqrt{\frac{p}{Gm}}\left[ \sin f ~ \mathcal{R}+ \frac{2\cos f+e(1+\cos^2 f)}{1+e\cos f}\mathcal{S} \right]\
	\frac{d\iota}{dt} = &amp; \sqrt{\frac{p}{Gm}}\frac{\cos(\omega+f)}{1+e\cos f}\mathcal{W}\
	\sin\iota \frac{d\Omega}{dt} = &amp; \sqrt{\frac{p}{Gm}}\frac{\sin(\omega+f)}{1+e\cos f}\mathcal{W}\
	\frac{d\omega}{dt} = &amp; \frac{1}{e}\sqrt{\frac{p}{Gm}}\left[ -\cos f~\mathcal{R} + \frac{2+e\cos f}{1+e\cos f}\sin f~\mathcal{S} -e\cot\iota \frac{\sin(\omega+f)}{1+e\cos f}\mathcal{W} \right] \
	\frac{df}{dt} = &amp; \sqrt{\frac{Gm}{p^3}}(1+e\cos f)^2 + \frac{1}{e}\sqrt{\frac{p}{Gm}}\left[ \cos f\mathcal{R} - \frac{2+e\cos f}{1+e\cos f}\sin f\mathcal{S} \right]
\end{align}
$$
or
$$
\begin{align}
	\frac{dp}{df}\simeq &amp; \frac{2p^2}{Gm}\frac{1}{(1+e\cos f)^3}\mathcal{S} \
	\frac{de}{df}\simeq &amp;\frac{p^2}{Gm}\left[ \frac{\sin f}{(1+e\cos f)^2}\mathcal{R} + \frac{2\cos f+e(1+\cos^2 f)}{(1+e\cos f)^3}\mathcal{S} \right] \
	\frac{d\iota}{df}\simeq &amp; \frac{p^2}{Gm}\frac{\cos(\omega+f)}{Gm(1+e\cos f)^3}\mathcal{W} \
	\sin \iota \frac{d\Omega}{df}\simeq &amp; \frac{p^2}{Gm}\frac{\sin(\omega+f)}{(1+e\cos f)^3}\mathcal{W} \
	\frac{d\omega}{df}\simeq &amp; \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} -e\cot\iota \frac{\sin(\omega+f)}{(1+e\cos f)^3}\mathcal{W} \bigg]\
\end{align}
$$
while the other physical quantities such as $r$, $A$  (the Runge-Lenz vector), $\dot{r}​$ are all time equal to previous expressions
$$
\begin{align}
	A = &amp; e(t)\
	h = &amp; \sqrt{Gmp(t)} \
	r = &amp; \frac{p(t)}{1+e(t)\cos f(t)}\
	\dot{r} = &amp; \sqrt{\frac{Gm}{p(t)}}e(t)\sin f(t)
\end{align}
$$
a listing of equations of integral constants that govern the behavior of the osculating orbital elements. To these we can add
$$
\begin{align}
	\frac{da}{dt} = &amp; 2\sqrt{\frac{a^3}{Gm}}(1-e^2)^{-1/2}\left[ e\sin f~\mathcal{R}+(1+e\cos f)\mathcal{S} \right],.
\end{align}
$$
Therefore the integral constants are now
$$
\begin{align}
	p(f) = &amp; p+\Delta p\
	e(f) = &amp; e+ \Delta e\
	\iota(f) = &amp; \iota + \Delta l\
	\Omega(f) = &amp; \Omega+\Delta \Omega\
	\omega(f) = &amp; \omega+\Delta\omega\
\end{align}
$$
Then the coordinates projecting into $(X,Y,Z)$ are
$$
\begin{align}
	r^X = &amp; r\left[\cos\Omega\cos(\omega+f)-\cos\iota\sin\Omega\sin(\omega+f) \right]\
	r^Y = &amp; r\left[\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f) \right]\
	r^Z = &amp; r \sin\iota \sin(\omega+f)
\end{align}
$$
In addition, variable from $f$ to $t$ , the differential equation is
$$
\begin{align}
	\frac{df}{dt} = &amp; \sqrt{\frac{Gm}{p^3}}(1+e\cos f)^2 + \frac{1}{e}\sqrt{\frac{p}{Gm}}\left[ \cos f ~ \mathcal{R} - \frac{2+e\cos f}{1+e\cos f}\sin f ~ \mathcal{S} \right]
\end{align}
$$
The solution to $f$ without perturbation is
$$
\begin{align}
	t-T = &amp; \sqrt{\frac{a^3}{Gm}}\left{ 2\arctan\left[ \sqrt{\frac{1-e}{1+e}}\tan \frac{f}{2} \right] - \frac{e\sqrt{1-e^2}\sin f}{1+e\cos f} \right}
\end{align}
$$
where $ p  = a (1-e^2)$.  We can numerically solve $f(t)$ and substitute $f$ into $r,\Omega,\omega$.</p>
<p>Finally for two planets, the distance between them is
$$
\begin{align}
	D(t) = \sqrt{(r^X_1-r_2^X)^2+(r^Y_1-r^Y_2)^2+(r^Z_1-r^Z_2)^2 }
\end{align}
$$</p>
<h1>14/3/2019</h1>
<p>Perturbate with $\iota = 0$. From $\sin\iota \sin \omega = \vec{e}<em>x\cdot \vec{e}</em>{Z} = \frac{\vec{A}\cdot \vec{e}_Z}{e}$, one can differential it
$$
\begin{align}
	\cos\iota \sin\omega \frac{d\iota}{dt}+\cos\omega\sin\iota \frac{d\omega}{dt} = \frac{d\vec{e}_x}{dt}\cdot \vec{e}_Z
\end{align}
$$
After an algebraic calculation, it becomes
$$
\begin{align}
	\cos\omega\sin\iota \frac{d\omega}{dt} = \frac{1}{e}\sqrt{\frac{Gm}{p}}\left[ -\cos f~\mathcal{R} +\frac{2+e\cos f}{1+e\cos f}\mathcal{S} \right]\sin\iota\cos\omega - \sqrt{\frac{Gm}{p}}\frac{\sin(\omega+f)}{1+e\cos f}\cos\omega \cos\iota~\mathcal{W}
\end{align}
$$
Here we see that, when $\iota \rightarrow 0$, $\sin\omega \frac{d\iota}{dt} = \frac{d\vec{e}_x}{dt}\cdot \vec{e}_Z$, there is no solution involved $d\omega/dt$.</p>
<p>We should replace the last term by ascending node $\Omega$ derivative with respect to time
$$
\begin{align}
	\frac{d\omega}{dt} = -\cos\iota \frac{d\Omega}{dt}+ \frac{1}{e}\sqrt{\frac{Gm}{p}}\left[ -\cos f~\mathcal{R} +\frac{2+e\cos f}{1+e\cos f}\mathcal{S} \right]
\end{align}
$$
when $\iota \rightarrow 0$ , we have
$$
\begin{align}
	\frac{d\bar{\omega}}{dt}= \frac{d(\omega+\Omega)}{dt} = \frac{1}{e}\sqrt{\frac{Gm}{p}}\left[ -\cos f~\mathcal{R} +\frac{2+e\cos f}{1+e\cos f}\mathcal{S} \right]
\end{align}
$$
And $\mathcal{W}\rightarrow 0$ , we have $\sin\iota \frac{d\Omega}{dt}\rightarrow 0$ . If $\iota\rightarrow 0$ holds, then $\frac{d\Omega}{dt}$ varies, but the perihelion condition $\bar{\omega}$ is constraint above.</p>
<h1>15/3/2019</h1>
<p><strong>Nothing important here</strong>Specifically for co-plane motion $\Omega = 0,~\iota = 0$, it reduces 3 integral constant $p,e,\omega$ with
$$
\begin{align}
\frac{dp}{df}\simeq &amp; \frac{2p^2}{Gm}\frac{1}{(1+e\cos f)^3}\mathcal{S} \
	\frac{de}{df}\simeq &amp;\frac{p^2}{Gm}\left[ \frac{\sin f}{(1+e\cos f)^2}\mathcal{R} + \frac{2\cos f+e(1+\cos^2 f)}{(1+e\cos f)^3}\mathcal{S} \right] \
	\frac{d\omega}{df}\simeq &amp; \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} \bigg]
\end{align}
$$
Based on a parallel force perturbation
$$
\begin{align}
	\mathcal{R} = &amp; b \cos(\omega+f)\
	\mathcal{S} = &amp; - b \sin(\omega+f)
\end{align}
$$
the components of displacement vector are
$$
\begin{align}
	r^X = &amp; r \cos(\omega+f)\
	r^Y = &amp; r\sin(\omega+f)\
	r^Z = &amp; 0.
\end{align}
$$</p>
<h1>18/3/2019</h1>
<p>de Sitter precession: for example, to the Earth-Moon-Sun system, after Earth traveling one circle around the Sun, Moon's orbit plane circulating the Earth will rotate around the axis of angular momentum of the Moon's orbit plane. In GR, we can state that a spinning object with certain angular momentum travels in a stationary/static gravitational field, then the spinning axis will change secularly orbiting one circle. This geodesic deviation is generated by spinning.</p>
<p>In addition the spin of planet rotates around the constant total angular momentum vector with a constant angular velocity.</p>
<p>In Will's paper, actually, the advance could seperate into 2 parts
$$
\begin{align}
	\bar{\omega} = \omega+\Omega
\end{align}
$$
where $\Omega$ is the ascending node and $\omega$ is the ordinary perihelion. The so-called de Sitter pression is the last term (as inclination $\iota$ vanishes)
$$
\begin{align}
	\frac{d\Omega}{dt} = &amp; 4\pi \sum_A \frac{Gm_A}{c^2a}\left(\frac{a}{R_A} \right)^{5/2}
\end{align}
$$
It is a constant.</p>
<h1>19/3/2019</h1>
<p>Thibault Damour and Gerhard Schafer states that a new measurable quantity $x\equiv a \sin\iota$ . Then the derivative with respect to time is
$$
\begin{align}
	\frac{dx}{dt} = \frac{d(a\sin\iota)}{dt} = &amp; 2\sin\iota \sqrt{\frac{a^3}{GM}}(1-e^2)^{-1/2}[e\sin f~\mathcal{R}+(1+e\cos f)\mathcal{S}]\
	&amp;+\cos\iota\sqrt{\frac{a^3}{GM}}(1-e^2)^{1/2}\frac{\cos(\omega+f)}{1+e\cos f}\mathcal{W}
\end{align}
$$
For perturbated force
$$
\begin{align}
\vec{f} = a_5\cos\Phi ~\vec{e}_X + a_5\sin\Phi ~\vec{e}_Y
\end{align}
$$
gives rise to
$$
\begin{align}
	\mathcal{R} = &amp; \cos(\omega+f)\cos(\Omega-\Phi)-\cos\iota\sin(\omega+f)\sin(\Omega-\Phi)\
	\mathcal{S} = &amp; -\sin(\omega+f)\cos(\Omega-\Phi)+\cos\iota\cos(\omega+f)\sin(\Phi-\Omega)\
	\mathcal{W} = &amp; \sin\iota\sin(\Omega-\Phi)
\end{align}
$$</p>
<p>$$
\begin{align}
\frac{dx}{df} \simeq \frac{a^3(1-e^2)a_5}{GM} \bigg{ 2\sin\iota \left[ \frac{\sin f}{(1+e\cos f)^2}\mathcal{R} + \frac{1}{1+e\cos f}\mathcal{S} \right] +(1-e^2)\frac{\cos\iota \cos(\omega+f)}{(1+e\cos f)^3}\mathcal{W} \bigg}
\end{align}
$$</p>
<p>The $x$ is changed for one orbit
$$
\begin{align}
	\Delta x = &amp; \frac{4a_5 \pi  a^3  (1-e) \sqrt{1-e^2} \left(\sqrt{1-e^2}-1\right) \sin \iota \left[\sin \omega ~ \cos(\Phi -\Omega )-\cos \iota \cos \omega  \sin (\Phi -\Omega )\right]}{e^2 G M}\
	&amp;+ \frac{3 \pi a_5  a^3 e \sin\iota \cos\iota \cos\omega \sin (\Phi -\Omega )}{\sqrt{1-e^2} G M}\
	=&amp; \frac{\pi a_5 a^3\sin\iota}{GM} \bigg{\frac{4 (1-e) \sqrt{1-e^2} \left(\sqrt{1-e^2}-1\right) \left[\sin \omega ~ \cos(\Phi -\Omega )-\cos \iota \cos \omega  \sin (\Phi -\Omega )\right]}{e^2 }\
&amp;~~~~~~~~~~~~~~~~~~~~~~+ \frac{3 e \cos\iota \cos\omega \sin (\Phi -\Omega )}{\sqrt{1-e^2}}  \bigg}
\end{align}
$$
Substituting the Mercury data and dark matter, we reach per orbit
$$
\begin{align}
	\Delta x = 100\eta_{DM}\sin\omega
\end{align}
$$
for $\Phi =\Omega$. This value is too small to be detected.  For Earth, it is about
$$
\begin{align}
	\Delta x = 434\eta_{DM}\sin\omega
\end{align}
$$</p>
<h1>22/3/2019</h1>
<h2>Query on Triditional Statistics</h2>
<p>Exact renormalization group flow proposed by Polchinski states that modifying momentum space to be curved is automatically renormalized and inverse equivalently flatten momentum space and change kinetic terms in Lagrangian with a factor depending on momentum.</p>
<p>This also implies that equal possibility principle is broken and triditional statistics is uncorrect to prescribe the high temperature case, $10^9$K for abundance of Lithium problem.</p>
<p>Furthermore, the temperature of a newly formed neutron star is as high as $10^{11}$ to $10^{12}$ K, although the huge number of emitted neutrinos carry away amount of energy that the temperature of an isolated neutron star falls within a few years to around $10^6$ K  whose temperature can be detected in X-rays.</p>
<p>Periodically secular change for Neutron star-white Dwarf binary:
$$
T = \frac{2\pi}{\omega}<s>\Longrightarrow</s>\frac{dT}{dt} = \frac{T^2}{2\pi}\frac{d\omega}{dt}~~\Longrightarrow \Delta T = \frac{T^2}{2\pi}\Delta\omega
$$
and
$$
a = \left( \frac{GMT^2}{4\pi^2} \right)^{1/3}
$$
The fifth force gives rise to the advance of periastron
$$
\Delta T_5 = \frac{T^2}{2\pi}\Delta\omega_5 = - \frac{3\pi T^2a^2a_5}{2\pi GM e}\cos(\omega-F)(1-e^2)^{1/2}
$$
Consequently $a_5$ equals to
$$
\begin{align}
\Delta T_5 = &amp;- \frac{3\pi T^2a^2a_5}{2\pi GM e}\cos(\omega-F)(1-e^2)^{1/2}\
= &amp; -\frac{3T^2a_5 \left( \frac{G^2M^2T^4}{16\pi^4}\right)^{1/3}}{2GMe}\cos(\omega-F)(1-e^2)^{1/2}\
= &amp; -\frac{3T^{10/3}a_5}{4\pi e (2\pi GM)^{1/3}}\cos(\omega-F)(1-e^2)^{1/2}
\end{align}
$$
$\Longrightarrow$   <strong>Eotvos parameter</strong>
$$
\eta_{DM}= \bigg| \frac{4\pi e(2\pi GM)^{1/3}}{3T^{10/3}a_{DM}(1-e^2)^{1/2}\cos(\omega-F)} \bigg|\Delta T
$$
In addition, ignored for gravitational binding energy of WD, the binding energy of neutron star is
$$
U = \frac{3Gm^2}{5R}= \frac{3mc^2}{5R} \frac{Gm}{c^2} = \frac{3mc^2}{5}\frac{r_s}{R}
$$
or
$$
\frac{U}{mc^2} = \frac{3r_s}{5R}
$$
Then the <strong>Nordtvedt effect</strong> reads as
$$
\bar{\eta}<em>{DM} = \bigg| \frac{20\pi eR(2\pi GM)^{1/3}}{9T^{10/3}a</em>{DM}r_s(1-e^2)^{1/2}\cos(\omega-F)} \bigg|\Delta T
$$
or directly ($m\simeq M$)
$$
\bar{\eta}<em>{DM} = \bigg| \frac{20\pi (2\pi)^{1/3} eRc^2}{9T^{10/3}a</em>{DM}(GM)^{2/3}(1-e^2)^{1/2}\cos(\omega-F)} \bigg|\Delta T
$$
where $R$ is the radius of neutron star.  Substituting $R=10km,~r_s=6km,~M=2M_{\odot},~a_{DM}=10^{-10}m/s^2,~e=0.1,~T=10yr$, into the expression, we reach
$$
\bar{\eta}<em>{DM} = 6.5\times 10^{-12}\frac{\Delta T}{\cos(\omega-F)}
$$
for $T=1yr$, $\bar{\eta}</em>{DM} = 1.4\times10^{-8}\frac{\Delta T}{\cos(\omega-F)}$. What's more, $\Delta T\sim 1hour$, $\bar{\eta}_{DM} = 5\times 10^{-5}$ .</p>
<p>for $T=10yr,~ \Delta T= 1hour​$, $\bar{\eta}_{DM} = 2.3\times 10^{-8}​$ .</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/27/人工智能(Python, PyTorch)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/27/人工智能(Python, PyTorch)/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-27T08:59:57+08:00">
                2019-02-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>人工智能(Python, PyTorch)</h1>
<p>参考书: 《深度学习原理与PyTorch实战》</p>
<p>深度学习的本质是做一个表征 (representation) 的学习。并非网络层数深.</p>
<h1>1. 超参数(实践, 调参数)、架构、训练方法</h1>
<p>训练方法：</p>
<p>超参数：经验</p>
<h2>架构</h2>
<p>可学习性是关键，其中最重要的就是反向传播</p>
<ol>
<li>卷积神经网络(CNN)：适于处理图像数据</li>
</ol>
<p>​			图形的平移对称性对应于神经元的横列</p>
<p>​			图形的自相似性通过缩放得到</p>
<ol start="2">
<li>循环神经网络(RNN)：处理序列数据</li>
</ol>
<p>​			同一神经元的循环可以具有记忆性，整个网络具有长程记忆性</p>
<ol start="3">
<li>神经计算机(神经图灵机)</li>
<li>Transformer (google)：自注意力机制</li>
<li>图网络：arxiv: 1906.01261</li>
<li>capsule network: arxiv: 1710.09829</li>
<li>BERT: 先 Transfromer, 然后遮挡部分语句，将剩下的句子给网络学习填上消失的语句，从一个有监督学习算   法实现无监督学习的效果；可以迁移学习来解决自然语言的问题（小数据训练，效果好）</li>
</ol>
<p>监督学习：打标签学习</p>
<p>无监督学习：无标签学习</p>
<h2>训练方法</h2>
<p>训练方法的影响：在课程学习中，训练的次序很重要，将一个大问题分成多个子问题，子问题很容易，但合并起来			       效果很好</p>
<p>​			       在迁移学习中，如何迁移很重要？</p>
<p>AlphaGo: 在很多工作用于流程设计</p>
<h2>特征</h2>
<p>通过可视化可以判断学习特征的过程</p>
<p>对于图形识别来说，在层数低的神经元学习边边角角（局部小特征），在层数高的神经元学习轮廓（整体特征）</p>
<h1>13/3/2019</h1>
<h2>单车预测&amp; 神经网络</h2>
<p>Universal Approximating Theorem (UAT): 任意连续函数都能用神经元逼近。神经元的叠加就能形成各种各样的峰，函数就能用这样组合的神经元逼近。</p>
<p>1.读取数据，pandas</p>
<p>2.将语音，图片，列表变成tensor变量</p>
<p>3.神经网络：生成正态随机分布torch.randn(1,counts)  1是输入神经元个数；偏置； 取学习率$\alpha = 0.0001$；</p>
<p>3.循环(epoch): 前馈</p>
<p>旧版本x.expand(counts, length) 将tensor扩张成length长度</p>
<p>每隔10000个loss点打印loss，</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> i%<span class="number">10000</span> == <span class="number">0</span>:</span><br><span class="line">	print(<span class="string">"loss: "</span>,loss)</span><br><span class="line">loss.backward()</span><br></pre></td></tr></table></figure></p>
<p>时刻注意 过拟合、欠拟合、无免费午餐</p>
<p>需要足够的特征；</p>
<p>数据准备：</p>
<p>建模时候，输入要注意，不同的输入要做不同的操作：类型变量（0，1，2，3，……）大小没有含义，需要转化为one hot编码，即转化为二进制$0\rightarrow 10000,~1\rightarrow 01000,~2\rightarrow 00100$ 但变量多会导致很长。对于每一个特征，如果它有m个可能值，那么经过独热编码后，就变成了m个二元特征。并且，这些特征互斥，每次只有一个激活。因此，数据会变成稀疏的。好处主要有：1.解决了分类器不好处理属性数据的问题；2.在一定程度上也起到了扩充特征的作用。</p>
<p>数值变量需要归一化才能使用，例如温度和湿度，两个单位不同需要归一化。</p>
<p>random sample：数据采样和数据分布有关，例如随时间变化的数据，需要随机均匀地取，要训练不同时间的模式。</p>
<p>数据处理：分批处理(batch)。将训练集分成很多块，在每一小块上进行梯度更新，(32, 64, 128条数据等等，需要具体运行)</p>
<p>建立神经网络：</p>
<p>pytorch自带nn模块，可以很快搭建神经网络(sequential 构造)</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neu = torch.nn.Sequential(torch.nn.Linear(input_size, hidden_size))。。。。。</span><br></pre></td></tr></table></figure></p>
<p>可以模块化损失函数和优化器 nn有很多损失函数，优化器可以将梯度下降模块化，也存在很多梯度下降，包括随机梯度下降(SGD)</p>
<p>画出loss函数曲线</p>
<h1>20/3/2019</h1>
<p>分批次处理数据放到GPU上面可以自动并行计算。而且梯度下降的效果比不分批要好。</p>
<p>对于连续的情况相同，但离散求导数就不同，误差累计为
$$
\frac{\partial L}{\partial x} = \sum_i\frac{\partial L_i}{\partial x},~~~L=\sum_iL_i
$$</p>
<p>输入层到下一个任意一个神经元的向量为
$$
w_j = \sum_{i}w_{ij}x_i
$$
<strong>训练结束后，每一个神经单元在探测，只有$W_j$和$X$两个矢量方向相同才能激活神经元，就是说神经元在匹配输入的数据模板，比较符合匹配的时候就能激活神经单元。这对应于激活和抑制。</strong></p>
<p>作业：1实现一个三类网络，对自行车预测进行高、中、低着三类的划分。</p>
<pre><code>  	2. 写一个三层的网络(或者多层)和反向传播算法，包含一个隐藏层
</code></pre>
<p>激活函数 sigmoid $\sigma(x) = \frac{1}{1+e^{-x}}$,  ReLU$\sigma (x) = \max(0,x)$, RNN用$\sigma(x) = \tanh(x)$</p>
<p>那么函数为
$$
y_i = \sigma\left( \sum_i W_{ji}x_i \right)
$$
在numpy用向量做运算。</p>
<p>预测问题输出为
$$
Y = \sigma(X\cdot W^{IH})\cdot W^{HO}
$$
分类问题输出为
$$
Y = \sigma\left(\sigma(X\cdot W^{IH})\cdot W^{HO}\right)
$$
此时$Y\in(0,1)$，取$1/2$为分界线，进行分类。</p>
<p>误差计算$e_j=y_j^<em>-y_j$， N个输出单元的误差向量$E=Y^</em>-Y$，计算总误差，取极小
$$
W^* = \text{argmin}_W \varepsilon (W)
$$</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/03/Research-Records20190103/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/03/Research-Records20190103/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-03T21:12:08+08:00">
                2019-01-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>Research Records on 3/1/2019</h1>
<p>Assume that the distribution of dark matter(DM) in galactic centre is
$$
\begin{align}
	\rho = \left{
\begin{array}{cc}
\frac{\rho_{sp}(r) \rho_{in}(r) }{\rho_{sp}(r) +\rho_{in}(r) },, &amp; \frac{4GM}{c^2}\leq r &lt; R_{sp}\
\rho_{GNFW}(r),, &amp; r\geq R_{sp}
\end{array}
\right.
\end{align}
$$
where the symbols represent
$$
\begin{align}
	\rho_{sp} = \alpha r^{-\gamma_{sp}},,<s>\rho_{in} = \beta r^{-\gamma_{in}},,</s> \rho_{GNFW} = \frac{\rho_0}{(r/R_{s})^\gamma (1+r/R_s)^{3-\gamma}},,
\end{align}
$$
and $\alpha,~\beta$  are the quantities that characterize the properties of dark matter in different region, say, $r&lt; r_{ann}$ and $r&gt;r_{ann}$ ($r_{ann}$ means the characteristic radius of annihilation of dark matter particles).  $R_s = 20kpc$ and $\rho_0$ can be determined by $\rho_{GNFW} = 0.4~Gev/cm^3$ at $r=8 kpc$. In addition, the parameters $\gamma_{sp} related$ is to $\gamma$ ,
$$
\begin{align}
	\gamma_{sp} = &amp; \frac{9-2\gamma}{4-\gamma}\
	\gamma_{in} = &amp; \left{
	\begin{array}{cc}
	0.5,, &amp;for~s-wave~annihilation\
	0.34,, &amp;for~p-wave~annihilation
\end{array}
\right. \
\gamma \in &amp;[1.0,1,4]
\end{align}
$$
By the way, the coefficients $\alpha$ and $\beta$ can be refered to be
$$
\begin{align}
	\alpha = &amp; \rho_Rg_\gamma(r)R_{sp}^{\gamma_{sp}},,~~\rho_R = \rho_0\left(\frac{r_0}{R_{sp}} \right)^\gamma ,, R_{sp} = \alpha_\gamma r_0\left(\frac{M}{\rho_0 r_0^3} \right)^{1/(3-\gamma)},,<s>g_\gamma(r) = \left(1-\frac{4R_s}{r} \right)^3\
	\beta = &amp; \frac{\rho_{ann}R_{ann}^{1/2}}{(p+1)I_{1/2}(p;1)},,~<s>p=0.86,,</s>~\rho_{ann}(s-wave)=1.7\times 10^8M_{solar}/pc^3,,\
	\rho_{ann}&amp;(p-wave)=  6.6\times 10^{10} M_{solar}/pc^3 ,,</s>~ r_{ann}(s-wave) = 3.1\times 10^{-3}pc ,,\
	r_{ann}&amp;(p-wave) = 2.5\times 10^{-4}pc
\end{align}
$$</p>
<p>Integrating the $\rho$ , we obtain the mass which is related to the acceleration
$$
\begin{align}
	m(r) = &amp; \int_{\frac{4GM}{c^2}}^{R_{sp}} \frac{\rho_{sp}(r) \rho_{in}(r) }{\rho_{sp}(r) +\rho_{in}(r) } 4\pi r^2 dr + \int_{R_{sp}}^r \rho_{GNFW}(r')4\pi r'^2 dr'\
	= &amp; \int_{\frac{4GM}{c^2}}^{R_{sp}} \frac{\alpha\beta r^{-\gamma_{in}-\gamma_{sp}}}{\alpha r^{-\gamma_{sp}}+\beta r^{-\gamma_{in}}} 4\pi r^2 dr + \int^r_{R_{sp}}\frac{\rho_0}{(r'/R_s)^\gamma (1+r'/R_{s})^{3-\gamma}}4\pi r'^2dr'\
	= &amp; \frac{4\pi\beta \left(\frac{4GM}{c^2}\right)^{3-\gamma_{in}}}{\gamma_{in}-3}{}<em>2F_1\left[1,\frac{\gamma</em>{in}-3}{\gamma_{in}-\gamma_{sp}},\frac{3+\gamma_{sp}-2\gamma_{in}}{\gamma_{sp}-\gamma_{in}}, - \frac{\beta}{\alpha}\left( \frac{4GM}{c^2} \right)^{\gamma_{sp}-\gamma_{in}}\right]\
	&amp;- \frac{4\pi\beta R_{sp}^{3-\gamma_{in}}}{\gamma_{in}-3}{}<em>2F_1\left[1,\frac{\gamma</em>{in}-3}{\gamma_{in}-\gamma_{sp}},\frac{3+\gamma_{sp}-2\gamma_{in}}{\gamma_{sp}-\gamma_{in}}, - \frac{\beta}{\alpha}R_{sp}^{\gamma_{sp}-\gamma_{in}}\right]\
	&amp; + \frac{4\pi \rho_0 R_s^{2+\gamma}R_{sp}^{1-\gamma}}{\gamma-1}\left{ -2\left( 1+\frac{R_{sp}}{R_s} \right)^{\gamma-1} + {}<em>2F_1\left(1-\gamma,1-\gamma,2-\gamma,-\frac{R</em>{sp}}{R_s}\right) \
+{}<em>2F_1\left( 1-\gamma,3-\gamma,2-\gamma, - \frac{R</em>{sp}}{R_s} \right) \right} \
&amp; - \frac{4\pi \rho_0 R_s^{2+\gamma}r^{1-\gamma}}{\gamma-1}\left{ -2\left( 1+ \frac{r}{R_s} \right)^{\gamma-1} + {}_2F_1\left(1-\gamma,1-\gamma,2-\gamma,-\frac{r}{R_s}\right) \
+{}_2F_1\left( 1-\gamma,3-\gamma,2-\gamma, - \frac{r}{R_s} \right) \right}
\end{align}
$$</p>
<p>$$
\begin{align}
	a_{DM} = &amp; \frac{G}{r^2} \bigg{ \frac{4\pi\beta \left(\frac{4GM}{c^2}\right)^{3-\gamma_{in}}}{\gamma_{in}-3}{}<em>2F_1\left[1,\frac{\gamma</em>{in}-3}{\gamma_{in}-\gamma_{sp}},\frac{3+\gamma_{sp}-2\gamma_{in}}{\gamma_{sp}-\gamma_{in}}, - \frac{\beta}{\alpha}\left( \frac{4GM}{c^2} \right)^{\gamma_{sp}-\gamma_{in}}\right]\
	&amp;- \frac{4\pi\beta R_{sp}^{3-\gamma_{in}}}{\gamma_{in}-3}{}<em>2F_1\left[1,\frac{\gamma</em>{in}-3}{\gamma_{in}-\gamma_{sp}},\frac{3+\gamma_{sp}-2\gamma_{in}}{\gamma_{sp}-\gamma_{in}}, - \frac{\beta}{\alpha}R_{sp}^{\gamma_{sp}-\gamma_{in}}\right]\
	&amp; + \frac{4\pi \rho_0 R_s^{2+\gamma}R_{sp}^{1-\gamma}}{\gamma-1}\left{ -2\left( 1+\frac{R_{sp}}{R_s} \right)^{\gamma-1} + {}<em>2F_1\left(1-\gamma,1-\gamma,2-\gamma,-\frac{R</em>{sp}}{R_s}\right) \
+{}<em>2F_1\left( 1-\gamma,3-\gamma,2-\gamma, - \frac{R</em>{sp}}{R_s} \right) \right} \
&amp; - \frac{4\pi \rho_0 R_s^{2+\gamma}r^{1-\gamma}}{\gamma-1}\left{ -2\left( 1+ \frac{r}{R_s} \right)^{\gamma-1} + {}_2F_1\left(1-\gamma,1-\gamma,2-\gamma,-\frac{r}{R_s}\right) \
+{}_2F_1\left( 1-\gamma,3-\gamma,2-\gamma, - \frac{r}{R_s} \right) \right}
\bigg}
\end{align}
$$</p>
<p>Moreover the additional fundamental force is characterized by the coefficient
$$
\begin{align}
	\eta_{DM} = &amp; \pm \frac{g_5^2}{4\pi G u^2} \frac{q_5^{DM}}{\mu_{DM}}\left( \frac{q_5^A}{\mu_A} - \frac{q_5^B}{\mu_B} \right)\left(1 + \frac{r}{\lambda} \right) e^{-r/\lambda}
\end{align}
$$
and
$$
\begin{align}
	\frac{q_5}{\mu} = \frac{Z}{\mu}\cos\psi + \frac{N}{\mu}\sin\psi,, ~~~\tan\psi = \frac{q_5^{(n)}}{q_5^{(p)}+q_5^{(e)}}
\end{align}
$$
where $Z$ and $N$ are proton and neutron number respectively. Thus the fifth force affects the binary system with the acceleration
$$
\begin{align}
	a_{5} = \eta_{DM}(r=R=8kpc) \times a_{DM}(r=R=8kpc)
\end{align}
$$</p>
<p>in which $a_5$ is a constant force between objects A and B.</p>
<p>The acceleration is
$$
\begin{align}
	\ddot{\vec{r}} = &amp; -\frac{Gm}{r^2}\vec{n} + \vec{A}<em>{1PN} + a_5\vec{N}
\end{align}
$$
source from
$$
\begin{align}
	\ddot{\vec{r}} = -\frac{Gm}{r^2}\vec{n} + \vec{A}</em>{1PN} + \vec{A}_\eta
\end{align}
$$
In this relative acceleration, the 0PN and 1PN terms can be witten as
$$
\begin{align}
	\vec{a} = -\frac{Gm}{r^2}\vec{n} - \frac{Gm}{c^2r^2}\left{ \left[ (1+3\eta)v^2 - \frac{3}{2}\eta \dot{r}^2 - 2(2+\eta)\frac{Gm}{r} \right]\vec{n} -2(2-\eta)\dot{r}\vec{v} \right}
\end{align}
$$
and thus
$$
\begin{align}
	\vec{a} = &amp; -\frac{Gm}{r^2}\vec{n} - \frac{Gm}{c^2r^2}\left{ \left[ (1+3\eta)v^2 - \frac{3}{2}\eta \dot{r}^2 - 2(2+\eta)\frac{Gm}{r} \right]\vec{n} -2(2-\eta)\dot{r}\vec{v} \right}+ a_5\vec{N} \
	\vec{r} = &amp; r\vec{n},,<s>\vec{v}=\dot{r}\vec{n}+r\dot{\phi}\vec{\lambda},,</s>\vec{a} = (\ddot{r}-r\dot{\phi}^2)\vec{n}+\frac{1}{r}\frac{d}{dt}(r^2\dot{\phi})\vec{\lambda}
\end{align}
$$
This implies that the two dynamical equations
$$
\begin{align}
	\ddot{r}- r\dot{\phi}^2 = &amp; -\frac{Gm}{r^2} - \frac{Gm}{c^2r^2}\left[ (1+3\eta)v^2 - \frac{3}{2}\eta \dot{r}^2 - 2(2+\eta)\frac{Gm}{r} \right] -2(2-\eta)\dot{r}^2 + a_5\vec{n}\cdot\vec{N}\
	\frac{1}{r}\frac{d}{dt}(r^2\dot{\phi}) = &amp; 2(2-\eta)\frac{Gm}{c^2r}\dot{r}\dot{\phi} + a_5\vec{\lambda}\cdot\vec{N},,\
	\vec{n}\cdot\vec{N} = &amp; \cos(\omega+f-F)\
	\vec{\lambda}\cdot\vec{N} = &amp; -\sin(\omega+f-F)
\end{align}
$$
where $F$ comes from
$$
\begin{align}
	\vec{N} = \cos F\vec{e}_X+\sin F\vec{e}_Y
\end{align}
$$
The components of perturbative force read as
$$
\begin{align}
	\mathcal{R} = &amp; \vec{f}\cdot \vec{n} = - \frac{Gm}{c^2r^2}\left[ (1+3\eta)v^2 - \frac{3}{2}\eta \dot{r}^2 - 2(2+\eta)\frac{Gm}{r} \right] -2(2-\eta)\dot{r}^2 + a_5\cos(\omega+f-F)\
	\mathcal{S} = &amp; \vec{f}\cdot\vec{\lambda} = 2(2-\eta)\frac{Gm}{c^2r}\dot{r}\dot{\phi} - a_5\sin(\omega+f-F)\
	\mathcal{W} = &amp; \vec{f}\cdot \vec{e}_Z = 0
\end{align}
$$</p>
<p>Finally the differential equation for  advanced perihelion is
$$
\begin{align}
	\frac{d\omega}{df}\approx &amp; \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} \bigg]\
\end{align}
$$</p>
<p>which, as the fifth-force contribution, gives
$$
\begin{align}
	\Delta\omega_5 = &amp; - \frac{3\pi p^2a_5}{Gm}\frac{\cos(\omega-F)}{e(1-e^2)^{3/2}} = - \frac{3\pi a^2a_5}{Gm e}\cos(\omega-F)(1-e^2)^{1/2} \
	&amp;= -1.16\cos(\omega-F)\times 10^{-12}~rad/orbit~period
\end{align}
$$
and for average speaking, perihelionlion will not have a secular non-zero advance
$$
\begin{align}
	\langle \Delta\omega \rangle_5 = 0,.
\end{align}
$$</p>
<p>The pericenter advance of Sun-Mecury system is
$$
\begin{align}
	\langle\Delta\omega\rangle_{GR} = 6\pi \frac{Gm}{ac^2(1-e^2)} = 4.9\times 10^{-7}~rad/orbtit~period
\end{align}
$$</p>
<p>$$
\begin{align}
	&amp;a = 0.387099AU\
	&amp;1Au = 1.496\times 10^{11}m\
	&amp;G = 6.67408\times 10^{-11}N\cdot m^2/kg^2\
	&amp;m = 1.9891 \times 10^{30}kg\
	&amp;e = 0.205628 \
	&amp;P = 0.24085 yr\
	&amp;1GeV = 1.783\times 10^{-27}kg\
	&amp;1 rad = 2.063 \times 10^5 arcsecond
\end{align}
$$</p>
<h1>15/1/2019</h1>
<p>$\eta_{DM} \approx \alpha \left(\frac{q_5^{DM}}{\mu_{DM}}\right) \Delta\left( \frac{q_5^{OM}}{\mu_{OM}} \right)$ if $\lambda \gg r$</p>
<p>Yukawa strength $\alpha = 10^{-11}​$</p>
<p>However, one can use a technical skill to viod the $\alpha$ and $\frac{q_5^{DM}}{\mu_{DM}}$ if $\eta_{DM}$ is known in experiment with $|\eta_{DM}|\leq 10^{-5} $. The expression is
$$
\begin{align}
	\frac{a_{ng}^{DM}}{a^{DM}_{gal}} = \eta^{DM} \frac{\langle q_5/\mu \rangle}{\Delta (q_5/\mu)}
\end{align}
$$
where the upper line in the fraction represents the mean value and the bottom one is the difference of test bodies. The figures in literatures, in fact, characterize the ratio
$$
\begin{align}
	R = \frac{\langle q_5/\mu \rangle}{\Delta (q_5/\mu)} = \frac{\sin\psi \langle N/\mu \rangle + \cos\psi \langle Z/\mu\rangle}{\sin\psi\left[ \Delta(N/\mu)\right] + \cos\psi\left[\Delta(Z/\mu)\right]}
\end{align}
$$</p>
<h1>18/1/2019</h1>
<p>dynamics in this triple system is perturbated by dark matter and first order relativistic effect
$$
\begin{align}
	\vec{a} = -G\frac{m}{r^2}\vec{n} + \vec{A}<em>{PN}+\eta</em>{DM}\vec{a}<em>g
\end{align}
$$
where
$$
\begin{align}
	\vec{a} = &amp; -\frac{Gm}{r^2}\vec{n} - \frac{Gm}{c^2r^2}\left{ \left[ (1+3\eta)v^2 - \frac{3}{2}\eta \dot{r}^2 - 2(2+\eta)\frac{Gm}{r} \right]\vec{n} -2(2-\eta)\dot{r}\vec{v} \right}+ \eta</em>{DM}a_g\vec{N} \
	\vec{r} = &amp; r\vec{n},,<s>\vec{v}=\dot{r}\vec{n}+r\dot{\phi}\vec{\lambda},,</s>\vec{a} = (\ddot{r}-r\dot{\phi}^2)\vec{n}+\frac{1}{r}\frac{d}{dt}(r^2\dot{\phi})\vec{\lambda} \
	\vec{N} = &amp; \sin\Theta \cos\Phi~ \vec{e}_X+\sin\Theta\sin\Phi~\vec{e}_Y + \cos\Theta~\vec{e}_Z\
	\vec{n} = &amp; \left[ \cos\Omega\cos(\omega+f)-\cos\iota \sin\Omega\sin(\omega+f) \right]~\vec{e}_X \
	&amp; + \left[\sin\Omega\cos(\omega+f) + \cos\iota \cos\Omega\sin(\omega+f) \right]~\vec{e}_Y\
	&amp; + \sin\iota\sin(\omega+f)~\vec{e}_Z \
	\vec{\lambda} = &amp; \left[ -\cos\Omega\sin(\omega+f) -\cos\iota\sin\Omega\cos(\omega+f) \right]~\vec{e}_X\
	&amp; + \left[-\sin\Omega\sin(\omega+f)+\cos\iota\cos\Omega\cos(\omega+f) \right]~\vec{e}_Y\
	&amp; + \sin\iota\cos(\omega+f)~\vec{e}<em>Z\
	\vec{e}_z = &amp; \sin\iota\sin\Omega ~\vec{e}_X - \sin\iota\cos\Omega~\vec{e}_Y+\cos\iota~\vec{e}_Z
\end{align}
$$
so that
$$
\begin{align}
	\vec{n}\cdot\vec{N} = &amp; \sin\Theta\cos(\omega+f)\cos(\Omega-\Phi)-\cos\iota\sin\Theta\sin(\omega+f)\sin(\Omega-\Phi)+\sin\iota\sin(\omega+f)\cos\Theta\
	\vec{\lambda}\cdot\vec{N} = &amp; -\sin\Theta \sin(\omega+f)\cos(\Omega-\Phi)+\sin\Theta\cos\iota\cos(\omega+f)\sin(\Phi-\Omega)+\sin\iota\cos(\omega+f)\cos\Theta\
	\vec{e}<em>z\cdot\vec{N} = &amp; \sin\iota \sin\Theta\sin(\Omega-\Phi)+\cos\iota\cos\Theta
\end{align}
$$
The perturbative force component is
$$
\begin{align}
	\mathcal{R} =  \vec{f}\cdot \vec{n} = &amp; - \frac{Gm}{c^2r^2}\left[ (1+3\eta)v^2 - \frac{3}{2}\eta \dot{r}^2 - 2(2+\eta)\frac{Gm}{r} \right] -2(2-\eta)\dot{r}^2 \
&amp; + \eta</em>{DM}a_g \bigg[ \sin\Theta\cos(\omega+f)\cos(\Omega-\Phi)-\cos\iota\sin\Theta\sin(\omega+f)\sin(\Omega-\Phi)\
&amp; ~~~<s><s><s><s><s><s><s>+\sin\iota\sin(\omega+f)\cos\Theta \bigg]\
	\mathcal{S} =  \vec{f}\cdot\vec{\lambda} = &amp; 2(2-\eta)\frac{Gm}{c^2r}\dot{r}\dot{\phi} \
	&amp; + \eta</s></s></s></s></s></s></s></em>{DM} a_g \bigg[ -\sin\Theta \sin(\omega+f)\cos(\Omega-\Phi)+\sin\Theta\cos\iota\cos(\omega+f)\sin(\Phi-\Omega)\
	&amp;~~~~~+\sin\iota\cos(\omega+f)\cos\Theta \bigg]  \
	\mathcal{W} =  \vec{f}\cdot \vec{e}<em>Z = &amp; \eta</em>{DM} a_g \bigg[ \sin\iota \sin\Theta\sin(\Omega-\Phi)+\cos\iota\cos\Theta \bigg]
\end{align}
$$
The perihelion advance differential equation is
$$
\begin{align}
	\frac{d\omega}{df}\simeq &amp; \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} -e\cot\iota \frac{\sin(\omega+f)}{(1+e\cos f)^3}\mathcal{W} \bigg]\
\end{align}
$$</p>
<p>with the contribution from dark matter
$$
\begin{align}
	\Delta\omega = &amp; -\frac{2\eta_{DM}a_g\pi a^2}{Gm e^3}\big[1+e^4-\sqrt{1-e^2}-2e^2(1-\sqrt{1-e^2}) \big] \\
	&amp;~<s><s><s>\times \bigg[ \cos(\Phi-\Omega)\cos\omega\sin\Theta+\cos\Theta\sin\iota\sin\omega + \sin\omega\cos\iota\sin\Theta\sin(\Phi-\Omega) \bigg] \
	&amp; - \frac{\eta_{DM}a_g \pi a^2}{e^3Gm}\sqrt{1-e^2}\bigg[ 2-e^2-2\sqrt{1-e^2}+2e^2\sqrt{1-e^2} \bigg]\
	&amp;</s></s></s>~\times\bigg[ \cos\Theta\sin\iota\sin\omega+\cos\iota\sin\Theta\sin\omega\sin(\Phi-\Omega)+\sin\Theta\cos\omega\cos(\Phi-\Omega) \bigg]\
	&amp; + \frac{3\eta_{DM}a_g\pi a^2}{Gm\sqrt{1-e^2}}\cos\iota\sin\omega[\cos\Theta\cot\iota - \sin\Theta\sin(\Phi-\Omega)]
\end{align}
$$
For $\Theta \rightarrow \pi/2$ ,
$$
\begin{align}
	\sin \iota \frac{d\Omega}{df}\simeq &amp; \frac{p^2}{Gm}\frac{\sin(\omega+f)}{(1+e\cos f)^3}\mathcal{W} = \frac{\eta_{DM} a_g p^2}{Gm}\frac{\sin(\omega+f)}{(1+e\cos f)^3} \bigg[ \sin\iota \sin\Theta\sin(\Omega-\Phi)+\cos\iota\cos\Theta \bigg]\
	= &amp; \frac{\eta_{DM} a_g p^2}{Gm}\frac{\sin(\omega+f)}{(1+e\cos f)^3} \sin\iota\sin(\Omega-\Phi)
\end{align}
$$
so even for $\iota \rightarrow 0$ , the derivative is
$$
\begin{align}
	\frac{d\Omega}{df} = \frac{\eta_{DM} a_g p^2}{Gm}\frac{\sin(\omega+f)}{(1+e\cos f)^3} \sin(\Omega-\Phi)
\end{align}
$$
Then the advance is
$$
\begin{align}
	\frac{d\omega}{df} = - \cos\iota \frac{d\Omega}{df} + \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} \bigg]
\end{align}
$$
for $\iota\rightarrow 0$ becoming
$$
\begin{align}
	\frac{d\bar{\omega}}{df} =\frac{d\omega}{df} +\frac{d\Omega}{df} = \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} \bigg]
\end{align}
$$</p>
<p>The acceleration of dark matter is
$$
\begin{align}
	a_5 =\eta_{DM}a_g  \sim 10^{-15}m/s^2
\end{align}
$$
From FIG.2 of Shao's work, we see that the magnitude of the acceleration in solar system is roughly same in different models, so we can use the simplest model GNFW
$$
\begin{align}
	m = \int_{10^{-5}}^{8kpc} 4\pi r^2\rho_{GNFW}dr = \int_{10^{-5}}^{8kpc} 4\pi r^2\frac{\rho_0}{(r/R_s)^\gamma(1+r/R_s)^{3-\gamma}} dr
\end{align}
$$
where $R_s = 20kpc$ and $\rho(r=8kpc)=0.4~GeV/cm^3$ and $\gamma = 1.24$ or $\gamma = 1.26$. Thus
$$
\begin{align}
	\rho_0 &amp;= 0.4^{1+\gamma}\times1.4^{3-\gamma}~GeV/cm^3 = 0.4^{1+\gamma}\times1.4^{3-\gamma}\times 10^6~GeV/m^3 \
&amp;= 0.4^{1+\gamma}\times1.4^{3-\gamma}\times 10^6 \times 3.084^3\times 10^{48}~GeV/pc^3\
&amp;= 0.4^{1+\gamma}\times1.4^{3-\gamma}\times 10^6 \times 3.084^3\times 10^{57}~GeV/kpc^3 \
&amp; = 0.4^{1+\gamma}\times1.4^{3-\gamma}\times 29.3321\times 10^{63}~GeV/kpc^3\
&amp; = \left(\frac{2}{7}\right)^\gamma \times 3.22488\times 10^{64}GeV/kpc^3
\end{align}
$$</p>
<p>$$
\begin{align}
	m = &amp; \int_{10^{-5}kpc}^{8kpc} 4\pi r^2\frac{0.4^{1+\gamma}\times1.4^{3-\gamma}\times 29.3321\times 10^{63}}{(r/20)^\gamma(1+r/20)^{3-\gamma}} dr \
\approx &amp; \int_{10^{-5}kpc}^{8kpc} 9.39\pi \frac{0.4^{1+\gamma}\times1.4^{3-\gamma}\times 10^{68}}{(20+r)^{3-\gamma}}r^{2-\gamma} dr
\end{align}
$$</p>
<p>The dark matter mass is
$$
\begin{align}
	m_{\gamma=1.24} &amp;= 5.28305\times 10^{61}~ GeV = 5.28305\times 10^{67}\times 1.783 \times 10^{-27} ~kg= 9.419\times 10^{40} ~kg\
	m_{\gamma=1.26} &amp;= 5.33912\times 10^{61}~ GeV = 5.33912\times 10^{67}\times 1.783 \times 10^{-27} ~kg = 9.519\times 10^{40}~kg
\end{align}
$$
They generate the accelerations as</p>
<p>$$
\begin{align}
	a_{DM,\gamma=1.24} = &amp; \frac{Gm}{R^2} = \frac{6.673\times10^{-11}\times 9.419\times 10^{40}}{(8000\times 3.084\times 10^{16})^2} ~m/s^2 = 1.032\times 10^{-10} m/s^2\
	a_{DM,\gamma=1.26} = &amp; \frac{Gm}{R^2} = \frac{6.673\times10^{-11}\times 9.519\times 10^{40}}{(8000\times 3.084\times 10^{16})^2} ~m/s^2 = 1.043\times 10^{-10} m/s^2
\end{align}
$$</p>
<h1>26/2/2019</h1>
<p>For Sun, the ratio of charge to mass unit is [Progress in Particle and Nuclear Physics 62 (2009) 102–134]
$$
\begin{align}
	Z/\mu = &amp; 0.86 \
	N/\mu = &amp; 0.14 \
	B/\mu = &amp; 0.99
\end{align}
$$
For Mercury, the ratio of charge is unknown...</p>
<p>For Earth, the ratio is
$$
\begin{align}
	Z/\mu = &amp; 0.49\
	N/\mu = &amp; 0.51\
	B/\mu = &amp; 1.00
\end{align}
$$
$\Delta (Z/\mu) = 0.37,~\Delta (N/\mu) = -0.37,~\lang Z/\mu\rang = 0.675,~\lang N/\mu \rangle = 0.325$
$$
\begin{align}
	\eta_{DM}\cos(\omega-F) = &amp; -\frac{\Delta\omega_5 Gme}{3\pi a^2(1-e^2)^{1/2}a_{DM}} \
	A_{\eta} = \eta_{DM} a_{DM}
\end{align}
$$</p>
<p>$$
\begin{align}
	\Delta\omega = \Delta\omega_{Newton}+\Delta\omega_{PPN} +\Delta\omega_{DM}
\end{align}
$$</p>
<p>$G = 6.672\times 10^{-11}N\cdot m^2/kg^2$,$a = 0.387099 AU$, $1AU = 149.60\times 10^9m$, periodicity $P = 0.24085yr$, $e=0.205628$, $\iota = 7^\circ 0'15''$, $1rad = 2.063\times 10^5 ~as$,<br>
$$
\begin{align}
\eta_{DM}\cos(\omega-F) = &amp; - 8.45847\times 10^6\Delta\omega_5 ~~~~~~~~~~~~(rad/orbit)\
\eta_{DM}\cos(\omega-F) = &amp; -0.0987505\Delta\omega_5  ~~~~~~~~~~~~~~~~~(as/century)
\end{align}
$$</p>
<p>The advances of thrid bodies perturbations reach
$$
\begin{align}
	\Delta\omega_3 = &amp; \frac{3\pi}{2} \frac{m_3a^3}{M R^3}(1-e^2)^{1/2}\left[1+5\cos2(\omega-F) \right]
\end{align}
$$</p>
<p><strong><em>BepiColombo</em></strong> is a joint mission of the <a href="https://en.wikipedia.org/wiki/European_Space_Agency" target="_blank" rel="noopener">European Space Agency</a> (ESA) and the <a href="https://en.wikipedia.org/wiki/JAXA" target="_blank" rel="noopener">Japan Aerospace Exploration Agency</a> (JAXA) to the planet <a href="https://en.wikipedia.org/wiki/Mercury_(planet)" target="_blank" rel="noopener">Mercury</a>.[<a href="https://en.wikipedia.org/wiki/BepiColombo#cite_note-Amos-4" target="_blank" rel="noopener">4]</a> The mission comprises two satellites launched together: the <strong>Mercury Planetary Orbiter</strong> (<strong>MPO</strong>) and <strong><em>Mio</em></strong> (<strong>Mercury Magnetospheric Orbiter</strong>, <strong>MMO</strong>).[<a href="https://en.wikipedia.org/wiki/BepiColombo#cite_note-Miopressrelease-5" target="_blank" rel="noopener">5]</a> The mission will perform a comprehensive study of Mercury, including characterization of its <a href="https://en.wikipedia.org/wiki/Magnetic_field" target="_blank" rel="noopener">magnetic field</a>, <a href="https://en.wikipedia.org/wiki/Magnetosphere" target="_blank" rel="noopener">magnetosphere</a>, and both interior and surface structure. It was launched on an <a href="https://en.wikipedia.org/wiki/Ariane_5" target="_blank" rel="noopener">Ariane 5</a>[<a href="https://en.wikipedia.org/wiki/BepiColombo#cite_note-ariane-2" target="_blank" rel="noopener">2]</a> rocket on 20 October 2018 at 01:45 UTC, with an arrival at Mercury planned for December 2025, after a flyby of Earth, two flybys of Venus, and six flybys of Mercury.[<a href="https://en.wikipedia.org/wiki/BepiColombo#cite_note-FACTS-1" target="_blank" rel="noopener">1]</a>[<a href="https://en.wikipedia.org/wiki/BepiColombo#cite_note-esa20161125-6" target="_blank" rel="noopener">6]</a> The mission was approved in November 2009, after years in proposal and planning as part of the European Space Agency's <a href="https://en.wikipedia.org/wiki/List_of_European_Space_Agency_programs_and_missions#Horizon_2000+" target="_blank" rel="noopener">Horizon 2000+</a> programme;[<a href="https://en.wikipedia.org/wiki/BepiColombo#cite_note-7" target="_blank" rel="noopener">7]</a> it is the last mission of the programme to be launched.[<a href="https://en.wikipedia.org/wiki/BepiColombo#cite_note-scaling_back-8" target="_blank" rel="noopener">8]</a></p>
<p>The mission involves three components, which will separate into independent spacecraft upon arrival at Mercury.</p>
<ul>
<li>Mercury Transfer Module (MTM) for propulsion, built by ESA</li>
<li>Mercury Planetary Orbiter (MPO) built by ESA</li>
<li>Mercury Magnetospheric Orbiter (MMO) or <em>Mio</em> built by JAXA</li>
</ul>
<p>Arriving in Mercury orbit on 5 December 2025, the <em>Mio</em> and MPO satellites will separate and observe Mercury in collaboration for one year, with a possible one-year extension.</p>
<p>Verify Einstein's theory of <a href="https://en.wikipedia.org/wiki/General_relativity" target="_blank" rel="noopener">general relativity</a> by measuring the parameters <em>gamma</em> and <em>beta</em> of the <a href="https://en.wikipedia.org/wiki/Parameterized_post-Newtonian_formalism" target="_blank" rel="noopener">parameterized post-Newtonian formalism</a>with high accuracy.</p>
<table>
<thead>
<tr>
<th>Date</th>
<th>Event</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>20 October 2018</td>
<td>Launch</td>
<td></td>
</tr>
<tr>
<td>6 April 2020</td>
<td><a href="https://en.wikipedia.org/wiki/Earth" target="_blank" rel="noopener">Earth</a> flyby</td>
<td>1.5 years after launch</td>
</tr>
<tr>
<td>12 October 2020</td>
<td>First <a href="https://en.wikipedia.org/wiki/Venus" target="_blank" rel="noopener">Venus</a> flyby</td>
<td></td>
</tr>
<tr>
<td>11 August 2021</td>
<td>Second Venus flyby</td>
<td>1.35 Venus years after first Venus flyby</td>
</tr>
<tr>
<td>2 October 2021</td>
<td>First <a href="https://en.wikipedia.org/wiki/Mercury_(planet)" target="_blank" rel="noopener">Mercury</a> flyby</td>
<td></td>
</tr>
<tr>
<td>23 June 2022</td>
<td>Second Mercury flyby</td>
<td>2 orbits (3.00 Mercury years) after 1st Mercury flyby</td>
</tr>
<tr>
<td>20 June 2023</td>
<td>Third Mercury flyby</td>
<td>&gt;3 orbits (4.12 Mercury years) after 2nd Mercury flyby</td>
</tr>
<tr>
<td>5 September 2024</td>
<td>Fourth Mercury flyby</td>
<td>~4 orbits (5.04 Mercury years) after 3rd Mercury flyby</td>
</tr>
<tr>
<td>2 December 2024</td>
<td>Fifth Mercury flyby</td>
<td>1 orbit (1.00 Mercury year) after 4th Mercury flyby</td>
</tr>
<tr>
<td>9 January 2025</td>
<td>Sixth Mercury flyby</td>
<td>~0.43 orbits (0.43 Mercury years) after 5th Mercury flyby</td>
</tr>
<tr>
<td>5 December 2025</td>
<td>Mercury orbit insertion</td>
<td><strong>Spacecraft separation</strong>; 3.75 Mercury years after 6th Mercury flyby</td>
</tr>
<tr>
<td>14 March 2026</td>
<td>MPO in final science orbit</td>
<td>1.13 Mercury years after orbit insertion</td>
</tr>
<tr>
<td>1 May 2027</td>
<td>End of nominal mission</td>
<td>5.82 Mercury years after orbit insertion</td>
</tr>
<tr>
<td>1 May 2028</td>
<td>End of extended mission</td>
<td>9.98 Mercury years after orbit insertion</td>
</tr>
</tbody>
</table>
<p>Will gives the result
$$
\begin{align}
\dot{\omega} = 0.22milliarcseconds~per~century
\end{align}
$$
for third bodies contribution arising from the other planets of our Solar system up to Saturn.</p>
<p>So according to the satellites' precision, we obtain
$$
\begin{align}
	|\eta_{DM}\cos(\omega-F)| \approx 0.22\times 0.0987505\times10^{-6} \approx 2.2\times 10^{-8}
\end{align}
$$</p>
<p>![image-20190305151330279](/Users/bingsun/Library/Application Support/typora-user-images/image-20190305151330279.png)</p>
<h1>12/3/2019</h1>
<h2>The Constraints on PPN</h2>
<p>![image-20190312153135136](/Users/bingsun/Library/Application Support/typora-user-images/image-20190312153135136.png)</p>
<p>In simulation $\beta\in [2\times 10^{-6},~7.3\times 10^{-7}]$, $\gamma\in[2\times 10^{-6},~9.3\times 10^{-7}]$. $\Delta\omega \simeq0.22\times 10^{-6}$</p>
<p>$$
\begin{align}
	\dot{\omega} = \frac{6\pi Gm}{ac^2(1-e^2)}\left[\frac{1}{3}(2+2\gamma-\beta)+\frac{1}{6}\eta(2\alpha_1-\alpha_2+\alpha_3+2\xi_2)+\frac{J_2R^2}{2ma(1-e^2)} \right]
\end{align}
$$
where $m=m_1+m_2$ and $ \eta=m_1m_2/(m_1+m_2)$ are the total mass and dimensionless reduced mass of the two-body system respectively. $R$ is the mean radius of the oblate body; and $J_2$ is a dimensionless measure of its quadrupole moment, given by $J_2=(C-A)/(m_1R^2)$ where $C$ and $A$ are the moments of inertia about the body’s rotation and equatorial axes, respectively.  $\eta\simeq 2\times 10^{-7},~~J_2\simeq (2.2\pm 0.1)\times 10^{-7}$.</p>
<p>![image-20190312155828001](/Users/bingsun/Library/Application Support/typora-user-images/image-20190312155828001.png)</p>
<p>We could make a ephemeris for Earth and Mercury in terms of
$$
\begin{align}
	\ddot{\vec{r}}<em>{Mercury} = &amp; -\frac{GM}{r^2}\vec{n}+\vec{a}</em>{3-body}+\vec{a}<em>{PPN}+\vec{a}</em>{\eta_{DM}}\
	\ddot{\vec{R}}<em>{Earth} = &amp; -\frac{Gm}{R^2}\vec{N}+\vec{A}</em>{3-body}+\vec{A}<em>{PPN}+\vec{a}</em>{\eta_{DM}}
\end{align}
$$
which implies that the relative acceleration is  irrelevant to fifth interaction.</p>
<p>Actually according to  osculationg orbit method (Will), the 5 integral constants $p,e,\iota,\Omega,\omega$ are varied with time or true anomaly (first-order approximation)
$$
\begin{align}
	\frac{dp}{df}\simeq &amp; \frac{2p^2}{Gm}\frac{1}{(1+e\cos f)^3}\mathcal{S} \
	\frac{de}{df}\simeq &amp;\frac{p^2}{Gm}\left[ \frac{\sin f}{(1+e\cos f)^2}\mathcal{R} + \frac{2\cos f+e(1+\cos^2 f)}{(1+e\cos f)^3}\mathcal{S} \right] \
	\frac{d\iota}{df}\simeq &amp; \frac{p^2}{Gm}\frac{\cos(\omega+f)}{Gm(1+e\cos f)^3}\mathcal{W} \
	\sin \iota \frac{d\Omega}{df}\simeq &amp; \frac{p^2}{Gm}\frac{\sin(\omega+f)}{(1+e\cos f)^3}\mathcal{W} \
	\frac{d\omega}{df}\simeq &amp; \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} -e\cot\iota \frac{\sin(\omega+f)}{(1+e\cos f)^3}\mathcal{W} \bigg]\
\end{align}
$$
while the other physical quantities such as $r$, $A$  (the Runge-Lenz vector), $\dot{r}$ are all time equal to previous expressions
$$
\begin{align}
	A = &amp; e(t)\
	r = &amp; \frac{p(t)}{1+e(t)\cos f(t)}\
	\dot{r} = &amp; \sqrt{\frac{Gm}{p(t)}}e(t)\sin f(t)
\end{align}
$$
Therefore the integral constants are now
$$
\begin{align}
	p(f) = &amp; p+\Delta p\
	e(f) = &amp; e+ \Delta e\
	\iota(f) = &amp; \iota + \Delta l\
	\Omega(f) = &amp; \Omega+\Delta \Omega\
	\omega(f) = &amp; \omega+\Delta\omega\
\end{align}
$$
Then the coordinates projecting into $(X,Y,Z)$ are
$$
\begin{align}
	r^X = &amp; r\left[\cos\Omega\cos(\omega+f)-\cos\iota\sin\Omega\sin(\omega+f) \right]\
	r^Y = &amp; r\left[\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f) \right]\
	r^Z = &amp; r \sin\iota \sin(\omega+f)
\end{align}
$$
In addition, variable from $f$ to $t$ , the differential equation is
$$
\begin{align}
	\frac{df}{dt} = &amp; \sqrt{\frac{Gm}{p^3}}(1+e\cos f)^2 + \frac{1}{e}\sqrt{\frac{p}{Gm}}\left[ \cos f\mathcal{R} - \frac{2+e\cos f}{1+e\cos f}\sin f\mathcal{S} \right]
\end{align}
$$</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/09/Finite element methods/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/09/Finite element methods/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-09T21:27:16+08:00">
                2018-12-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>Chapter 1 Finite Element Construction</h1>
<p>有限元法是一种数值方法，在用来求解一般场的问题时，大致要经过如下几个步骤：</p>
<ol>
<li>寻找与原问题相适应的变分形式；</li>
<li>建立有限元子空间，即选择元素类型和相应的<strong><em>形状函数</em></strong>；</li>
<li>单元刚度矩阵、单元列阵的计算和总刚度矩阵、总列阵的合成；</li>
<li>边界条件的处理和有限元方程组求解；</li>
<li>回到实际问题中去。</li>
</ol>
<h2>1.1 Galerkin变分原理和Ritz变分原理</h2>
<p>以二维线性问题为例，考察问题
$$
\begin{align}
\left{
\begin{array}
	-\bigg[ \frac{\partial}{\partial x}\bigg( p(x,y) \frac{\partial u}{\partial x} \bigg) + \frac{\partial}{\partial y}\bigg( p(x,y) \frac{\partial u}{\partial y} \bigg) \bigg] = f(x,y)\
	u\bigg|<em>{\Gamma_1}= 0 \
	\bigg[ p(x,y)\frac{\partial u}{\partial n} +\sigma(x,y)u \bigg]</em>{\Gamma_2} = g(x,y)
\end{array}\right.
\end{align}
$$
其中$\Omega$是$R^2$中的连通区域，它的边界$\partial\Omega=\Gamma_1\cup\Gamma_2$分段光滑。$n$是$\partial\Omega$的外法线方向，$p(x,y)$一阶连续可导且$p(x,y)\geq p_0&gt;0$, $\sigma(x,y)$连续且$\sigma(x,y)\geq 0$。</p>
<p>用$C(\Omega)$记$\Omega$上一切$r$阶连续可导函数的全体。如果函数$u(x,y)\in C^2(\Omega)$，且在$\Omega$内及$\partial \Omega$上满足上述方程，那么称$u(x,y)$为定解问题的古典解。</p>
<p>以下讨论\eqref{1.1.1}​ 的弱解。在范数
$$
\begin{align}
	||u||^2_{1,\Omega} = \int\int_\Omega (u_x^2+u_y^2+u_z^2)dxdy
\end{align}
$$
下完备化$C^1(\Omega)$所得到的函数空间记为$H^1(\Omega)$，若引进内积	
$$
\begin{align}
	(u,v)<em>1 = \int\int</em>\Omega (u_xv_x+u_yv_y+uv)dxdy
\end{align}
$$
则$H^1(\Omega)$是Hilbert空间，这类Hilbert空间称之为<strong>一阶Sobolev空间</strong>。将$\Omega$上一切无限可微且支集在$\Omega$内函数的全体记为$D(\Omega)$，$D(\Omega)$在上述范数下完备化得到的空间记为$H_0^1(\Omega)$。</p>
<p>设$C_#^1(\Omega)={ v:v在\Omega内分片一阶连续可导，~ v\bigg|<em>{\Gamma_1} = 0 }$ ，$C^1</em>#(\Omega)$在范数下完备化所得到的空间等价于
$$
\begin{align}
	V = { v:v\in H^1(\Omega),~v\bigg|_{\Gamma_1} = 0 }
\end{align}
$$
在$V$上赋予内急，则$V$也是一个Hilbert空间，且
$$
\begin{align}
	H_0^1(\Omega)\subset V \subset H^1(\Omega)
\end{align}
$$</p>
<p>作双线性泛函
$$
\begin{align}
	B(u,v) = \int\int_\Omega (pu_xv_x+pu_yv_y)dxdy + \int_{\Gamma_2}\sigma uv ds,,~\forall u,, v\in H^1(\Omega),.
\end{align}
$$
可以证明这样的定义的$B(u,v)$具有以下性质：</p>
<ol>
<li>
<p>对称性，即：
$$
\begin{align}
	B(u,v)=B(v,u)
\end{align}
$$</p>
</li>
<li></li>
<li></li>
<li>
<p>在$V\times V$上连续。即存在一个常数$M&gt;0$，使得
$$
\begin{align}
	|B(u,v)|\leq M||u||<em>{1,\Omega}||v||</em>{1,\Omega},,~~\forall u,v\in V,.
\end{align}
$$</p>
</li>
</ol>
<ol start="3">
<li>在$V$上强制的，即存在常数$\gamma&gt;0$，使得
$$
\begin{align}
	B(u,u)\geq \gamma ||u||^2_{1,\Omega},,~~\forall \in V
\end{align}
$$</li>
</ol>
<p>显然
$$
\begin{align}
	f(v) = \int\int_\Omega fvdxdy + \int_{\Gamma_2}gvds
\end{align}
$$
是$v$的线性连续泛函。</p>
<p>原问题的Galerkin变分问题是：求$u\in V$，使得
$$
\begin{align}
	B(u,v) = f(v),,~~\forall v\in V,.
\end{align}
$$
满足上述的解$u$称为原问题的弱解，将弱解所在的空间称为容许空间，也称试探空间。同时，由于上面必须对$V$中任意元素$v$都要成立，故称$V$为检验空间。如果变分问题的容许空间和检验空间取同一个Hilbert空间$V$，这时又称为$V$为<strong>能量空间</strong>。</p>
<p>边界$\Gamma_2$上的条件称为<strong>自然边界条件</strong>。边界$\Gamma_1$上的条件称为编织边界条件，或称为<strong>强边界条件</strong>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/26/C++模板深度解析/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/26/C++模板深度解析/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-26T14:39:01+08:00">
                2018-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>引言</h1>
<p>在C++发明阶段，C++之父Stroustrup和贝尔实验室的C++小组对原先的宏方法进行了修订，对其进行了简化并将它从预处理范围移入了编译器。这种新的代码替换装置被称为模板，而且它变现了完全不同的代码重用方法：**模板对源代码重用，而不是通过继承和组合重用对象代码。**当用户使用模板时，参数由编译器来替换，这非常像原来的宏方法，却更清晰，更容易使用。</p>
<p>模板使类和函数可在编译时定义所需处理和返回的数据类型，一个模板并非一个实实在在的类或函数，仅仅<strong>是一个类和函数的描述</strong>。由于模板可以<strong>实现逻辑相同、数据类型不同的程序代码复制</strong>，所以使用模板机制可以减轻编程和维护的工作量和难度。<strong>模板一般分为模板函数和类模板</strong>。以所处理的数据类型的说明作为参数的类就叫<strong>类模板</strong>，或者<strong>模板类</strong>，而以所处理的数据类型的说明作为参数的函数，则称为<strong>函数模板</strong>。</p>
<p>本文包含函数模板和类模板，有些可能会交错设计两个模块的细节。</p>
<h1>函数模版</h1>
<p>函数模板定义了参数化的非成员函数，这使得程序员能够用不同类型的参数调用相同的函数，由编译器决定调用哪一种类型，并且从模板中生成相应的代码。</p>
<h2>定义</h2>
<p><strong>Template﹤类型参数表﹥返回类型 函数名 （形参表）{函数体}</strong></p>
<p>简单实例，调用函数打印字符串或数字等。</p>
<p>普通函数形式：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printstring</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; str)</span> </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; str &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">str</span><span class="params">(<span class="string">"Hello World"</span>)</span></span>;    </span><br><span class="line">    printstring(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">//输出：Hello World</span></span><br></pre></td></tr></table></figure></p>
<p>模板函数形式:</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">const</span> T&amp; var)</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; var &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">str</span><span class="params">(<span class="string">"Hello World"</span>)</span></span>;    </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> num=<span class="number">1234</span>;</span><br><span class="line">    print(str);</span><br><span class="line">    print(num);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：Hello World </span></span><br><span class="line"><span class="comment">//       1234</span></span><br></pre></td></tr></table></figure></p>
<p>可以看出使用模板后的函数不仅可以输出字符串形式还可以输出数字形式的内容。</p>
<p>上面两个例子介绍了函数模板的简单使用方法，但只有一个参数，如果需要多个参数，相应的函数模板应采用以下形式定义：</p>
<p><strong>Template﹤类型1 变量1，类型2 变量2 ，…﹥返回类型  函数名（形参表）{函数体}</strong></p>
<p>现在，为了看到模板时如何称为函数的，我们假定$min()$函数接受各种类型的参数，并找出其中的最小者，如果不采用模板技术，则只能接受一个特定类型的参数，如果希望也能接受其他类型的参数，就需要对每一种类型的参数都定义一个同功能的函数，其实为函数的重载，这里不在讨论，但这将是一件非常让人麻烦的事情。如：</p>
<p>普通定义：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="comment">// 定义多态函数，找出三个整数中最小的数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">min0</span><span class="params">(<span class="keyword">int</span> ii, <span class="keyword">int</span> jj, <span class="keyword">int</span> kk)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line">    <span class="keyword">if</span>((ii&lt;jj)&amp;&amp;(ii&lt;kk))&#123;temp=ii;&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((jj&lt;ii)&amp;&amp;(jj&lt;kk))&#123;temp=jj;    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;    temp=kk;    &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义多态函数，找出三个小数中最小的数</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">min1</span><span class="params">(<span class="keyword">float</span> ii, <span class="keyword">float</span> jj, <span class="keyword">float</span> kk)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> temp;</span><br><span class="line">    <span class="keyword">if</span>((ii&lt;jj)&amp;&amp;(ii&lt;kk))&#123;temp=ii;&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((jj&lt;ii)&amp;&amp;(jj&lt;kk))&#123;temp=jj;    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;    temp=kk;    &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义多态函数，找出三个子符中最小的字符</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">min2</span><span class="params">(<span class="keyword">char</span> ii, <span class="keyword">char</span> jj, <span class="keyword">char</span> kk)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> temp;</span><br><span class="line">    <span class="keyword">if</span>((ii&lt;jj)&amp;&amp;(ii&lt;kk))    &#123;temp=ii;    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((jj&lt;ii)&amp;&amp;(jj&lt;kk))&#123;temp=jj;&#125;    </span><br><span class="line">    <span class="keyword">else</span>&#123;temp=kk;&#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp1=min0(<span class="number">100</span>,<span class="number">20</span>,<span class="number">30</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;temp1&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">float</span> temp2=min1(<span class="number">10.60</span>,<span class="number">10.64</span>,<span class="number">53.21</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;temp2&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">char</span> temp3=min2(<span class="string">'c'</span>,<span class="string">'a'</span>,<span class="string">'C'</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;temp3&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//以换行形式输出20  10.6  C</span></span><br></pre></td></tr></table></figure></p>
<p>使用模板：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="comment">// 定义函数模板，找出三个值中最小的值，与数据类型无关</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">min</span>(<span class="title">T</span> <span class="title">ii</span>, <span class="title">T</span> <span class="title">jj</span>, <span class="title">T</span> <span class="title">kk</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    T temp;</span><br><span class="line">    <span class="keyword">if</span>((ii&lt;jj)&amp;&amp;(ii&lt;kk))&#123;temp=ii;&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((jj&lt;ii)&amp;&amp;(jj&lt;kk))&#123;temp=jj;&#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;    temp=kk; &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 下面是主函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;min(<span class="number">100</span>,<span class="number">20</span>,<span class="number">30</span>)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;min(<span class="number">10.60</span>,<span class="number">10.64</span>,<span class="number">53.21</span>)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;min(<span class="string">'c'</span>,<span class="string">'a'</span>,<span class="string">'C'</span>)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>输出结果同上，但可以清楚的看到二者之间的工作量大小之差距。</p>
<p>函数模板功能非常强大，但是有时候可能会陷入困境，假如<strong>待比较的函数模板没有提供正确的操作符</strong>，则程序不会对此进行编译。为了避免这种错误，可以使用<strong>函数模板和同名的非模板函数重载，这就是函数定制</strong>。函数模板与同名的非模板函数重载必须遵守以下规定：</p>
<ol>
<li>
<p>寻找一个参数完全匹配的函数，如有，则调用它</p>
</li>
<li>
<p>如果失败，寻找一个函数模板，使其实例化，产生一个匹配的模板函数，若有，则调用它</p>
</li>
<li>
<p>如果失败，再试低一级的对函数重载的方法，例如通过类型转换可产生的参数匹配等，</p>
<p>若找到匹配的函数，调用它</p>
</li>
<li>
<p>如果失败，则证明这是一个错误的调用</p>
</li>
</ol>
<p>现在用上例的模板函数比较两个字符串，但会出现问题:</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="comment">// 定义函数模板，找出三个值中最小的值，与数据类型无关</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">min</span>(<span class="title">T</span> <span class="title">ii</span>, <span class="title">T</span> <span class="title">jj</span>, <span class="title">T</span> <span class="title">kk</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    T temp;</span><br><span class="line">    <span class="keyword">if</span>((ii&lt;jj)&amp;&amp;(ii&lt;kk))&#123;     temp=ii; &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((jj&lt;ii)&amp;&amp;(jj&lt;kk))&#123; temp=jj; &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;    temp=kk;&#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;min(<span class="string">"anderson"</span>,<span class="string">"Washington"</span>,<span class="string">"Smith"</span>)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>输出anderson与实际结果不符，原因在于编译器会生成对字符串指针做比较的函数，但比较字符串和比较字符串指针是不一样的，为了解决此问题，我们可以定制函数模板，如：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// 定义函数模板，找出三个值中最小的值，与数据类型无关</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">min</span>(<span class="title">T</span> <span class="title">ii</span>, <span class="title">T</span> <span class="title">jj</span>, <span class="title">T</span> <span class="title">kk</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    T temp;</span><br><span class="line">    <span class="keyword">if</span>((ii&lt;jj)&amp;&amp;(ii&lt;kk))&#123;        temp=ii;    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((jj&lt;ii)&amp;&amp;(jj&lt;kk))&#123;        temp=jj;    &#125;</span><br><span class="line">    <span class="keyword">else</span>    &#123;        temp=kk;    &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//非模板函数重载</span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">min</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* ch1, <span class="keyword">const</span> <span class="keyword">char</span>* ch2,<span class="keyword">const</span> <span class="keyword">char</span>* ch3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* temp;</span><br><span class="line">    <span class="keyword">int</span> result1 = <span class="built_in">strcmp</span>(ch1,ch2);</span><br><span class="line">    <span class="keyword">int</span> result2 = <span class="built_in">strcmp</span>(ch1,ch3);</span><br><span class="line">    <span class="keyword">int</span> result3 = <span class="built_in">strcmp</span>(ch2,ch1);</span><br><span class="line">    <span class="keyword">int</span> result4 = <span class="built_in">strcmp</span>(ch2,ch3);</span><br><span class="line">    <span class="keyword">if</span>((result1&lt;<span class="number">0</span>)&amp;&amp;(result2&lt;<span class="number">0</span>))    &#123;        temp = ch1;    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((result3&lt;<span class="number">0</span>)&amp;&amp;(result4&lt;<span class="number">0</span>))    &#123;        temp=ch2;    &#125;</span><br><span class="line">    <span class="keyword">else</span>    &#123;        temp=ch3;    &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;min(<span class="number">100</span>,<span class="number">20</span>,<span class="number">30</span>)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;min(<span class="number">10.60</span>,<span class="number">10.64</span>,<span class="number">53.21</span>)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;min(<span class="string">'c'</span>,<span class="string">'a'</span>,<span class="string">'C'</span>)&lt;&lt;<span class="built_in">endl</span>;    </span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;min(<span class="string">"anderson"</span>,<span class="string">"Washington"</span>,<span class="string">"Smith"</span>)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在VS2010中，最后一行会输出Smith，与结果相符。 下面给出一个实例:</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> HEADER_MY_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADER_MY_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">fromString</span>(<span class="title">const</span> <span class="title">std</span>:</span>:<span class="built_in">string</span> &amp;s)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="function"><span class="built_in">istringstream</span> <span class="title">is</span><span class="params">(s)</span></span>;</span><br><span class="line">    T t;</span><br><span class="line">    is&gt;&gt;t;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">std</span>:</span>:<span class="function"><span class="built_in">string</span> <span class="title">toString</span><span class="params">(<span class="keyword">const</span> T &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">ostringstream</span> t;</span><br><span class="line">    t&lt;&lt;s;</span><br><span class="line">    <span class="keyword">return</span> t.str();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"header_my.h"</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;complex&gt; </span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1234</span>; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"i == \""</span> &lt;&lt; toString(i) &lt;&lt; <span class="string">"\"\n"</span>; </span><br><span class="line">    <span class="keyword">float</span> x = <span class="number">567.89</span>; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"x == \""</span> &lt;&lt; toString(x) &lt;&lt; <span class="string">"\"\n"</span>; </span><br><span class="line">    <span class="keyword">complex</span>&lt;<span class="keyword">float</span>&gt; c(<span class="number">1.0</span>, <span class="number">2.0</span>); </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"c == \""</span> &lt;&lt; toString(c) &lt;&lt; <span class="string">"\"\n"</span>; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">    i = fromString&lt;<span class="keyword">int</span>&gt;(<span class="built_in">string</span>(<span class="string">"1234"</span>)); </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"i == "</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">    x = fromString&lt;<span class="keyword">float</span>&gt;(<span class="built_in">string</span>(<span class="string">"567.89"</span>)); </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"x == "</span> &lt;&lt; x &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">    c = fromString&lt; <span class="keyword">complex</span>&lt;<span class="keyword">float</span>&gt; &gt;(<span class="built_in">string</span>(<span class="string">"(1.0,2.0)"</span>)); </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"c == "</span> &lt;&lt; c &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>模板实参推演</h2>
<p>当函数模板被调用时，<strong>对函数实参类型的检查决定了模板实参的类型和值的这个过程叫做模板实参推演</strong>。如**template <code>&lt;class T&gt;</code> void h(T a){}; h(1); h(0.2); ** 第一个调用因为实参是int型的，所以模板形参T被推演为int型，第二个T的类型则为double。</p>
<p>在使用函数模板时，请注意以下几点：</p>
<ol>
<li>
<p>在模板被实例化后，就会生成一个新的实例，这个<strong>新生成的实例不存在类型转换</strong>。比如有函数模板</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">void</span> <span class="title">H</span>(<span class="title">T</span> <span class="title">a</span>)&#123;</span>&#125;; </span><br><span class="line"><span class="keyword">int</span> a=<span class="number">2</span>; </span><br><span class="line"><span class="keyword">short</span> b=<span class="number">3</span>;</span><br><span class="line">H(a);</span><br><span class="line">H(b);</span><br></pre></td></tr></table></figure></p>
<p>第一个调用H(a)生成一个int型的实例版本，但是当调用H(b)的时候不会使用上次生成的int实例把short转换为int，而是会另外生成一个新的short型的实例。</p>
</li>
<li>
<p>在模板实参推演的过程中有时类型并不会完全匹配，这时编译器允许以下几种实参到模板形参的转换，这些转换不会生成新的实例。</p>
<p>2.1 数组到指针的转换或函数到指针的转换：比如template<code>&lt;class T&gt;</code> void h(T <em>a){}，int b[3]={1,2,3}；h(b);这时数组b和类型T</em> 不是完全匹配，但允许从数组到指针的转换，因此数组b被转换成int <em>，而类型形参T被转换成int，也就是说函数体中的T被替换成int。</em></p>
<p>2.2 <em>限制修饰符转换：即把const或volatile限定符加到指针上。比如template&lt;class T&gt; void h(const T</em> a){}，int b=3; h(&amp;b);虽然实参&amp;b与形参const T<em>不完全匹配，但因为允许限制修饰符的转换，结果就把&amp;b转换成const int</em> 。而类形型参T被转换成int。如果模板形参是非const类型，则无论实参是const类型还是非const类型调用都不会产生新的实例。</p>
<p>2.3 到一个基类的转换(该基类根据一个类模板实例化而来)：比如tessmplate<code>&lt;class T1&gt;</code> class A{}; template<code>&lt;class T1&gt;</code> class B:public A<code>&lt;T1&gt;</code>{}; template<code>&lt;class T2&gt;</code> void h(A<code>&lt;T2&gt;</code>&amp; m){}，在main函数中有B<code>&lt;int&gt;</code> n; h(n);函数调用的子类对象n与函数的形参A<code>&lt;T2&gt;</code>不完全匹配，但允许到一个基类的转换。在这里转换的顺序为，首先把子类对象n转换为基类对象A<code>&lt;int&gt;</code>，然后再用A<code>&lt;int&gt;</code>去匹配函数的形参A<code>&lt;T2&gt;</code>&amp;，所以最后T2被转换为int，也就是说函数体中的T将被替换为int。</p>
<p>2.4  对于函数模板而言不存在h(int,int)这样的调用，不能在函数调用的参数中指定模板形参的类型，对函数模板的调用应使用实参推演来进行，即只能进行h(2,3)这样的调用，或者int a, b; h(a,b)。</p>
</li>
</ol>
<p>模板实参推演实例，说明内容较长，采用注释形式，但代码较乱：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">void</span> <span class="title">h</span>(<span class="title">T</span> <span class="title">a</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt;<span class="string">" h()"</span> &lt;&lt; <span class="keyword">typeid</span>(T).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;  <span class="comment">//带有一个类型形参T的模板函数的定义方法，typeid(变量名).name()为测试变量类型的语句。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">void</span> <span class="title">k</span>(<span class="title">T</span> <span class="title">a</span>,<span class="title">T</span> <span class="title">b</span>)&#123;</span></span><br><span class="line">    T c;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">" k()"</span>&lt;&lt;<span class="keyword">typeid</span>(T).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125; <span class="comment">//注意语句T c。模板类型形参T可以用来声明变量，作为函数的返回类型，函数形参等凡是类类型能使用的地方。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt; <span class="title">void</span> <span class="title">f</span>(<span class="title">T1</span> <span class="title">a</span>, <span class="title">T2</span> <span class="title">b</span>)&#123;</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">" f()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()&lt;&lt;<span class="string">","</span>&lt;&lt;<span class="keyword">typeid</span>(T2).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;   <span class="comment">//定义带有两个类型形参T1，T2的模板函数的方法template&lt;class T&gt; void g(const T* a)&#123;T b;cout&lt;&lt;" g()"&lt;&lt;typeid(b).name()&lt;&lt;endl;&#125; </span></span><br><span class="line"><span class="comment">//template&lt;class T1,class T2=int&gt; void g()&#123;&#125;  //错误，默认模板类型形参不能用于函数模板，只能用于类模板上。</span></span><br><span class="line"><span class="comment">//main函数开始</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">// template&lt;class T&gt;void h()&#123;&#125; //错误，模板的声明或定义只能在全局，命名空间或类范围内进行。即不能在局部范围，函数内进行。</span></span><br><span class="line"><span class="comment">//函数模板实参推演示例。</span></span><br><span class="line"><span class="comment">// h(int); //错误，对于函数模板而言不存在h(int,int)这样的调用，不能在函数调用的参数中指定模板形参的类型，对函数模板的调用应使用实参推演来进行，即只能进行h(2,3)这样的调用，或者int a, b; h(a,b)。</span></span><br><span class="line"><span class="comment">//h函数形式为：template&lt;class T&gt;void h(T a)</span></span><br><span class="line">h(<span class="number">2</span>);<span class="comment">//输出" h() int"使用函数模板推演，在这里数值2为int型，所以把类型形参T推演为int型。</span></span><br><span class="line">h(<span class="number">2.0</span>);<span class="comment">//输出" h() double"，因为2.0为double型，所以将函数模板的类型形参推演为double型</span></span><br><span class="line"><span class="comment">//k函数形式为：template&lt;class T&gt;void k(T a,T b)</span></span><br><span class="line">k(<span class="number">2</span>,<span class="number">3</span>);<span class="comment">//输出" k() int"</span></span><br><span class="line"><span class="comment">//k(2,3.0);错误，模板形参T的类型不明确，因为k()函数第一个参数类型为int，第二个为double型，两个形参类型不一致。</span></span><br><span class="line"><span class="comment">//f函数的形式为：template&lt;class T1,class T2&gt; void f(T1 a, T2 b)</span></span><br><span class="line">f(<span class="number">3</span>,<span class="number">4.0</span>);<span class="comment">//输出" f() int,double"，这里不存在模板形参推演错误的问题，因为模板函数有两个类型形参T1和T2。在这里将T1推演为int，将T2推演为double。</span></span><br><span class="line"><span class="keyword">int</span> a=<span class="number">3</span>;<span class="keyword">double</span> b=<span class="number">4</span>;</span><br><span class="line">f(a,b); <span class="comment">//输出同上，这里用变量名实现推板实参的推演。</span></span><br><span class="line"><span class="comment">//模板函数推演允许的转换示例，g函数的形式为template&lt;class T&gt; void g(const T* a)</span></span><br><span class="line"><span class="keyword">int</span> a1[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;g(a1); <span class="comment">//输出" g() int"，数组的地址和形参const T*不完全匹配，所以将a1的地址T &amp;转换为const T*，而a1是int型的，所以最后T推演为int。</span></span><br><span class="line">g(&amp;b); <span class="comment">//输出" g() double",这里和上面的一样，只是把类型T转换为double型。</span></span><br><span class="line">h(&amp;b); <span class="comment">//输出" h() double *"这里把模参类型T推演为double *类型。</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>函数模板的显式实例化</h2>
<ol>
<li>隐式实例化：比如有模板函数template<code>&lt;class T&gt;</code> void h(T a){}。h(2)这时h函数的调用就是隐式实例化，即参数T的类型是隐式确定的。</li>
<li>函数模板显式实例化声明：其语法是：<strong>template 函数返回类型 函数名 <code>&lt;实例化的类型&gt;</code> (函数形参表)</strong>; 注意这是声明语句，要以分号结束。例如：template void h<code>&lt;int&gt;</code> (int a);这样就创建了一个h函数的int 实例。再如有模板函数template<code>&lt;class T&gt;</code> T h(T a){}，注意这里h函数的返回类型为T，显式实例化的方法为template int h<code>&lt;int&gt;</code>(int a); 把h模板函数实例化为int型。</li>
<li>对于给定的函数模板实例，显式实例化声明在一个文件中只能出现一次。</li>
<li>在显式实例化声明所在的文件中，函数模板的定义必须给出，如果定义不可见，就会发生错误。</li>
</ol>
<p>注意：不能在局部范围类显式实例化模板，实例化模板应放在全局范围内，即不能在main函数等局部范围中实例化模板。因为模板的声明或定义不能在局部范围或函数内进行。</p>
<h2>显式模板实参</h2>
<ol>
<li>显式模板实参：适用于函数模板，即在调用函数时显式指定要调用的实参的类型。</li>
<li>格式：显式模板实参的格式为在调用模板函数的时候在函数名后用<code>&lt;&gt;</code>尖括号括住要显示表示的类型，比如有模板函数template<code>&lt;class T&gt;</code> void h(T a, T b){}。则h<code>&lt;double&gt;</code>(2, 3.2)就把模板形参T显式实例化为double类型。</li>
<li>显式模板实参用于同一个模板形参的类型不一致的情况。比如template<code>&lt;class T&gt;</code> void h(T a, T b){}，则h(2, 3.2)的调用会出错，因为两个实参类型不一致，第一个为int 型，第二个为double型。而用h<code>&lt;double&gt;</code>(2, 3.2)就是正确的，虽然两个模板形参的类型不一致但这里把模板形参显式实例化为double类型，这样的话就允许进行标准的隐式类型转换，即这里把第一个int 参数转换为double类型的参数。</li>
<li>显式模板实参用法二：用于函数模板的返回类型中。例如有模板函数template<code>&lt;class T1, class T2, class T3&gt;</code> T1 h(T2 a, T3 b){}，则语句int a=h(2,3)或h(2,4)就会出现模板形参T1无法推导的情况。而语句int h(2,3)也会出错。用显式模板实参就能轻松解决这个问题，比如h<code>&lt;int, int, int&gt;</code>(2,3)即把模板形参T1实例化为int 型，T2和T3也实例化为int 型。</li>
<li>显式模板实参用法三：应用于模板函数的参数中没有出现模板形参的情况。比如template<code>&lt;class T&gt;</code>void h(){}如果在main函数中直接调用h函数如h()就会出现无法推演类型形参T的类型的错误，这时用显式模板实参就不会出现这种错误，调用方法为h<code>&lt;int&gt;</code>()，把h函数的模板形参实例化为int 型，从而避免这种错误。</li>
<li>显式模板实参用法四：用于函数模板的非类型形参。比如template<code>&lt;class T,int a&gt;</code> void h(T b){}，而调用h(3)将出错，因为这个调用无法为非类型形参推演出正确的参数。这时正确调用这个函数模板的方法为h<code>&lt;int, 3&gt;</code>(4)，首先把函数模板的类型形参T推演为int 型，然后把函数模板的非类型形参int a用数值3来推演，把变量a设置为3，然后再把4传递给函数的形参b，把b设置为4。注意，因为int a是非类型形参，所以调用非类型形参的实参应是编译时常量表达式，不然就会出错。</li>
<li>在使用显式模板实参时，我们只能省略掉尾部的实参。比如template<code>&lt;class T1, class T2, class T3&gt;</code> T1 h(T2 a, T3 b){}在显式实例化时h<code>&lt;int&gt;</code>(3, 3.4)省略了最后两个模板实参T2和T3，T2和T3由调用时的实参3和3.4隐式确定为int 型和double型，而T1被显示确定为int 型。h<code>&lt;int, , double&gt;``&lt;2,3.4&gt;</code>是错误的，只能省略尾部的实参。</li>
<li>显式模板实参最好用在存在二义性或模板实参推演不能进行的情况下。</li>
</ol>
<p>下面来看看实例：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">void</span> <span class="title">g1</span>(<span class="title">T</span> <span class="title">a</span>, <span class="title">T</span> <span class="title">b</span>)&#123;</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"hansu g1()"</span>&lt;&lt;<span class="keyword">typeid</span>(T).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>,<span class="title">class</span> <span class="title">T3</span>&gt;<span class="title">T1</span> <span class="title">g2</span>(<span class="title">T2</span> <span class="title">a</span>,<span class="title">T3</span> <span class="title">b</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    T1 c=a;<span class="built_in">cout</span>&lt;&lt;<span class="string">"hansug2()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()</span><br><span class="line">        &lt;&lt;<span class="keyword">typeid</span>(T2).name()&lt;&lt;<span class="keyword">typeid</span>(T3).name()&lt;&lt;<span class="built_in">endl</span>; <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt; <span class="title">void</span> <span class="title">g3</span> ( <span class="title">T1</span> <span class="title">a</span> ) &#123;</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"hansu g3()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()&lt;&lt;<span class="keyword">typeid</span>(T2).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">int</span> <span class="title">a</span>&gt; <span class="title">void</span> <span class="title">g4</span>(<span class="title">T1</span> <span class="title">b</span>, <span class="title">double</span> <span class="title">c</span>)&#123;</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"hansu g4()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()&lt;&lt;<span class="keyword">typeid</span>(a).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt; <span class="title">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">    	<span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//模板显示实例化示例。</span></span><br><span class="line"><span class="comment">//因为模板的声明或定义不能在局部范围或函数内进行。所以模板实例化都应在全局范围内进行。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> <span class="keyword">void</span> g1&lt;<span class="keyword">double</span>&gt;(<span class="keyword">double</span> a,<span class="keyword">double</span> b); <span class="comment">//把函数模板显示实例化为int型。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span>&lt;double,double&gt;;</span> <span class="comment">//显示实例化类模板，注意后面没有对象名，也没有&#123;&#125;大括号。</span></span><br><span class="line"><span class="comment">//template class A&lt;int,int&gt;&#123;&#125;;  //错误，显示实例化类模板后面不能有大括号&#123;&#125;。</span></span><br><span class="line"><span class="comment">//template class A&lt;int,int&gt; m;  //错误，显示实例化类模板后面不能有对象名。</span></span><br><span class="line"><span class="comment">//main函数开始</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//显示模板实参示例。显示模板实参适合于函数模板</span></span><br><span class="line"><span class="comment">//1、显示模板实参用于同一个模板形参的类型不一致的情况。函数g1形式为template&lt;class T&gt;void g1(T a, T b)</span></span><br><span class="line">g1&lt;<span class="keyword">double</span>&gt;(<span class="number">2</span>,<span class="number">3.2</span>);<span class="comment">//输出"hansu g1() int"两个实参类型不一致，第一个为int第二个为double。但这里用显示模板实参把类型形参T指定为double，所以第一个int型的实参数值2被转换为double类型。</span></span><br><span class="line"><span class="comment">//g1(2,3.2);错误，这里没有用显式模板实参。所以两个实参类型不一致。</span></span><br><span class="line"><span class="comment">//2、用于函数模板的反回类型中。函数g2形式为template&lt;class T1,class T2,class T3&gt; T1 g2(T2 a,T3 b)</span></span><br><span class="line"><span class="comment">//g2(2,3);错误，无法推演类型形参T1。</span></span><br><span class="line"><span class="comment">//int g2(2,3);错误，不能以这种方法试图推导类型形参T1为int型。</span></span><br><span class="line"><span class="comment">//int a=g2(2,3);错误，以这种方式试图推演出T1的类型为int也是错误的。</span></span><br><span class="line">g2&lt;<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>&gt;(<span class="number">2</span>,<span class="number">3</span>);<span class="comment">//正确，将T1，T2，T3 显示指定为int型。输出"hansu g2() intintint"</span></span><br><span class="line"><span class="comment">//3、应用于模板函数的参数中没有出现模板形参的情况其中包括省略的用法，函数g3的形式为template&lt;class T1,class T2&gt; void g3(T1 a)</span></span><br><span class="line"><span class="comment">//g3(2);错误，无法为函数模板的类型形参T2推演出正确的类型</span></span><br><span class="line"><span class="comment">//g3(2,3);错误，岂图以这种方式为T2指定int型是错误的，因为函数只有一个参数。</span></span><br><span class="line"><span class="comment">//g3&lt;,int&gt;(2);错误，这里起图用数值2来推演出T1为int型,而省略掉第一个的显示模板实参，这种方法是错误的。在用显示模板实参时，只能省略掉尾部的实参。</span></span><br><span class="line"><span class="comment">//g3&lt;int&gt;(2);错误，虽然用了显示模板实参方法，省略掉了尾部的实参，但该方法只是把T1指定为int型，仍然无法为T2推演正确的类型。</span></span><br><span class="line">g3&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;(<span class="number">2</span>);<span class="comment">//正确，显示指定T1和T2的类型都为int型。</span></span><br><span class="line"><span class="comment">//4、用于函数模板的非类型形参。g4函数的形式为template&lt;class T1,int a&gt; void g4(T1 b,double c)</span></span><br><span class="line"><span class="comment">//g4(3,3.2);错误，虽然指定了两个参数，但是这里仍然无法为函数模板的非类型形参int a推演出正确的实参。因为第二个函数参数x.2是传递给函数的参数double c的，而不是函数模板的非类型形参int a。</span></span><br><span class="line"><span class="comment">//g4(3,2);错误，起图以整型值把实参传递给函数模板的非类型形参是不行的，这里数值2会传递给函数形参double c并把int型转换为double型。所以非类型形参int a仍然无实参。</span></span><br><span class="line"><span class="comment">//int d=1; g4&lt;int ,d &gt;(3,3.2); //错误，调用方法正确，但对于非类型形参要求实参是一个常量表达式，而局部变量c是非常量表达式，不能做为非类型形参的实参，所以错误。</span></span><br><span class="line">g4&lt;<span class="keyword">int</span>,<span class="number">1</span>&gt;(<span class="number">2</span>,<span class="number">3.2</span>);<span class="comment">//正确，用显示模板实参，把函数模板的类型形参T1设为int型，把数值1传给非类型形参int a，并把a设为1，把数值2 传给函数的第一个形参T1 b并把b设为2，数值?.2传给函数的第二个形参double c并把c设为?.2。</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> d=<span class="number">1</span>; g4&lt;<span class="keyword">int</span>,d&gt;(<span class="number">2</span>,<span class="number">3.2</span>);<span class="comment">//正确，这里变量d是const常量，能作为非类型形参的实参，这里参数的传递方法同上面的语句。</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>显式具体化(模板特化，模板说明) 和函数模板的重载</h2>
<p>具体化或特化或模板说明指的是一个意思，就是把模板特殊化，比如有模板template<code>&lt;class T&gt;</code>void h(T a){}，这个模板适用于所有类型，但是有些特殊类型不需要与这个模板相同的操作或者定义，比如int 型的h实现的功能和这个模板的功能不一样，这样的话我们就要重定义一个h模板函数的int版本，即特化版本。</p>
<h3>特化函数模板：</h3>
<p>显式特化格式为：<strong>template<code>&lt;&gt;</code> 返回类型函数名<code>&lt;要特化的类型&gt;</code>(参数列表) {函数体}</strong>，显式特化以template<code>&lt;&gt;</code>开头，表明要显式特化一个模板，在函数名后<code>&lt;&gt;</code>用尖括号括住要特化的类型版本。比如template <code>&lt;class T&gt;</code> void h(T a){}，其int 类型的特化版本为template<code>&lt;&gt;</code> void h<code>&lt;int&gt;</code>(int a){}，当出现int 类型的调用时就会调用这个特化版本，而不会调用通用的模板，比如h(2)，就会调用int 类型的特化版本。</p>
<p>如果可以从实参中推演出模板的形参，则可以省略掉显示模板实参的部分。比如：template<code>&lt;&gt;</code> void h(int a){}。注意函数h后面没有<code>&lt;&gt;</code>符号，即显式模板实参部分。</p>
<p>对于返回类型为模板形参时，调用该函数的特化版本必须要用显式模板实参调用，如果不这样的话就会出现其中一个形参无法推演的情况。如template<code>&lt;class T1,class T2,class T3&gt;</code> T1 h(T2 a,T3 b){}，有几种特化情况：
情况一：template<code>&lt;&gt;</code> int h<code>&lt;int,int&gt;</code>(int a, in b){}该情况下把T1，T2，T3的类型推演为int 型。在主函数中的调用方式应为h<code>&lt;int&gt;</code>(2,3)。</p>
<p>情况二：template<code>&lt;&gt;</code> int h(int a, int b){}，这里把T2,T3推演为int 型，而T1为int 型，但在调用时必须用显式模板实参调用，且在<code>&lt;&gt;</code>尖括号内必须指定为int 型，不然就会调用到通用函数模板，如h<code>&lt;int&gt;</code>(2,3)就会调用函数模板的特化版本，而h(2,3)调用会出错。h<code>&lt;double&gt;</code>(2,3)调用则会调用到通用的函数模板版本。</p>
<p>这几种情况的特化版本是错误的，如template<code>&lt;&gt;</code> T1 h(int a,int b){}，这种情况下T1会成为不能识别的名字，因而出现错误，template<code>&lt;&gt;</code> int h<code>&lt;double&gt;</code>(int a,int b){}在这种情况下返回类型为int 型，把T1确定为int 而尖括号内又把T1确定为double型，这样就出现了冲突。</p>
<p>具有相同名字和相同数量返回类型的非模板函数(即普通函数)，也是函数模板特化的一种情况，这种情况将在后面参数匹配问题时讲解。</p>
<h3>特化类模板：</h3>
<p>特化整个类模板：比如有template<code>&lt;class T1,class T2&gt;</code> class A{}; 其特化形式为<strong>template<code>&lt;&gt;</code> class A<code>&lt;int, int&gt;</code>{};</strong> 特化形式以template<code>&lt;&gt;</code>开始，这和模板函数的形式相同，在类名A后跟上要特化的类型。</p>
<p>在类特化的外部定义成员的方法：比如template<code>&lt;class T&gt;</code> class A{public: void h();};类A特化为template<code>&lt;&gt;</code> class A<code>&lt;int&gt;</code>{public: void h();};在类外定义特化的类的成员函数h的方法为：void A<code>&lt;int&gt;</code>::h(){}。在外部定义类特化的成员时应省略掉template<code>&lt;&gt;</code>。</p>
<p>类的特化版本应与类模板版本有相同的成员定义，如果不相同的话那么当类特化的对象访问到类模板的成员时就会出错。因为当调用类的特化版本创建实例时创建的是特化版本的实例，不会创建类模板的实例，特化版本如果和类的模板版本的成员不一样就有可能出现这种错误。比如：模板类A中有成员函数h()和f()，而特化的类A中没有定义成员函数f()，这时如果有一个特化的类的对象访问到模板类中的函数f()时就会出错，因为在特化类的实例中找不到这个成员。</p>
<p>类模板的部分特化：比如有类模板template<code>&lt;class T1, class T2&gt;</code> class A{};则部分特化的格式为template<code>&lt;class T1&gt;</code> class A<code>&lt;T1, int&gt;</code>{};将模板形参T2特化为int 型，T1保持不变。部分特化以template开始，在<code>&lt;&gt;</code>中的模板形参是不用特化的模板形参，在类名A后面跟上要特化的类型。如果要特化第一个模板形参T1，则格式为template<code>&lt;class T2&gt;</code> class A<code>&lt;int, T2&gt;</code>{};部分特化的另一用法是template<code>&lt;class T1&gt;</code> class A<code>&lt;T1,T1&gt;</code>{};将模板形参T2也特化为模板形参T1的类型。</p>
<p>在类部分特化的外面定义类成员的方法：比如有部分特化类template<code>&lt;class T1&gt;</code> class A<code>&lt;T1,int&gt;</code>{public: void h();};则在类外定义的形式为template<code>&lt;class T1&gt;</code> void A<code>&lt;T1,int&gt;</code>::h(){}。注意当在类外面定义类的成员时template 后面的模板形参应与要定义的类的模板形参一样，这里就与部分特化的类A的一样template<code>&lt;class T1&gt;</code>。</p>
<p>可以对模板的特化版本只进行声明，而不定义。比如template<code>&lt;&gt;</code> void h<code>&lt;int&gt;</code>(int a);注意，声明时后面有个分号。</p>
<p>在调用模板实例之前必须要先对特化的模板进行声明或定义。一个程序不允许同一模板实参集的同一模板既有显式特化又有实例化。比如有模板template<code>&lt;class T&gt;</code> void h(T a){}在h(2)之前没有声明该模板的int 型特化版本，而是在调用该模板后定义该模板的int 型特化版本，这时程序不会调用该模板的特化版本，而是调用该模板产生一个新的实例。这里就有一个问题，到底是调用由h(2)产生的实例版本呢还是调用程序中的特化版本。</p>
<p>注意：因为模板的声明或定义不能在局部范围或函数内进行。所以特化类模板或函数模板都应在全局范围内进行。</p>
<p>在特化版本中模板的类型形参是不可见的。比如template<code>&lt;&gt;</code> void h<code>&lt;int,int&gt;</code>(int a,int b){T1 a;}就会出现错误，在这里模板的类型形参T1在函数模板的特化版本中是不可见的，所以在这里T1是未知的标识符，是错误的。</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//函数模板特化和类模板特化示例</span></span><br><span class="line"><span class="comment">//定义函数g1，g2和类A</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt; <span class="title">void</span> <span class="title">g1</span>(<span class="title">T1</span> <span class="title">a</span>,<span class="title">T2</span> <span class="title">b</span>)&#123;</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"g1"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>,<span class="title">class</span> <span class="title">T3</span>&gt;<span class="title">T1</span> <span class="title">g2</span>(<span class="title">T2</span> <span class="title">a</span>,<span class="title">T3</span> <span class="title">b</span>)&#123;</span></span><br><span class="line">    <span class="keyword">int</span> c=<span class="number">1</span>;<span class="built_in">cout</span>&lt;&lt;<span class="string">"g2"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>,<span class="title">class</span> <span class="title">T3</span>&gt;<span class="title">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:<span class="function"><span class="keyword">void</span> <span class="title">h</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//函数模板的特化定义。函数模板的特化可以理解为函数模板重载的另一种形式。</span></span><br><span class="line"><span class="comment">//下式为g1的类型形参显示指定其类型，把T1，T2在模板实参的尖括号中设为int型。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="keyword">void</span> g1&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;(<span class="keyword">int</span> a,<span class="keyword">int</span> b)&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"g1一"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下式显示设定g1的类型形参T1，并设为int型，T2由函数参数double推演为double型。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="keyword">void</span> g1&lt;<span class="keyword">int</span>&gt;(<span class="keyword">int</span> a,<span class="keyword">double</span> b)&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"g1二"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">g1</span><span class="params">(<span class="keyword">double</span> a,<span class="keyword">double</span> b)</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"g1三"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125; <span class="comment">//g1的类型形参都由g1的形参推演出来。</span></span><br><span class="line"><span class="comment">//template&lt;&gt; void g1&lt;int&gt;(double a,int b)&#123;cout&lt;&lt;"g•一"&lt;&lt;endl;&#125;  //错误，在显示模板实参的尖括号中显示把类型形参T1的类型设为int型，而又在函数的形参中把类型形参T1的类型推演为double型，这样就发生了冲突，出现错误。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; <span class="keyword">int</span> g2&lt;<span class="keyword">int</span>&gt;(<span class="keyword">int</span> a,<span class="keyword">int</span> b)&#123;</span><br><span class="line">    <span class="keyword">int</span> c=<span class="number">1</span>;<span class="built_in">cout</span>&lt;&lt;<span class="string">"g2一"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;<span class="function"><span class="keyword">double</span> <span class="title">g2</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c=<span class="number">1</span>;<span class="built_in">cout</span>&lt;&lt;<span class="string">"g2二"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注意，下式正确，该式并不是对函数模板g2的部分特化，而是g2的重载。</span></span><br><span class="line"><span class="comment">//template&lt;class T2&gt; int g2(int a, T2 b)&#123;int c=1;cout&lt;&lt;"g2三"&lt;&lt;endl;return c;&#125;</span></span><br><span class="line"><span class="comment">//下式错误，函数反回类型和&lt;double&gt;尖括号中的double类型不同，发生冲突。</span></span><br><span class="line"><span class="comment">//template&lt;&gt; int g2&lt;double&gt;(int a,int b)&#123;int c=1;cout&lt;&lt;"two"&lt;&lt;endl;return c;&#125; </span></span><br><span class="line"><span class="comment">//下式错误，函数模板的类型形参在特化版本中是不可见的，也就是说这里的会把类型形参T1理解为未声明的标识符</span></span><br><span class="line"><span class="comment">//template&lt;&gt; T1 g2&lt;int&gt;(int a,int b)&#123;int c=1;cout&lt;&lt;"two"&lt;&lt;endl;return c;&#125; </span></span><br><span class="line"><span class="comment">//类模板的特化和部分特化</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;<span class="class"><span class="keyword">class</span> <span class="title">A</span>&lt;int,int,int&gt;&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:<span class="function"><span class="keyword">void</span> <span class="title">h</span><span class="params">()</span></span>;</span><br><span class="line">&#125;<span class="comment">//特化整个类模板的格式，注意类名后的尖括号中必须指定所有的类模板的类型形参。</span></span><br><span class="line"><span class="comment">//template&lt;&gt; class A&lt;int&gt;&#123;&#125;; //错误，在特化的类名后的尖括号中指定的类模板类型形参的数量不够。要想只特化其中一个类模板的类型形参，就要使用类模板的部分特化。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T3</span>&gt;<span class="title">class</span> <span class="title">A</span>&lt;T1,double,T3&gt;&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:<span class="function"><span class="keyword">void</span> <span class="title">h</span><span class="params">()</span></span>;</span><br><span class="line">&#125;<span class="comment">//特化T2，而T1和T?不特化，注意尖括号中的类型形参是不特化的形参。</span></span><br><span class="line"><span class="comment">//在类模板的特化或部分特化版本的外部定义成员函数的方法。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> A&lt;<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>&gt;::h()&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class A tehua"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125; <span class="comment">/*  T1 c; 错误，在特化版本中模板的类型形参是不可见的，也就是说在这里</span></span><br><span class="line"><span class="comment">T1是未声明的标识符。*/</span></span><br><span class="line"><span class="comment">//template&lt;&gt; void A&lt;int,int,int&gt;::h()&#123;&#125; //错误，在类模板的特化版本外面定义类模板的成员时应省略掉template&lt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T3</span>&gt;<span class="title">void</span> <span class="title">A</span>&lt;T1,double,T3)::h()&#123;</span></span><br><span class="line"><span class="class">    cout&lt;&lt;"class A bute"&lt;&lt;endl;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">template&lt;class T1,class T2,class T3&gt;void A&lt;T1,T2,T3&gt;::h()&#123;</span></span><br><span class="line"><span class="class">    cout&lt;&lt;"class A putong"&lt;&lt;endl;</span></span><br><span class="line"><span class="class">&#125; //定义普通类模板中的成员函数。</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">//main函数开始</span></span><br><span class="line"><span class="class">int main()</span></span><br><span class="line"><span class="class">&#123;   //特化的函数模板的调用方式。</span></span><br><span class="line"><span class="class">    g1(2,2); //输出"g1一"，调用函数模板g1的第一个特化版本template&lt;&gt; void g1&lt;int,int&gt;(int a,int b)&#123;cout&lt;&lt;"g1一"&lt;&lt;endl;&#125;</span></span><br><span class="line"><span class="class">    g1(2,3.2); //输出"g1二"，调用函数模板g1的第二个特化版本template&lt;&gt; void g1&lt;int&gt;(int a,double b)&#123;cout&lt;&lt;"g1二"&lt;&lt;endl;&#125;</span></span><br><span class="line"><span class="class">    g1(3.3,4.4); //输出"g1三"，调用函数模板g1的第三个特化版本template&lt;&gt; void g1(double a,double b)&#123;cout&lt;&lt;"g1三"&lt;&lt;endl;&#125;</span></span><br><span class="line"><span class="class">    g1&lt;double&gt;(3,2.3);//输出"g1三"，这里用显示模板实参把第一个实参指定为double型，这样g1的两个实参都是double型，所以将调用g1的第三个特化版本。</span></span><br><span class="line"><span class="class">    //g2(3,3); 错误，在调用反回类型为类型形参的时候必须用显示模板实参的形式为反回类型的形参显示指定类型。在这里就会出现无法为T1确定类型的情况。</span></span><br><span class="line"><span class="class">    g2&lt;int&gt;(2,3);//正确，把g2的类型形参T1设显示指定为int，调用g2的第一个特化版本。template&lt;&gt; int g2&lt;int&gt;(int a,int b)&#123;int c=1;cout&lt;&lt;"g2一"&lt;&lt;endl;return c;&#125;</span></span><br><span class="line"><span class="class">    g2&lt;double&gt;(2,3);//正确，把g2的类型形参T1设显示指定为double，调用g2的第二个特化版本。template&lt;&gt; double g2(int a,int b)&#123;int c=1;cout&lt;&lt;"g2二"&lt;&lt;endl;return c;&#125;</span></span><br><span class="line"><span class="class">    g2&lt;char&gt;(2,3);//正确，把g2的类型形参T1设显示指定为char，对于char版本的g2函数没有特化版本，因此调用g2的通用版本。</span></span><br><span class="line"><span class="class">    //    template&lt;class T1,class T2,class T3&gt;T1 g2(T2 a,T3 b) &#123;int c=1;cout&lt;&lt;"g2"&lt;&lt;endl;return c;&#125;</span></span><br><span class="line"><span class="class">   // 类模板特化和部分特化的调用。</span></span><br><span class="line"><span class="class">     A&lt;int,int,int&gt; m1; m1.h();//正确，调用类模板的特化版本。</span></span><br><span class="line"><span class="class">     A&lt;int,double,int&gt; m; m.h(); //正确，调用类模板的部分特化版本。</span></span><br><span class="line"><span class="class">           //A&lt;int,int&gt; m2; //错误，类模板有三个类型形参，这里只提供了两个，数量不够，错误。</span></span><br><span class="line"><span class="class">     A&lt;double,double,int&gt; m3; m3.h();//调用类A的部分特化版本。</span></span><br><span class="line"><span class="class">     A&lt;double,int,int&gt; m4; m4.h();//调用类A的普通版本，在这里没有A&lt;double,int,int&gt;型的特化或者部分特化版本可用。</span></span><br><span class="line"><span class="class">     return 0;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2>函数模板重载（函数定制）：</h2>
<p><strong>函数模板可以重载</strong>，注意<strong>类模板不存在重载问题</strong>，也就是说出现这两条语句时template<code>&lt;class T&gt;</code>class A{};template<code>&lt;classT1,class T2&gt;</code>class A{};将出错。</p>
<p>模板函数重载的形式为：template<code>&lt;class T&gt;</code> void h(T a, int b){}。Template<code>&lt;class T&gt;</code>void h(T a, double b){}等。</p>
<p>重载模板函数要注意二义性问题，比如template<code>&lt;class T&gt;</code> void h(T a, int b){}和template<code>&lt;class T&gt;</code>void h(T a, T b){}这两个版本就存在二义性问题，当出现语句h(2,3)时就不知道调用哪个才正确，在程序中应避免这种情况出现。</p>
<p>重载函数模板的第二个二义性问题是template<code>&lt;class T&gt;</code>void h(T a, T b){}与template<code>&lt;class T1, class T2&gt;</code>void h(T1 a,T2 b){}，当出现h(2,4)这样的调用时就会出现二义性。解决这个问题的方法是使用显式模板实参，比如要调用第一个h函数，可以使用语法h<code>&lt;int&gt;</code>(2,3)，调用第二个h函数的方法为h<code>&lt;int, int&gt;</code>(2,3)。</p>
<p>函数模板的特化也可以理解为函数模板重载的一种形式。只是特化以template<code>&lt;&gt;</code>开始。</p>
<p>重载的特殊情况：比如template<code>&lt;class T1,class T2&gt;</code> void h(T1 a, T2 b){}，还有个版本如template<code>&lt;class T1&gt;</code>void h(T1 a, int b){}这里两个函数具有两同的名字和相同的形参数量，但形参的类型不同，可以认为第二个版本是第一个版本的重载版本。</p>
<p>函数模板的重载和特化很容易混淆，因为特化很像是一个函数的重载版本，只是开头以template<code>&lt;&gt;</code>开始而已。</p>
<h1>类模板</h1>
<p>在此之前我们来看看模板的形参。因为函数模板的参数相对比较简单，故将此内容放置于类模板中。模板形参有三种类型：<strong>类型形参、非类型形参和模板形参</strong>。先分别解释如下：</p>
<ol>
<li>
<p>类型形参。即由关键字class 或 typename后接的说明符构成，如template <code>&lt;class T&gt;</code>void function(T a);其中T就是类型形参。类型形参的名字由用户自定义，只要是合法的标识符即可。</p>
</li>
<li>
<p>非类型形参。模板的非类型形参也就是内置类型形参，如template<code>&lt;class T,int a&gt;</code>class B{};其中int a就是非类型形参。非类型形参在模板定义的内部是常量值，也就是说非类型形参在模板内部是常量。使用非类型形参应注意以下几点：</p>
<p>2.1  <strong>非类型形参只能是整型、指针和引用</strong>。如：double,string,string *等都是不允许的，但是double &amp; ,double 是正确的。</p>
<p>2.2 <strong>调用非类型模板形参的实参必须是一个常量表达式</strong>，即在编译时就能确定其结果。任何局部对象、局部变量、局部变量地址、局部对象地址等都不是一个常量表达式，都不能用作非类型模板形参的实参。全局指针类型、全局变量、全局对象也不是一个常量表达式，不能用作非类型形参的实参。但全局变量的地址、全局对象的地址或应用const类型的变量时常量表达式，可用作非类型模板形参的实参。Sizeof表达式的结果也是一个常量表达式，同样也可以用作非类型模板形参的实参。如：Template &lt;class T,int a&gt;class A{};如果有int b，这时A&lt;int,b&gt; m;就会出错，因为b不是常量，如果有const int b;这时A&lt;int ,b&gt;就是正确的。</p>
<p>2.3 非类型形参一般不用于函数模板中。比如有函数模板template &lt;class T,int a&gt;void h(T,b){};若使用h(2)调用就会出错，无法为非类型形参a推演出参数的错误。对这种函数模板可以采用显示模板实参来解决，如h&lt;int ,3&gt;(2)，这样就把非类型形参a设置为整数3。显示模板参数将在后面介绍。</p>
<p>2.4 <strong>非类型模板形参和实参间允许转换</strong>。具体如下；
(1) 允许从数组到指针，从函数到指针的转换。如template &lt;int *a&gt;class A{};int c[1];A&lt;c&gt;m。
(2) Const修饰符的转换。如template &lt;const int *a&gt;class A{};int c;A&lt;&amp;c&gt;m;即从int 到const int 的转换。
(3) 提升转换。如template &lt;int a&gt; class A{};const short c;A&lt;c&gt;m;即从short到int的提升转换。
(4) 整值转换。如template &lt;unsigned int a&gt; class A{};A&lt;3&gt; m;即从int到unsigned int的转换。</p>
</li>
<li>
<p><strong>可以为类模板的类型形参提供默认值，但不能为函数模板的类型形参提供默认值</strong>。函数模板和类模板都可以为模板的非类型形参提供默认值。如template <code>&lt;class T1,class T2=int&gt;</code>class A{};为第二个模板类型形参提供int型的默认值。</p>
</li>
<li>
<p>类模板的类型形参默认值和函数的默认参数一样，如果有多个类型形参则从第一个设定了默认值之后所有的模板形参都应设定默认值。如template <code>&lt;class T1=int,class T2&gt;</code>class D{};就是错误的，因为没有给T2设定默认值。但在外部定义类中的成员时，应省去默认的形参类型。如template <code>&lt;class T1,class T2=int&gt;</code>class A{public:void H();};定义方法是template <code>&lt;class T1,class T2&gt;</code>void A<code>&lt;T1,T2&gt;</code>::H(){};</p>
</li>
</ol>
<p>现将以上小节总结于以下一例，并通过vs2010调试，请读者仔细相关知识点的应用。</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//模板的声明或定义只能在全局，命名空间或类范围内进行。即不能在局部范围，函数内进行，比如不能在main函数中声明或定义一个模板。</span></span><br><span class="line"><span class="comment">//类模板的定义</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function">T <span class="title">g</span><span class="params">(T a, T b)</span></span>; A();</span><br><span class="line">&#125;;  <span class="comment">//定义带有一个类模板类型形参T的类A</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt;<span class="title">class</span> <span class="title">B</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>;</span><br><span class="line">&#125;; <span class="comment">//定义带有两个类模板类型形参T1，T2的类B</span></span><br><span class="line"><span class="comment">//定义类模板的默认类型形参，默认类型形参不适合于函数模板。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>=<span class="title">int</span>&gt; <span class="title">class</span> <span class="title">D</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>: </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>;</span><br><span class="line">&#125;; <span class="comment">//定义带默认类型形参的类模板。这里把T2默认设置为int型。</span></span><br><span class="line"><span class="comment">//template&lt;class T1=int, class T2&gt;class E&#123;&#125;; //错误，为T1设了默认类型形参则T1后面的所有形参都必须设置认默值。</span></span><br><span class="line"><span class="comment">//以下为非类型形参的定义</span></span><br><span class="line"><span class="comment">//非类型形参只能是整型，指针和引用，像double，String, String **这样的类型是不允许的。但是double &amp;，double *对象的引用或指针是正确的。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">int</span> <span class="title">a</span>&gt; <span class="title">class</span> <span class="title">Ci</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>;</span><br><span class="line">&#125;; <span class="comment">//定义模板的非类型形参，形参为整型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">int</span> &amp;<span class="title">a</span>&gt;<span class="title">class</span> <span class="title">Cip</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">A</span>&lt;int&gt;* <span class="title">m</span>&gt; <span class="title">class</span> <span class="title">Cc</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>;</span><br><span class="line">&#125;; <span class="comment">//定义模板的模板类型形参，形参为int型的类A的对象的指针。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">double</span>*<span class="title">a</span>&gt;<span class="title">class</span> <span class="title">Cd</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;  <span class="comment">//定义模板的非类型形参，形参为double类型的引用。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span>&#123;</span>&#125;; </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">E</span> &amp;<span class="title">m</span>&gt; <span class="title">class</span> <span class="title">Ce</span>&#123;</span>&#125;; </span><br><span class="line"><span class="comment">//非类型模板形参为对象的引用。</span></span><br><span class="line"><span class="comment">//以下非类型形参的声明是错误的。</span></span><br><span class="line"><span class="comment">//template&lt;class T1,A m&gt;class Cc&#123;&#125;; //错误，对象不能做为非类型形参，非类型模板形参的类型只能是对象的引用或指针。</span></span><br><span class="line"><span class="comment">//template&lt;class T1,double a&gt;class Cc&#123;&#125;; //错误，非类型模板的形参不能是double类型，可以是double的引用。</span></span><br><span class="line"><span class="comment">//template&lt;class T1,A&lt;int&gt; m&gt;class Cc&#123;&#125;; //错误，非类型模板的形参不能是对象，必须是对象的引用或指针。这条规则对于模板型参也不例外。</span></span><br><span class="line"><span class="comment">//在类模板外部定义各种类成员的方法，</span></span><br><span class="line"><span class="comment">//typeid(变量名).name()的作用是提取变量名的类型，如int a，则cout&lt;&lt;typeid(a).name()将输出int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;   <span class="title">A</span>&lt;T&gt;:</span>:A()&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class A goucao"</span>&lt;&lt;<span class="keyword">typeid</span>(T).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125; <span class="comment">//在类模板外部定义类的构造函数的方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">T</span> <span class="title">A</span>&lt;T&gt;:</span>:g(T a,T b)&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class A g(T a,T b)"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125; <span class="comment">//在类模板外部定义类模板的成员</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt;  <span class="title">void</span> <span class="title">B</span>&lt;T1,T2&gt;:</span>:g()&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class g f()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()&lt;&lt;<span class="keyword">typeid</span>(T2).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在类外面定义类的成员时template后面的模板形参应与要定义的类的模板形参一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">int</span> <span class="title">a</span>&gt;     <span class="title">void</span> <span class="title">Ci</span>&lt;T1,a&gt;:</span>:g()&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class Ci g()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">int</span> &amp;<span class="title">a</span>&gt;    <span class="title">void</span> <span class="title">Cip</span>&lt;T1,a&gt;:</span>:g()&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class Cip g()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//在类外部定义类的成员时，template后的模板形参应与要定义的类的模板形参一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">A</span>&lt;int&gt; *<span class="title">m</span>&gt; <span class="title">void</span> <span class="title">Cc</span>&lt;T1,m&gt;:</span>:g()&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class Cc g()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">double</span>* <span class="title">a</span>&gt; <span class="title">void</span> <span class="title">Cd</span>&lt;T1,a&gt;:</span>:g()&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class Cd g()"</span>&lt;&lt;<span class="keyword">typeid</span>(T1).name()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//带有默认类型形参的模板类，在类的外部定义成员的方法。</span></span><br><span class="line"><span class="comment">//在类外部定义类的成员时，template的形参表中默认值应省略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt;  <span class="title">void</span> <span class="title">D</span>&lt;T1,T2&gt;:</span>:g()&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"class D g()"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//template&lt;class T1,class T2=int&gt; void D&lt;T1,T2&gt;::g()&#123;cout&lt;&lt;"class D k()"&lt;&lt;endl;&#125; //错误，在类模板外部定义带有默认类型的形参时，在template的形参表中默认值应省略。</span></span><br><span class="line"><span class="comment">//定义一些全局变量。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> e=<span class="number">2</span>;  <span class="keyword">double</span> ed=<span class="number">2.2</span>; <span class="keyword">double</span>*pe=&amp;ed;</span><br><span class="line">A&lt;<span class="keyword">int</span>&gt; mw; A&lt;<span class="keyword">int</span>&gt; *pec=&amp;mw; E me;</span><br><span class="line"><span class="comment">//main函数开始</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">// template&lt;class T&gt;void h()&#123;&#125; //错误，模板的声明或定义只能在全局，命名空间或类范围内进行。即不能在局部范围，函数内进行。</span></span><br><span class="line">    <span class="comment">//A&lt;2&gt; m; //错误，对类模板不存在实参推演问题，类模板必须在尖括号中明确指出其类型。</span></span><br><span class="line">    <span class="comment">//类模板调用实例</span></span><br><span class="line">    A&lt;<span class="keyword">int</span>&gt; ma; <span class="comment">//输出"class A goucao int"创建int型的类模板A的对象ma。</span></span><br><span class="line">    B&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; mb; mb.g(); <span class="comment">//输出"class B g() int int"创建类模板B的对象mb，并把类型形参T1和T2设计为int</span></span><br><span class="line">    <span class="comment">//非类型形参的调用</span></span><br><span class="line">    <span class="comment">//调用非类型模板形参的实参必须是一个常量表达式，即他必须能在编译时计算出结果。任何局部对象，局部变量，局部对象的地址，局部</span></span><br><span class="line">    <span class="comment">//变量的地址都不是一个常量表达式，都不能用作非类型模板形参的实参。全局指针类型，全局变量，全局对象也不是一个常量表达式，不能</span></span><br><span class="line">    <span class="comment">//用作非类型模板形参的实参。</span></span><br><span class="line">    <span class="comment">//全局变量的地址或引用，全局对象的地址或引用const类型变量是常量表达式，可以用作非类型模板形参的实参。</span></span><br><span class="line">    <span class="comment">//调用整型int型非类型形参的方法为名为Ci，声明形式为template&lt;class T1,int a&gt; class Ci        Ci&lt;int,GHIJKLMJKLNOPQMII//正确，数值R是一个int型常量，输出"class Ci g() int"</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> a2=<span class="number">3</span>;Ci&lt;<span class="keyword">int</span>,a2&gt; mci1; mci1.g(); <span class="comment">//正确，因为a2在这里是const型的常量。输出"class Ci g() int"</span></span><br><span class="line">    <span class="comment">//Ci&lt;int,a&gt; mci; //错误，int型变量a是局部变量，不是一个常量表达式。</span></span><br><span class="line">    <span class="comment">//Ci&lt;int,e&gt; mci; //错误，全局int型变量e也不是一个常量表达式。</span></span><br><span class="line">    <span class="comment">//调用int&amp;型非类型形参的方法类名为Cip，声明形式为template&lt;class T1,int &amp;a&gt;class Cip</span></span><br><span class="line">    Cip&lt;<span class="keyword">int</span>,e&gt; mcip;  <span class="comment">//正确，对全局变量的引用或地址是常量表达式。</span></span><br><span class="line">    <span class="comment">//Cip&lt;int,a&gt; mcip1; //错误，局部变量的引用或地址不是常量表达式。</span></span><br><span class="line">    <span class="comment">//调用double*类型的非类形形参类名为Cd，声明形式为template&lt;class T1,double *a&gt;class Cd</span></span><br><span class="line">    Cd&lt;<span class="keyword">int</span>,&amp;ed&gt; mcd; <span class="comment">//正确，全局变量的引用或地址是常量表达式。</span></span><br><span class="line">    <span class="comment">//Cd&lt;int,pe&gt; mcd1; //错误，全局变量指针不是常量表达式。</span></span><br><span class="line">    <span class="comment">//double dd=aNGMIITbULcdefbbHIJKbgMIhh错误，局部变量的地址不是常量表达式，不能用作非类型形参的实参</span></span><br><span class="line">    <span class="comment">//Cd&lt;int,&amp;e&gt; mcd;  //错误，非类型形参虽允许一些转换，但这个转换不能实现。</span></span><br><span class="line">    <span class="comment">//调用模板类型形参对象A&lt;int&gt; *的方法类名为Cc，声名形式为template&lt;class T1,A&lt;int&gt;* m&gt; class Cc</span></span><br><span class="line">    Cc&lt;<span class="keyword">int</span>,&amp;mw&gt; mcc; mcc.g(); <span class="comment">//正确，全局对象的地址或者引用是常量表达式</span></span><br><span class="line">    <span class="comment">//Cc&lt;int,&amp;ma&gt; mcc;  //错误，局部变量的地址或引用不是常量表达式。</span></span><br><span class="line">    <span class="comment">//Cc&lt;int,pec&gt; mcc2;  //错误，全局对象的指针不是常量表达式。</span></span><br><span class="line">    <span class="comment">//调用非类型形参E&amp;对象的引用的方法类名为Ce。声明形式为template&lt;class T1,E &amp;m&gt; class Ce</span></span><br><span class="line">    E me1; <span class="comment">//Ce&lt;int,me1&gt; mce1; //错误，局部对象不是常量表达式</span></span><br><span class="line">    Ce&lt;<span class="keyword">int</span>,me&gt; mce;  <span class="comment">//正确，全局对象的指针或引用是常量表达式。</span></span><br><span class="line">    <span class="comment">//非类型形参的转换示例，类名为Ci</span></span><br><span class="line">    <span class="comment">//非类型形参允许从数组到指针，从函数到指针的转换，const修饰符的转换，提升转换，整值转换，常规转换。</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">short</span> s=<span class="number">3</span> ;</span><br><span class="line">    Ci&lt;<span class="keyword">int</span>,s&gt; mci ;<span class="comment">//正确，虽然short型和int不完全匹配，但这里可以将short型转换为int型</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>与函数模板相同，类模板的声明语句也必须至于类声明的前面。有两个以上模板参数时，应使用逗号分开。使用含类模板的类定义对象时也必须在类名的后面带上“﹤实际类型﹥”的参数列表。类模板最常用于各种类包容关系的设计模型中。</p>
<h2>定义</h2>
<p><strong>Template ﹤类型参数表﹥ class 类名 {类声明体}</strong></p>
<p>在使用类模板时，应注意以下几点：</p>
<ol>
<li>在所有出现类模板的地方不能直接用类名表示，都应加上﹤…﹥</li>
<li>在类模板定义体中，可以省略﹤…﹥</li>
<li>一个类模板的各个实例之间没有特殊的联系（形成一个独立的类）如：Queue<code>&lt;int&gt;</code> qi 和Queue<code>&lt;string&gt;</code> qs，分别表示整数队列和字符队列</li>
<li>实例化时机：在需要时实例化，比如定义指针或引用是不需要实例化，定义具体的变量或常量时会实例化，而访问对象的成员时会实例化。如 Queue<code>&lt;int&gt;</code> *q //不实例化Queue<code>&lt;&gt;</code> ,Queue<code>&lt;int&gt;</code> iq //实例化Queue<code>&lt;&gt;</code>，iq-&gt;<code>add(2) //实例化Queue</code>&lt;&gt;`</li>
<li>类模板的显式实例化：和函数模板的显式实例化一样都是以template开始。比如template class A<code>&lt;int,int&gt;</code>;将类A显式实例化为两个int型的类模板。这里要注意显式实例化后面不能有对象名，且以分号结束。显式实例化可以让程序员控制模板实例化发生的时间。</li>
</ol>
<h2>类模板中的友元：</h2>
<ol>
<li>
<p>非模板函数、类成为所有实例类的友元。如：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Class Foo &#123; </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">Type</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">Class</span> <span class="title">QueueItem</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">         Friend <span class="class"><span class="keyword">class</span> <span class="title">Foobar</span>;</span>  <span class="comment">//类Foobar不需要先定义或声明，并没有&lt;&gt;</span></span><br><span class="line">         <span class="function">Frined <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>;    <span class="comment">//函数foo（）</span></span><br><span class="line">         Frined <span class="keyword">void</span> Foo::bar();<span class="comment">//类Foo必须先定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>模板函数、模板类成为同类型实例类的友元。如：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">Type</span>&gt; <span class="title">class</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    …</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">Type</span>&gt; <span class="title">void</span> <span class="title">foo</span>(<span class="title">QueueItem</span>&lt;Type&gt;);</span></span><br><span class="line"></span><br><span class="line">Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">Type</span>&gt; <span class="title">class</span> <span class="title">Queue</span>&#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">Type</span>&gt; <span class="title">class</span> <span class="title">QueueItem</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">         Friend <span class="class"><span class="keyword">class</span> <span class="title">Foo</span>&lt;Type&gt;;</span>  <span class="comment">//模板类Foo需要先定义或声明，并带有&lt;&gt;</span></span><br><span class="line">         <span class="function">Friend <span class="keyword">void</span> <span class="title">foo</span><span class="params">(QueueItem&lt;Type&gt;)</span></span>; <span class="comment">//模板函数foo()需要先定义或声明</span></span><br><span class="line">         Friend <span class="keyword">void</span> Queue&lt;Type&gt;::bar();   <span class="comment">//模板类Queue必须先定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>模板函数、模板类成为不同类型实例类的友元。如：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">class</span> <span class="title">QueueItem</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">         Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">Type</span>&gt; <span class="title">friend</span> <span class="title">class</span> <span class="title">Foo</span>;</span></span><br><span class="line">         Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">Type</span>&gt; <span class="title">friend</span> <span class="title">void</span> <span class="title">foo</span>(<span class="title">QueueItem</span>&lt;Type&gt;);</span></span><br><span class="line">         Template &lt;<span class="class"><span class="keyword">class</span> <span class="title">Type</span>&gt; <span class="title">friend</span> <span class="title">void</span> <span class="title">Queue</span>:</span>:bar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>类模板中有普通友元函数，友元类，模板友元函数和友元类。</p>
</li>
<li>
<p>可以建立两种类模板的友元模板，即约束型的友元模板和非约束型的友元模板。</p>
</li>
<li>
<p>非约束型友元模板：即类模板的友元模板类或者友元模板函数的任一实例都是外围类的任一实例的友元，也就是外围类和友元模板类或友元模板函数之间是多对多的关系</p>
</li>
<li>
<p>约束型友元模板：即类模板的友元模板类或友元模板函数的一个特定实例只是外围类的相关的一个实例的友元。即外围类和友元模板类或友元模板函数之间是一对一的关系。</p>
</li>
<li>
<p>约束型友元模板函数或友元类的建立：比如有前向声明：template<code>&lt;class T1&gt;</code> void g(T1 a); template<code>&lt;class T2&gt;</code> void g1(); template<code>&lt;class T3&gt;</code>class B;则template<code>&lt;class T&gt;</code>class A{friend void g<code>&lt;&gt;</code>(T a); friend void g1<code>&lt;T&gt;</code>(); friend class B<code>&lt;T&gt;</code>;};就建立了三个约束型友元模板，其中g和g1是函数，而B是类。注意其中的语法。这里g<code>&lt;int&gt;</code>型和类A<code>&lt;int&gt;</code>型是一对一的友元关系，g<code>&lt;double&gt;</code>和A<code>&lt;double&gt;</code>是一个一对一的友元关系。</p>
</li>
<li>
<p>非约束型友元模板函数或友元类的建立：非约束型友元模板和外围类具有不同的模板形参，比如template<code>&lt;class T&gt;</code>class A{template<code>&lt;class T1&gt;</code> friend void g(T1 a); template<code>&lt;class T2&gt;</code> friend class B;}注意其中的语法，非约束型友元模板都要以template开头。要注意友元模板类，在类名B的后面没有尖括号。</p>
</li>
<li>
<p>不存在部分约束型的友元模板或者友元类：比如template<code>&lt;class T&gt;</code> class A{template<code>&lt;class T1&gt;</code>friend void g(T1 a, T b);</p>
<p>template<code>&lt;class T3&gt;</code>friend class B<code>&lt;T3,T&gt;</code>;}其中函数g具有template<code>&lt;class T1,class T2&gt;</code>void g(T1 a,T2 b)的形式。其中的函数g试图把第二个模板形参部分约束为类A的模板形参类型，但是这是无效的，这种语法的结果是g函数的非约束型类友元函数，而对类B的友元声明则是一种语法错误。</p>
</li>
</ol>
<h2>类模板中的模板成员(模板函数,模板类)和静态成员</h2>
<ol>
<li>
<p>类模板中的模板函数和模板类的声明：与普通模板的声明方式相同，即都是以template 开始</p>
</li>
<li>
<p>在类模板外定义类模板中的模板成员的方法：比如template<code>&lt;class T1&gt;</code> class A {public:template<code>&lt;class T2&gt;</code> class B; template<code>&lt;class T3&gt;</code> void g(T3 a);};则在类模板外定义模板成员的方法为,template<code>&lt;class T1&gt;</code> template<code>&lt;class T2&gt;</code> class A<code>&lt;T1&gt;</code>::B{};定义模板函数的方法为：template<code>&lt;class T1&gt;</code>template<code>&lt;class T3&gt;</code> void A<code>&lt;T1&gt;</code>::g(T3 a){}其中第一个template指明外围类的模板形参，第二个template指定模板成员的模板形参，而作用域解析运算符指明是来自哪个类的成员。</p>
</li>
<li>
<p>实例化类模板的模板成员函数：比如上例中要实例化函数g()则方法为, A<code>&lt;int&gt;</code> m; m.g(2);这里外围类A的模板形参由尖括号中指出，而类中的模板函数的参数由整型值2推演出为int 型。</p>
</li>
<li>
<p>创建类模板中的模板成员类的对象的方法：比如上例中要创建模板成员类B的方法为，A<code>&lt;int&gt;</code>::B<code>&lt;int&gt;</code>m1；A<code>&lt;int&gt;</code>::B<code>&lt;doble&gt;</code>m2; A<code>&lt;double&gt;</code>::B<code>&lt;int&gt;</code> m3;在类模板成员B的前面要使用作用域解析运算符以指定来自哪个外围类，并且在尖括号中要指定创建哪个外围类的实例的对象。这里说明在类模板中定义模板类成员时就意味意该外围模板类的一个实例比如int 实例将包含有多个模板成员类的实例。比如这里类A的int 实例就有两个模板成员类B的int 和double两个实例版本。</p>
</li>
<li>
<p>要访问类模板中的模板成员类的成员遵守嵌套类的规则，因为类模板中的模板成员类就是一个嵌套类。即外围类和嵌套类中的成员是相互独立的，要访问其中的成员只能通过嵌套类的指针，引用或对象的方式来访问。具体情况见嵌套类部分。</p>
</li>
<li>
<p>类模板中的静态成员是类模板的所有实例所共享的。</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt; <span class="title">class</span> <span class="title">A</span>&#123;</span><span class="keyword">public</span>:<span class="keyword">int</span> a,b; <span class="keyword">static</span> <span class="keyword">int</span> e;&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T3</span>,<span class="title">class</span> <span class="title">T4</span>&gt; <span class="title">class</span> <span class="title">B</span>;</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T5</span>,<span class="title">class</span> <span class="title">T6</span>&gt; <span class="title">void</span> <span class="title">g</span>(<span class="title">T5</span> <span class="title">a</span>,<span class="title">T6</span> <span class="title">b</span>);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>&#123;</span><span class="keyword">public</span>:<span class="function"><span class="keyword">void</span> <span class="title">gc</span><span class="params">()</span></span>&#123;<span class="built_in">cout</span>&lt;&lt;<span class="string">"class C gc()"</span>&lt;&lt;<span class="built_in">endl</span>;&#125;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g1</span><span class="params">()</span></span>&#123;<span class="built_in">cout</span>&lt;&lt;<span class="string">"putong g1()"</span>&lt;&lt;<span class="built_in">endl</span>;&#125; &#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>,<span class="title">class</span> <span class="title">T2</span>&gt;<span class="title">template</span>&lt;class T3,class T4&#125;class A&lt;T1,T2&gt;::B&#123;public:void gb()&#123;cout&lt;&lt;"moban class B gb()"&lt;&lt;endl;&#125;&#125;</span></span><br><span class="line"><span class="class">//在类模板外面定义类模板的模板成员类的方法</span></span><br><span class="line"><span class="class">template&lt;class T1,class T2&gt;template&lt;class T5,class T6&#125;void A&lt;T1,T2&gt;::g(T5 a,T6 b)&#123;cout&lt;&lt;"moban g()"&lt;&lt;endl;&#125;//在类模板外面定义类模板的模板成员函数的方法</span></span><br><span class="line"><span class="class">template&lt;class T1,class T2&gt; int A&lt;T1,T2&gt;::e=0;//在类模板外面定义静态成员的方法。</span></span><br><span class="line"><span class="class">int main()</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="class">    A&lt;int,int&gt; ma;</span></span><br><span class="line"><span class="class">    ma.g(2,3);//创建模板类中模板成员函数的方法，在这里模板类A的模板形参被设为int，而模板成员函数的模板形参则由两个int型的整    数推演为int型。</span></span><br><span class="line"><span class="class">    ma.e=1; A&lt;int,int&gt;::e=2;  //把类模板A的int,int型实例的静态成员设为。</span></span><br><span class="line"><span class="class">    cout&lt;&lt;"ma.e="&lt;&lt;ma.e&lt;&lt;endl; </span></span><br><span class="line"><span class="class">    A&lt;int,double&gt; ma1;</span></span><br><span class="line"><span class="class">    cout&lt;&lt;"ma.e="&lt;&lt;ma1.e&lt;&lt;A&lt;int,int&gt;::e&lt;&lt;A&lt;int,double&gt;::e&lt;&lt;endl; //因为类模板A的int,int型实例和int,double实例是两个实例，所以这里的静态常量e的值不是三个二。</span></span><br><span class="line"><span class="class">    A&lt;int,int&gt;::B&lt;int,int&gt; mb;  //声明模板类中模板成员类的方法。</span></span><br><span class="line"><span class="class">    mb.gb();//调用嵌套类B的成员函数</span></span><br><span class="line"><span class="class">    //mb.g(); //错误，函数g()是外围类的成员，嵌套类不能访问外围类的成员</span></span><br><span class="line"><span class="class">    return 0;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">简单模板实例，参数列表为基本类型：</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">#include&lt;iostream.h&gt;</span></span><br><span class="line"><span class="class">template&lt;class T&gt;</span></span><br><span class="line"><span class="class">class Array</span></span><br><span class="line"><span class="class">&#123;    T *ar;</span></span><br><span class="line"><span class="class">public:</span></span><br><span class="line"><span class="class">        Array(int c)&#123;ar=new T[c];&#125;</span></span><br><span class="line"><span class="class">void init(int n,T x)&#123;ar[n]=x;    &#125;</span></span><br><span class="line"><span class="class">    T&amp; operator[](int n)&#123;return ar[n];&#125;</span></span><br><span class="line"><span class="class">&#125;;</span></span><br><span class="line"><span class="class">void main()</span></span><br><span class="line"><span class="class">&#123; </span></span><br><span class="line"><span class="class">    Array&lt;int&gt; array(5);</span></span><br><span class="line"><span class="class">    cout&lt;&lt;"Please input every element's value:"&lt;&lt;endl;</span></span><br><span class="line"><span class="class">    for(int i=0;i&lt;5;i++)</span></span><br><span class="line"><span class="class">    &#123; </span></span><br><span class="line"><span class="class">        cout&lt;&lt;"No."&lt;&lt;i+1&lt;&lt;':';  </span></span><br><span class="line"><span class="class">        cin&gt;&gt;array[i];  </span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">类模板参数是类：</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span>   </span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A()&#123;&#125;</span><br><span class="line">    A(<span class="keyword">int</span> x):j(x)&#123;&#125;</span><br><span class="line">    A(A *x)&#123;j=x-&gt;j;&#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="keyword">operator</span>!()&#123;<span class="built_in">cout</span>&lt;&lt;<span class="string">"J="</span>&lt;&lt;j&lt;&lt;<span class="built_in">endl</span>;&#125;</span><br><span class="line">&#125;; </span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">&#123;</span>  </span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">     T *x;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B(<span class="keyword">int</span> xa,T *p):i(xa)&#123;x=<span class="keyword">new</span> T(p);&#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="keyword">operator</span>!()&#123;<span class="built_in">cout</span>&lt;&lt;<span class="string">"I="</span>&lt;&lt;i&lt;&lt;<span class="built_in">endl</span>;!*x;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">A <span class="title">a</span><span class="params">(<span class="number">1</span>)</span></span>;        <span class="comment">//最后的显示结果为：</span></span><br><span class="line">    B&lt;A&gt; b(<span class="number">2</span>,&amp;a);  <span class="comment">//I=2</span></span><br><span class="line">    !b;           <span class="comment">//J=1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Typename的使用：</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">class</span> <span class="title">X</span> </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">    <span class="keyword">typename</span> T::id i; <span class="comment">//如无typename看看情况如何</span></span><br><span class="line"><span class="keyword">public</span>: <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            i.g();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Y</span> </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line"><span class="keyword">public</span>: <span class="class"><span class="keyword">class</span> <span class="title">id</span> </span></span><br><span class="line"><span class="class">        &#123;</span> </span><br><span class="line">            <span class="keyword">public</span>: <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">                    </span>&#123;</span><br><span class="line">                        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"Hello World!"</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                    &#125; </span><br><span class="line">        &#125;; </span><br><span class="line">&#125;; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="comment">//Y y;</span></span><br><span class="line">    X&lt;Y&gt; xy; </span><br><span class="line">    xy.f(); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Typename关键字告诉编译器把一个特殊的名字解释成一个类型，在下列情况下必须对一个name使用typename关键字：</p>
<ol>
<li>一个唯一的name（可以作为类型理解），嵌套在另一个类型中。</li>
<li>依赖于一个模板参数，就是说，模板参数在某种程度上包含这个name。当模板参数使编译器在指认一个类型时便会产生误解。</li>
</ol>
<p>在定义模板时，typename和class作用基本相同，至于二者的其他关系没有什么区别，仅是历史原因，typename仅是一个新生代。</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">复杂的模板类实例：</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> number;</span><br><span class="line">    <span class="keyword">static</span> Student *ip;</span><br><span class="line">    Student *p;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Student()&#123;p=<span class="literal">NULL</span>;&#125;</span><br><span class="line">    Student(<span class="keyword">int</span> n);</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Student* <span class="title">get_first</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> ip;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_number</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>-&gt;number;&#125;</span><br><span class="line">    <span class="function">Student* <span class="title">get_next</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>-&gt;p;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Student::Student(<span class="keyword">int</span> n):number(n)  <span class="comment">//依据学号的大小顺序将学生对象插入链表</span></span><br><span class="line">&#123;</span><br><span class="line">    p=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(ip==<span class="literal">NULL</span>)ip=<span class="keyword">this</span>;  <span class="comment">//如果是第一个则使头指针指向该对象</span></span><br><span class="line">    <span class="keyword">else</span>&#123;Student *temp=ip;      </span><br><span class="line">    <span class="keyword">if</span>(n&lt;ip-&gt;number)&#123;ip=<span class="keyword">this</span>;p=temp;&#125;<span class="comment">//如学号小于第一个学生对象的学号则使头指针指向该对象</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(temp)</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(n&lt;temp-&gt;p-&gt;number)</span><br><span class="line">            &#123;</span><br><span class="line">                p=temp-&gt;p;  <span class="comment">//链中间对象的插入</span></span><br><span class="line">                temp-&gt;p=<span class="keyword">this</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> </span><br><span class="line">            &#123;    </span><br><span class="line">                <span class="keyword">if</span>(temp-&gt;p-&gt;p==<span class="literal">NULL</span>)  <span class="comment">//最后一个链的插入</span></span><br><span class="line">                &#123;</span><br><span class="line">                    temp-&gt;p-&gt;p=<span class="keyword">this</span>;<span class="keyword">break</span>;</span><br><span class="line">                &#125;                    &#125;</span><br><span class="line">            temp=temp-&gt;p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Student* Student::ip=<span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Class</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    T *p;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">       Class()&#123;&#125;</span><br><span class="line">       Class(<span class="keyword">int</span> n):num(n)&#123;p=<span class="literal">NULL</span>;&#125;</span><br><span class="line">       <span class="function">T* <span class="title">insert</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;p=<span class="keyword">new</span> T(n);<span class="keyword">return</span> p;&#125;</span><br><span class="line">       <span class="function"><span class="keyword">void</span> <span class="title">list_all_member</span><span class="params">(T* x)</span></span></span><br><span class="line"><span class="function">       </span>&#123;   T *temp=x;</span><br><span class="line">       <span class="keyword">while</span>(temp) &#123; <span class="built_in">cout</span>&lt;&lt;temp-&gt;get_number()&lt;&lt;<span class="string">","</span>;temp=temp-&gt;get_next();&#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    Class&lt;Student&gt; x97x(<span class="number">9707</span>);</span><br><span class="line">    x97x.insert(<span class="number">23</span>);</span><br><span class="line">    x97x.insert(<span class="number">12</span>);</span><br><span class="line">    x97x.insert(<span class="number">38</span>);</span><br><span class="line">    x97x.insert(<span class="number">22</span>);</span><br><span class="line">    x97x.insert(<span class="number">32</span>);</span><br><span class="line">    x97x.list_all_member(Student::get_first());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>模板根据参数的类型进行实例化</h2>
<p>现在来讨论模板安全：模板根据参数的类型进行实例化。因为通常事先不知道其具体类型，所以也无法确切知道将在哪儿产生异常。程序员需要知道程序在什么地方发生了异常。下面看一个简单的模板类：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Template &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">Class Wrapper</span><br><span class="line">&#123;</span><br><span class="line">Public:</span><br><span class="line">         Wrapper()&#123;&#125;</span><br><span class="line">         <span class="function">T <span class="title">get</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> value_;&#125;</span><br><span class="line">         <span class="function">T <span class="title">set</span><span class="params">(T <span class="keyword">const</span> &amp;value)</span></span>&#123;value_=value;&#125;</span><br><span class="line">Private:</span><br><span class="line">         T value_;</span><br><span class="line">         Wrapper(Wrapper <span class="keyword">const</span> &amp;);</span><br><span class="line">         Wrapper &amp;<span class="keyword">operator</span>=(Wrapper <span class="keyword">const</span> &amp;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>实例化过程很简单，如Wrapper <code>&lt;int&gt;</code> i；因为Wrapper <code>&lt;int&gt;</code>只接受int或其引用，所以不会触及异常，Wrapper <code>&lt;int&gt;</code>不抛异常，也没有直接或者间接调用任何可能抛异常的函数，因此Wrapper <code>&lt;int&gt;</code>是异常安全的。</p>
<p>现在再来看Wrapper<code>&lt;X&gt;</code>x,这里X是一个类。在这个定义里，编译器实例化了：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Template &lt;&gt; Class Wrapper&lt;X&gt;</span><br><span class="line">&#123;</span><br><span class="line">Public:</span><br><span class="line">         Wrapper()&#123;&#125;</span><br><span class="line">         <span class="function">X <span class="title">get</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> value_;&#125;</span><br><span class="line">         <span class="function">X <span class="title">set</span><span class="params">(X <span class="keyword">const</span> &amp;value)</span></span>&#123;value_=value;&#125;</span><br><span class="line">Private:</span><br><span class="line">         T value_;</span><br><span class="line">         Wrapper(Wrapper <span class="keyword">const</span> &amp;);</span><br><span class="line">         Wrapper &amp;<span class="keyword">operator</span>=(Wrapper <span class="keyword">const</span> &amp;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>现在就有问题出现了：</p>
<ol>
<li>Wrapper<code>&lt;X&gt;</code> 包含了一个X的子对象。这个子对象需要构造，意味着调用X的构造函数，这个构造函数可能抛出异常。</li>
<li>Wrapper<code>&lt;X&gt;</code>::get()产生并返回了一个X的临时对象。为了这个临时对象，get()调用了X的拷贝构造函数，这个函数可能抛出异常。</li>
<li>Wrapper<code>&lt;X&gt;</code>::set()执行了表达式value_=value，他实际上调用了X的赋值运算。这个运算可能抛出异常。</li>
</ol>
<p>可以看到，同样的模板和同样的语句，但其含义不同。由于这样的不确定性，我们需要采用保守策略：假设Wrapper会根据类来实例化，而这些类在其成员上没有进行异常规格申明，则他们可能抛出异常。</p>
<p>再假设Wrapper的异常规格申明承诺其成员不产生异常。至少必须在其成员上加上异常规格申明throw()，所以需要修补掉这些可能导致异常的地方：</p>
<ol>
<li>在Wrapper：：Wrapper()中构造value_的过程。</li>
<li>在Wrapper::get()中返回value_的过程。</li>
<li>在Wrapper::set()中队value_的赋值过程。</li>
</ol>
<p>另外，在违背throw()的异常规格申明是，还要处理std::unexpected.</p>
</li>
</ol>
<p>再来看默认构造函数：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Wrapper() <span class="keyword">throw</span>()</span><br><span class="line">Try:T() &#123;&#125;</span><br><span class="line">Catch (…)&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>虽然看上去不错，但它不能工作，根据C++标准：对构造函数或析构函数上的function-try-block，当控制权到达了异常处理函数的结束点是，被捕获的异常被再次抛出。对于一般的函数，此时是函数返回，等同于没有返回值的return 语句，对于定了返回类型的函数此时的行为未定义。换句话说，上面的程序相当于：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X::X() <span class="keyword">throw</span>()</span><br><span class="line">Try: T ()&#123;&#125;</span><br><span class="line">Catch (…)&#123; <span class="keyword">throw</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p>这不是程序本来想要的结果，换成以下代码：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X::X() <span class="keyword">throw</span>()</span><br><span class="line">Try: T ()&#123;&#125;</span><br><span class="line">Catch (…)&#123; <span class="keyword">return</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p>但是它却违背了标准：如果在构造函数上的function-try-block的异常处理函数体中出现了return语句，则程序是病态的。最终：无法用function-try-block快来实现构造函数的接口安全。</p>
<ol>
<li>引申原则1：尽可能使用构造函数不抛异常的基类或成员子对象。</li>
<li>引申原则2：为了帮助别人实现原则1，不要从构造函数中抛出任何异常。</li>
</ol>
<p>其他方面的不再讨论，比如析构与关键字new等。总之，良好的设计必须满足以下两个原则：</p>
<ol>
<li>通过异常对象的存在来注视异常状态，并适当的做出反应。</li>
<li>确保创造和传播异常对象不会造成更大的破坏。</li>
</ol>
<p>最终代码的参考将如下：</p>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">wrapper</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    wrapper()     <span class="keyword">throw</span>() : value_(<span class="literal">NULL</span>)</span><br><span class="line">    &#123;      </span><br><span class="line">        <span class="keyword">try</span> </span><br><span class="line">        &#123;    </span><br><span class="line">            value_ = <span class="keyword">new</span> T;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (...) &#123;      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ~wrapper() <span class="keyword">throw</span>()</span><br><span class="line">    &#123;    </span><br><span class="line">        <span class="keyword">try</span> </span><br><span class="line">        &#123; </span><br><span class="line">            <span class="keyword">delete</span> value_;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (...)&#123;<span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(value_)</span></span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">get</span><span class="params">(T &amp;value)</span> <span class="keyword">const</span> <span class="title">throw</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> assign(value, *value_);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">set</span><span class="params">(T <span class="keyword">const</span> &amp;value)</span> <span class="title">throw</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> assign(*value_, value);&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">assign</span><span class="params">(T &amp;to, T <span class="keyword">const</span> &amp;from)</span> <span class="title">throw</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">error</span><span class="params">(<span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;to = from; &#125;</span><br><span class="line">        <span class="keyword">catch</span> (...) &#123; error = <span class="literal">true</span>;&#125;</span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    T *value_;</span><br><span class="line">    wrapper(wrapper <span class="keyword">const</span> &amp;);</span><br><span class="line">    wrapper &amp;<span class="keyword">operator</span>=(wrapper <span class="keyword">const</span> &amp;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    wrapper&lt;<span class="keyword">int</span>&gt; mywrapper();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>模板继承</h2>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/14/Research-Records20181114/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/14/Research-Records20181114/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-14T14:33:26+08:00">
                2018-11-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>Research Records on 15/11/2018</h1>
<h2>Re-test the Einstein equations of our solution</h2>
<p>We proposed the solution of metric
$$
\begin{align}
	\alpha = &amp; \psi^{-2}\
	\beta^i = &amp; 0\
	\psi = &amp; 1+\sum_{i=1}^n \frac{m_i}{2r_i}
\end{align}
$$
Substituting them into the evolution equations, I obtained the flollowing relation
$$
\begin{align}
	\partial_t \psi = &amp; 0\
	\partial_t \bar{\gamma}<em>{ij} \sim &amp; -2 \bar{A}</em>{ij} \sim \mathcal{O}(c^{-3})\
	\partial_t K \sim &amp; \mathcal{O}(c^{-4})\
	\partial_t \bar{A}_{ij} \sim &amp; \mathcal{O}(c^{-4})
\end{align}
$$</p>
<h2>Mercury Perihelion Calculation</h2>
<p>The metric is
$$
\begin{align}
	g_{\mu\nu} = \left(
\begin{array}{cccc}
-c^2\psi^{-4}&amp;0&amp;0&amp;0\
0&amp;\psi^4 &amp;0&amp;0\
0&amp;0&amp;\psi^4r^2&amp;0\
0&amp;0&amp;0&amp;\psi^4r^2\sin^2\theta
\end{array}
\right)
\end{align}
$$
in spherical coordinates. First we obtain the Christoeffel symbol
$$
\begin{align}
	\Gamma^{i}<em>{jk} = &amp; 2\left(\delta^i_k \partial_j\log\psi + \delta^i_j\partial_k\log\psi - f^{il}f</em>{jk}\partial_l \log\psi \right) -\frac{1}{2}\left( f_{kl}\partial_j f^{il} + f_{jl}\partial_k f^{il} -f_{jk}\partial_lf^{il} \right) \
	\Gamma^0_{00} = &amp; -\frac{2}{c}\partial_t\log\psi\
	\Gamma^i_{00} = &amp; -\frac{2}{\psi^8}f^{ij}\partial_j\log\psi \
	\Gamma^0_{0j} =&amp; -2\partial_j\log\psi\
	\Gamma^i_{0j} = &amp; -\frac{1}{c} f_{jl}\partial_t f^{il} + \frac{2}{c}\delta^i_j \partial_t\log\psi\
	\Gamma^0_{jk} = &amp; -\frac{2}{c^3}f_{jk}\psi^8\partial_t\log\psi
\end{align}
$$
where
$$
\begin{align}
	f_{ij} = \left(
\begin{array}{ccc}
\psi^4 &amp;0&amp;0\
0&amp;\psi^4r^2&amp;0\
0&amp;0&amp;\psi^4r^2\sin^2\theta
\end{array}
\right)
\end{align}
$$
and the acceration is
$$
\begin{align}
	\frac{d^2x^\mu}{dt^2} = &amp; -\Gamma^\mu_{\nu\rho}v^\nu v^\rho + \Gamma^0_{\nu\rho}v^{\mu}v^\nu v^\rho,.
\end{align}
$$
Since $\psi$ is not a function of $t$, this can be simplified as
$$
\begin{align}
	a^i = &amp; -\Gamma^i_{00} - 2\Gamma^i_{0j}v^j -\Gamma^i_{jk}v^jv^k +\Gamma^0_{00}v^i+ 2\Gamma^0_{0j}v^iv^j + \Gamma^0_{jk}v^iv^jv^k\
	= &amp; \frac{2}{\psi^8}f^{ij}\partial_j\log\psi - 4v^iv^j\partial_j\log\psi +2v^2f^{ij}\partial_j\log\psi -f_{kl}v^kv^j\partial_j f^{il} -4v^iv^j\partial_j\log\psi\
	= &amp; \frac{2}{\psi^8}f^{ij}\partial_j\log\psi - 8 v^iv^j\partial_j\log\psi +2v^2f^{ij}\partial_j\log\psi -f_{kl}v^kv^j\partial_j f^{il}\
	= &amp; 2\left[ \left(\frac{1}{\psi^8}+v^2 \right)f^{ij} - 4v^iv^j \right]\partial_j\log\psi -f_{kl}v^kv^j\partial_jf^{il}
\end{align}
$$</p>
<p>When consider retangular coordinates, the affine connection is
$$
\begin{align}
	\Gamma^{i}<em>{jk} = &amp; 2\left(\delta^i_k \partial_j\log\psi + \delta^i_j\partial_k\log\psi - \delta^{il}\delta</em>{jk}\partial_l \log\psi \right)  \
	\Gamma^0_{00} = &amp; -\frac{2}{c}\partial_t\log\psi\
	\Gamma^i_{00} = &amp; -\frac{2}{\psi^8}\delta^{ij}\partial_j\log\psi \
	\Gamma^0_{0j} =&amp; -2\partial_j\log\psi\
	\Gamma^i_{0j} = &amp; -\frac{1}{c} \delta_{jl}\partial_t \delta^{il} + \frac{2}{c}\delta^i_j \partial_t\log\psi = \frac{2}{c}\delta^i_j \partial_t\log\psi\
	\Gamma^0_{jk} = &amp; -\frac{2}{c^3}\delta_{jk}\psi^8\partial_t\log\psi
\end{align}
$$
and thus the acceleration is
$$
\begin{align}
	a^i = &amp; 2\left[ \left(\frac{1}{\psi^8}+v^2 \right)\delta^{ij} - 4v^iv^j \right]\partial_j\log\psi
\end{align}
$$</p>
<p>or
$$
\begin{align}
	\vec{a} = 2\left( \frac{1}{\psi^8}+v^2 \right)\nabla\log\psi - 8\vec{v}\left(\vec{v}\cdot\nabla\log\psi\right)
\end{align}
$$</p>
<h1>Research Records on 20/11/2018</h1>
<p>We also adopt the Will's convention that simplifies the mathematical description of the motion by taking the orbital plane to coincide with the $ x-y$ plane of the coordinate system, and by introducing the vectorial basis $\vec{\lambda} = (-\sin\phi,\cos\phi,0),,<s>\vec{n}=(\cos\phi,\sin\phi,0)$ and $\vec{e}_z = (0,0,1)$, in which $\phi$ is the orbital angle. In terms of the orbital basis, we have
$$
\begin{align}
	\vec{r} = &amp; r\vec{n},,</s>\vec{v}=\dot{r}\vec{n}+r\dot{\phi}\vec{\lambda},,~~\vec{a} = (\ddot{r}-r\dot{\phi}^2)\vec{n}+\frac{1}{r}\frac{d}{dt}(r^2\dot{\phi})\vec{\lambda}
\end{align}
$$
and
$$
\begin{align}
	\vec{r}\times \vec{v} = (r^2\dot{\phi})\vec{e}_z,.
\end{align}
$$</p>
<p>Back to $a^i$, we have
$$
\begin{align}
	\partial_i\log\psi = \frac{1}{\psi}\partial_i\psi = \sum_A\frac{m_A}{2\psi}\partial_i\left(\frac{1}{r_A}  \right)=-\sum_A\frac{m_A}{2\psi}\frac{n_A^i}{r_A^2}
\end{align}
$$
and thus the component form of $a^i$ is
$$
\begin{align}
	a^i = &amp; \sum_A -\frac{m_A }{\psi r_A^2}\left( \frac{1}{\psi^8}+v^2 \right)n_A^i + \frac{4m_A (\vec{v}\cdot \vec{n}_A)}{\psi r_A^2}v^i\
	= &amp; -\frac{m_1 }{\psi r_1^2}\left( \frac{1}{\psi^8}+v^2 \right)n_1^i-\frac{m_2 }{\psi r_2^2}\left( \frac{1}{\psi^8}+v^2 \right)n_2^i + \frac{4m_1 (\vec{v}\cdot \vec{n}_1)}{\psi r_1^2}v^i+ \frac{4m_2 (\vec{v}\cdot \vec{n}_2)}{\psi r_2^2}v^i\
	= &amp; -\frac{m_1 }{\psi r^2}\left( \frac{1}{\psi^8}+v^2 \right)n^i-\frac{m_2 }{\psi r_2^2}\left( \frac{1}{\psi^8}+v^2 \right)n_2^i + \frac{4m_1 (\vec{v}\cdot \vec{n})}{\psi r^2}v^i+ \frac{4m_2 (\vec{v}\cdot \vec{n}_2)}{\psi r_2^2}v^i
\end{align}
$$
where
$$
\begin{align}
	\vec{n}_1 = \vec{n},.
\end{align}
$$
To 1PN, it is
$$
\begin{align}
	\psi^n = &amp; \left(1 + \frac{m_1}{2r}+\frac{m_2}{2r_2}\right)^n = 1+\frac{n m_1}{2r}+\frac{nm_2}{2r_2}\
	\vec{a}_M = &amp; -\frac{m_1}{r^2}\vec{n} +\frac{9m_1}{2r^2}\left(\frac{m_1}{r}+\frac{m_2}{r_2} \right)\vec{n}- \frac{m_1v^2}{r^2}\vec{n}-\frac{m_2}{r_2^2}\vec{n}_2 +\frac{9m_2}{2r_2^2}\left(\frac{m_1}{r}+\frac{m_2}{r_2} \right)\vec{n}_2- \frac{m_2v^2}{r_2^2}\vec{n}_2\
	 &amp; + \frac{4m_1}{r^2}(\vec{v}\cdot \vec{n})\vec{v}+ \frac{4m_2}{r_2^2}(\vec{v}\cdot \vec{n}_2)\vec{v}
\end{align}
$$
where
$$
\begin{align}
	\vec{n} = &amp;\frac{r^X}{r}\vec{e}_X+\frac{r^Y}{r}\vec{e}_Y+\frac{r^Z}{r}\vec{e}_Z\
	\vec{n}_2 = &amp; \frac{r_2^X}{r_2}\vec{e}_X+\frac{r_2^Y}{r_2}\vec{e}_Y+\frac{r_2^Z}{r_2}\vec{e}_Z\
	r_2 = &amp; \sqrt{X^2+(Y-R)^2+Z^2}\
	r^X= &amp;X,,~~r^Y=Y,,<s>r^Z = Z,,</s>
	r_2^X = X,,<s>r_2^Y = Y-R,,<s>r_2^Z = Z,,\
	X = &amp; (\cos\Omega \cos\omega-\cos\iota\sin\Omega\sin\omega)x-(\cos\Omega\sin\omega+\cos\iota\sin\Omega\cos\omega)y +(\sin\iota\sin\Omega)z\
	Y= &amp; (\sin\Omega\cos\omega+\cos\iota\cos\Omega\sin\omega)x-(\sin\Omega\sin\omega-\cos\iota\cos\Omega\cos\omega)y-(\sin\iota\cos\Omega)z\
	Z=&amp; (\sin\iota\sin\omega)x+(\sin\iota\cos\omega)y+(\cos\iota)z
\end{align}
$$
and
$$
\begin{align}
	x = r\cos f,,<s>y = r\sin f,,<s>z=0,,
\end{align}
$$
which leads to
$$
\begin{align}
	r^X = &amp; r[\cos\Omega\cos(\omega+f)-\cos\iota\sin\Omega\sin(\omega+f)]\
	r^Y = &amp; r[\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)]\
	r^Z = &amp; r\sin\iota\sin(\omega+f),.
\end{align}
$$
This implies
$$
\begin{align}
	r_2 = &amp; \sqrt{ r^2+R^2 -2Rr^Y} = \sqrt{ r^2+R^2 -2Rr[\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)]}
\end{align}
$$
Meanwhile, the vector basis are
$$
\begin{align}
	\vec{e}_x = &amp; (\cos\Omega\cos\omega-\cos\iota\sin\Omega\sin\omega)\vec{e}_X +(\sin\Omega\cos\omega+\cos\iota\cos\Omega\sin\omega)\vec{e}_Y+(\sin\iota\sin\omega)\vec{e}_Z\
	\vec{e}_y = &amp; -(\cos\Omega\sin\omega+\cos\iota\sin\Omega\cos\omega)\vec{e}_X-(\sin\Omega\sin\omega-\cos\iota\cos\Omega\cos\omega)\vec{e}_Y+(\sin\iota\cos\omega)\vec{e}_Z\
	\vec{e}_z = &amp; (\sin\iota\sin\Omega)\vec{e}_X-(\sin\iota\cos\Omega)\vec{e}_Y+(\cos\iota)\vec{e}_Z
\end{align}
$$
and
$$
\begin{align}
	\vec{e}_x = &amp; \vec{n}\cos f-\vec{\lambda}\sin f,,</s>~\vec{e}_y = \vec{n}\sin f+\vec{\lambda}\cos f,,\
	\vec{n} = &amp; \vec{e}_x\cos f + \vec{e}_y\sin f,,</s>~\vec{\lambda} = -\vec{e}_x\sin f+\vec{e}_y\cos f,.
\end{align}
$$
Thus the relation between $\vec{e}_X,~\vec{e}_Y,~\vec{e}_Z$ and $\vec{n},,</s>\vec\lambda,,</s>\vec{e}_z$ is
$$
\begin{align}
	\vec{n} = &amp; [\cos\Omega \cos(\omega +f) -\cos\iota\sin\Omega\sin(\omega+f)]\vec{e}_X\
	&amp;+[\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)]\vec{e}_Y+\sin\iota\sin(\omega+f)\vec{e}_Z \
	\vec{\lambda} = &amp; -[\cos\Omega\sin(\omega+f)+\cos\iota\sin\Omega\cos(\omega+f)]\vec{e}_X \
	&amp;+ [-\sin\Omega\sin(\omega+f)+\cos\iota\cos\Omega\cos(\omega+f)]\vec{e}_Y+\sin\iota\cos(\omega+f)\vec{e}_Z\
	\vec{e}_z = &amp; (\sin\iota\sin\Omega)\vec{e}_X-(\sin\iota\cos\Omega)\vec{e}_Y+(\cos\iota)\vec{e}_Z
\end{align}
$$</p>
<p>$$
\begin{align}
	\vec{e}_X = &amp; [\cos\Omega\cos(\omega+f)-\cos\iota\sin\Omega\sin(\omega+f)]\vec{n} \
	 &amp;-[\cos\Omega\sin(\omega+f)+\cos\iota\sin\Omega\cos(\omega+f)]\vec{\lambda}+(\sin\iota\sin\Omega)\vec{e}_z\
	 \vec{e}_Y = &amp; [\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)]\vec{n}\
&amp; +[-\sin\Omega\sin(\omega+f)+\cos\iota\cos\Omega\cos(\omega+f)]\vec{\lambda} -(\sin\iota\cos\Omega) \vec{e}_z\
\vec{e}_Z = &amp; (\sin\iota\sin(\omega+f))\vec{n}+(\sin\iota\cos(\omega+f))\vec{\lambda}+(\cos\iota)\vec{e}_z
\end{align}
$$</p>
<p>Substituting $\vec{e}_X,~\vec{e}_Y,,~\vec{e}_Z$ into the $\vec{n}_2$, we have
$$
\begin{align}
	\vec{n}_2 = &amp; \frac{r-R(\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f))}{r_2}\vec{n} \
	&amp; + \frac{R}{r_2}(\sin\Omega\sin(\omega+f)-\cos\iota\cos\Omega\cos(\omega+f))\vec{\lambda}\
	&amp; + \frac{R\sin\iota\cos\Omega}{r_2}\vec{e}_z,,\
	\vec{n}_1 = &amp; \vec{n},.
\end{align}
$$
so the acceleration is
$$
\begin{align}
	\vec{a} = &amp; -\frac{m_1}{r^2}\vec{n} + \bigg[ -\frac{m_2}{r_2^3}(r-R(\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)))\
&amp; + \frac{9m_1}{2r^2}\left( \frac{m_1}{r}+\frac{m_2}{r_2} \right) +\frac{9m_2}{2r_2^2}\left( \frac{m_1}{r}+\frac{m_2}{r_3} \right) (r-R(\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)))\
&amp; -\frac{m_2v^2}{r_2^2}(r-R(\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)))\
&amp;+\frac{4m_1}{r^2}\dot{r}^2 + \frac{4m_2}{r_2^3}\bigg(\dot{r}(r-R(\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)))\
&amp;+r\dot{\phi}R(\sin\Omega\sin(\omega+f)-\cos\iota\cos\Omega\cos(\omega+f)) \bigg)\dot{r} \bigg]\vec{n}\
&amp; + \frac{R}{r_2^3}\bigg( \sin\Omega\sin(\omega+f)-\cos\iota\cos\Omega\cos(\omega+f) \bigg)\bigg[ -m_2+\frac{9m_2}{2}\bigg( \frac{m_1}{r}+\frac{m_2}{r_2} \bigg) -m_2v^2\
&amp; + \frac{4m_1r_2^3}{r}\dot{r}\dot{\phi} + 4m_2 r\dot{\phi}\bigg(\dot{r}(r-R(\sin\Omega\cos(\omega+f)+\cos\iota\cos\Omega\sin(\omega+f)))\
&amp;+r\dot{\phi}R(\sin\Omega\sin(\omega+f)-\cos\iota\cos\Omega\cos(\omega+f)) \bigg)\dot{r}) \bigg]\vec{\lambda}\
&amp; +\frac{R\sin\iota\cos\Omega}{r_2}\bigg[ -\frac{m_2}{r_2^2}+\frac{9m_2}{2r_2^2}\left( \frac{m_1}{r}+\frac{m_2}{r_2} - \frac{m_2v^2}{r_2^2} \right) \bigg]\vec{e}_z
\end{align}
$$</p>
<p>$$
\begin{align}
	\vec{a} = &amp; -\frac{m_1}{r^2}\vec{n} + \bigg{ \frac{9m_1}{2r^2}\left( \frac{m_1}{r}+\frac{m_2}{r_2} \right) -\frac{m_1v^2}{r^2} \
	&amp; + \frac{n_2^1}{r_2^2}\bigg[ -m_2 -m_2v^2+ \frac{9m_2}{2}\left( \frac{m_1}{r} + \frac{m_2}{r_2}  \right) \bigg] + \frac{4m_1}{r^2}\dot{r}^2 + \frac{4m_2}{r_2^2}\dot{r}(\vec{v}\cdot \vec{n}_2) \bigg} \vec{n}\
	&amp; + \bigg{ \bigg[ -m_2 -m_2v^2 + \frac{9m_2}{2}\left( \frac{m_1}{r}+\frac{m_2}{r_2} \right) \bigg]\frac{n_2^2}{r_2^2} + \frac{4m_1}{r}\dot{r}\dot{\phi} + \frac{4m_2}{r_2^2}r\dot{\phi}(\vec{v}\cdot\vec{n}_2) \bigg} \vec{\lambda}\
	&amp; +\bigg{ -m_2 -m_2v^2 + \frac{9m_2}{2}\left( \frac{m_1}{r}+\frac{m_2}{r_2} \right) \bigg} \frac{n_2^3}{r_2^2}\vec{e}_z
\end{align}
$$</p>
<p>when $\iota = 0$ which implies that the orbit is located at a plane, this velocity is
$$
\begin{align}
	\vec{a} = &amp; -\frac{m_1}{r^2}\vec{n} + \bigg{ \frac{9m_1}{2r^2}\left( \frac{m_1}{r}+\frac{m_2}{r_2} \right) -\frac{m_1v^2}{r^2} \
	&amp;~~~~~~~~~~~~~~~~~~~~~ + \bigg[ -m_2 -m_2v^2+ \frac{9m_2}{2}\left( \frac{m_1}{r} + \frac{m_2}{r_2}  \right) \bigg]\frac{n_2^1}{r_2^2} + \frac{4m_1}{r^2}\dot{r}^2 + \frac{4m_2}{r_2^2}\dot{r}(\vec{v}\cdot \vec{n}_2) \bigg} \vec{n}\
	&amp; ~~~~~~~~~~~~~~+ \bigg{ \bigg[ -m_2 -m_2v^2 + \frac{9m_2}{2}\left( \frac{m_1}{r}+\frac{m_2}{r_2} \right) \bigg]\frac{n_2^2}{r_2^2} + \frac{4m_1}{r}\dot{r}\dot{\phi} + \frac{4m_2}{r_2^2}r\dot{\phi}(\vec{v}\cdot\vec{n}_2) \bigg} \vec{\lambda}
\end{align}
$$
and
$$
\begin{align}
	\vec{n}_2 = &amp; \frac{r-R(\sin\Omega\cos(\omega+f)+\cos\Omega\sin(\omega+f))}{r_2}\vec{n} + \frac{R}{r_2}(\sin\Omega\sin(\omega+f)-\cos\Omega\cos(\omega+f))\vec{\lambda}\
	= &amp; \frac{r-R\sin(\Omega+\omega+f)}{r_2}\vec{n} - \frac{R \cos(\Omega+\omega+f)}{r_2}\vec{\lambda},,
\end{align}
$$</p>
<p>$$
\begin{align}
	\vec{v}\cdot \vec{n}_2 = \frac{r-R\sin(\Omega+\omega+f)}{r_2}\dot{r} - \frac{R \cos(\Omega+\omega+f)}{r_2}r\dot{\phi},.
\end{align}
$$</p>
<p>$$
\begin{align}
	\frac{Gm_1}{r_1^2}=0.0272183,,~~~\frac{Gm_2}{r_2^2}=1.65562\times 10^{-08}
\end{align}
$$</p>
<p>$$
\begin{align}
	&amp;\frac{v_{Mercury}^2}{c^2} \approx 2.5\times 10^{-8},,<s>\frac{Gm_1}{c^2} \approx 1474.14 ~m,,</s>\frac{Gm_2}{c^2} \approx 0.42~m,, \
	&amp;r =r_1 \approx 46,001,200~km \sim 69,816,900~km,,<s>r_2\approx R = 1,353,572,956 ~km\sim 1,513,325,783 ~km ,,\
	&amp;r_2/r \approx 19\sim 33,,</s>\frac{Gm_1}{c^2r}\sim 2.11\times 10^{-08},, ~~ \frac{Gm_2}{c^2r_2}\sim 2.78\times 10^{-13}
\end{align}
$$</p>
<p>$$
\begin{align}
	\vec{a}_0 = &amp; -\frac{m_1}{r^2}\vec{n} -\frac{m_2}{r_2^2}(\vec{n}_2 \cdot \vec{n})\vec{n} + \frac{9m_1^2}{2r^3}\left( \frac{m_1}{r}+\frac{m_2}{r_2} \right)\vec{n} -\frac{m_1v^2}{r^2}\vec{n} +\frac{4m_1}{r^2}(\vec{n}\cdot \vec{v})\vec{v}
\end{align}
$$</p>
<p>$$
\begin{align}
	\vec{a}_0 = &amp; -\frac{m_1}{r^2}\vec{n}-\frac{m_2}{r_2^2}\vec{n}_2 \
\vec{a}_1 = &amp; \frac{9m_1^2}{2r^3}\vec{n}- \frac{m_1v^2}{r^2}\vec{n}  + \frac{4m_1}{r^2}(\vec{v}\cdot \vec{n})\vec{v} \
	 \vec{a}_2 = &amp; \frac{9m_1m_2}{2r^2r_2}\vec{n} +\frac{9m_1m_2}{2r r_2^2}\vec{n}_2 +\frac{9m_2^2}{2r_2^3}\vec{n}_2 + \frac{4m_2}{r_2^2}(\vec{v}\cdot \vec{n}_2)\vec{v} - \frac{m_2v^2}{r_2^2}\vec{n}_2
\end{align}
$$</p>
<h1>Research Records on 22/11/2018</h1>
<p>Will says the acceleration is
$$
\begin{align}
	\vec{a} = -\frac{Gm}{r^2}\vec{n} - \frac{Gm_3r}{R^3}[\vec{n} - 3(\vec{n}\cdot\vec{n}<em>2)\vec{n}<em>2] + \frac{1}{c^2}\vec{a}</em>{Binary}+\frac{1}{c^2}\vec{a}</em>{Cross} + \mathcal{O}\left(\frac{G^2mm_3r}{c^2R^4} \right)
\end{align}
$$
where  $\vec{N}=\vec{r}<em>2/r_2$, $\vec{n} = \vec{r}/r$, and
$$
\begin{align}
	\vec{a}</em>{Binary} = &amp; \frac{Gm}{r^2}\left( \frac{4Gm}{r} - v^2 \right)\vec{n} + \frac{4Gm \dot{r} }{r^2}\vec{v},,\
	\vec{a}_{Cross} = &amp; 2\frac{Gmm_3}{R^3}[\vec{n}-6(\vec{n}\cdot \vec{n}_2)\vec{n}_2 +3\vec{n}(\vec{n}\cdot\vec{n}_2)^2] \
	&amp; + \frac{Gm_3r}{R^3}\left[4\vec{v}{ \dot{r}-3(\vec{n}\cdot\vec{n}_2)(\vec{v}\cdot \vec{n}_2)} -v^2{\vec{n}-3(\vec{n}\cdot\vec{n}_2)\vec{n}_2 }\right]\
	&amp; - \frac{Gm_3}{R^2}\left[ 4\vec{v}\times(\vec{n}_2\times \vec{V}_3) -3\vec{v}(\vec{n}_2\cdot \vec{V}_3) \right]
\end{align}
$$</p>
<h1>Research Records on 23/11/2018</h1>
<p>The acceleration of Sun is
$$
\begin{align}
	a^i_S = &amp; \sum_A -\frac{m_A }{\psi_S r_A^2}\left( \frac{1}{\psi_S^8}+V^2 \right)n_A^i + \frac{4m_A (\vec{V}\cdot \vec{n}_A)}{\psi_S r_A^2}V^i\
	= &amp; -\frac{m_3 }{\psi_S r_3^2}\left( \frac{1}{\psi^8_S}+V^2 \right)n_3^i-\frac{m_2 }{\psi_S r_2^2}\left( \frac{1}{\psi_S^8}+V^2 \right)n_2^i + \frac{4m_3 (\vec{V}\cdot \vec{n}_3)}{\psi_S r_3^2}V^i+ \frac{4m_2 (\vec{V}\cdot \vec{n}_2)}{\psi_S r_2^2}V^i\
	= &amp; \frac{m_3}{r^2}\vec{n} -\frac{9m_3}{2r^2}\left(\frac{m_3}{r}+\frac{m_2}{R} \right)\vec{n}+ \frac{m_3 V^2}{r^2}\vec{n}+\frac{m_2}{R^2}\vec{N} -\frac{9m_2}{2R^2}\left(\frac{m_3}{r}+\frac{m_2}{R} \right)\vec{N} + \frac{m_2V^2}{R^2}\vec{N}\
	 &amp; - \frac{4m_3}{r^2}(\vec{V}\cdot \vec{n})\vec{V} - \frac{4m_2}{R^2}(\vec{V}\cdot \vec{N})\vec{V}
\end{align}
$$
where $n_2^i = N^i = \vec{R}/R$, $n_3^i = -n^i$, $\psi_S = 1+\frac{m_2}{2r_2}+\frac{m_3}{2r_3}$ .  Then the relative acceleration is
$$
\begin{align}
	\vec{a} = \vec{a}_M - \vec{a}_S = &amp;-\frac{m_1}{r^2}\vec{n} +\frac{9m_1}{2r^2}\left(\frac{m_1}{r}+\frac{m_2}{r_2} \right)\vec{n}- \frac{m_1v^2}{r^2}\vec{n}-\frac{m_2}{r_2^2}\vec{n}_2 +\frac{9m_2}{2r_2^2}\left(\frac{m_1}{r}+\frac{m_2}{r_2} \right)\vec{n}_2 - \frac{m_2v^2}{r_2^2}\vec{n}_2\
	 &amp; + \frac{4m_1}{r^2}(\vec{v}\cdot \vec{n})\vec{v}+ \frac{4m_2}{r_2^2}(\vec{v}\cdot \vec{n}_2)\vec{v} - \bigg[ \frac{m_3}{r^2}\vec{n} -\frac{9m_3}{2r^2}\left(\frac{m_3}{r}+\frac{m_2}{R} \right)\vec{n}+ \frac{m_3 V^2}{r^2}\vec{n}+\frac{m_2}{R^2}\vec{N} \
	 &amp;-\frac{9m_2}{2R^2}\left(\frac{m_3}{r}+\frac{m_2}{R} \right)\vec{N} + \frac{m_2V^2}{R^2}\vec{N} - \frac{4m_3}{r^2}(\vec{V}\cdot \vec{n})\vec{V} - \frac{4m_2}{R^2}(\vec{V}\cdot \vec{N})\vec{V} \bigg] \
	 = &amp; -\frac{m_1+m_3}{r^2}\vec{n} -\frac{m_2}{r_2^2}\vec{n}_2 - \frac{m_2}{R^2}\vec{N} + \bigg[ \left(\frac{9m_1^2}{2r^3} -\frac{m_1v^2}{r^2} \right)\vec{n} +\frac{4m_1}{r^2}(\vec{v}\cdot \vec{n})\vec{v} \bigg]\
	 &amp;+ \frac{9m_1m_2}{2r^2r_2}\vec{n} + \frac{9m_1m_2}{2r r_2^2}\vec{n}_2 + \frac{9m_2^2}{2 r_2^3}\vec{n}_2 - \frac{m_2v^2}{r_2^2}\vec{n}_2 + \frac{4m_2}{r_2^2}(\vec{v}\cdot \vec{n}_2)\vec{v} + \frac{9m_2m_3}{2r^2 R}\vec{n}+ \frac{9m_3^2}{2r^3}\vec{n} \
&amp;-\frac{m_3V^2}{r^2}\vec{n} +\frac{9m_2^2}{2R^3}\vec{N} +\frac{9m_2m_3}{2R^2r}\vec{N} - \frac{m_2V^2}{R^2}\vec{N} + \frac{4m_3}{r^2}(\vec{V}\cdot \vec{n})\vec{V} + \frac{4m_2}{R^2}(\vec{V}\cdot \vec{N})\vec{V}
\end{align}
$$
where
$$
\begin{align}
	\frac{\vec{n}_2}{r_2^m} = &amp; \frac{\vec{r}-\vec{R}}{|\vec{r}-\vec{R}|^{m+1}} = (\vec{r}-\vec{R})R^{-m-1} \left(\sqrt{1-2\frac{r}{R}(\vec{N}\cdot \vec{n})+\left( \frac{r}{R} \right)^2 }\right)^{-m-1} \
	= &amp; (\vec{r}-\vec{R})R^{-m-1}\left(1+(m+1)(\vec{n}\cdot \vec{N})\frac{r}{R}-\frac{1}{2}(m+1)[1-(\vec{n}\cdot \vec{N})^2(m+3)]\frac{r^2}{R^2} \right) \
	= &amp; - \frac{\vec{N}}{R^{m}} + \frac{\vec{r}}{R^{m+1}}- \frac{(m+1)r}{R^{m+1}}(\vec{n}\cdot \vec{N})\vec{N} + \frac{(m+1)r^2}{R^{m+2}}(\vec{n}\cdot\vec{N})\vec{n}+ \frac{(m+1)[1-(\vec{n}\cdot\vec{N})^2(m+3)]r^2}{2R^{m+2}}\vec{N}\
	= &amp; - \frac{\vec{N}}{R^{m}} + \frac{r}{R^{m+1}}[\vec{n}-(m+1)(\vec{n}\cdot\vec{N})\vec{N}] + \frac{(m+1)r^2}{R^{m+2}}\left{(\vec{n}\cdot\vec{N})\vec{n} + \frac{1}{2}[1-(\vec{n}\cdot {\vec{N}})^2(m+3)]\vec{N} \right}\
	\frac{1}{r_2^m} = &amp; \frac{1}{R^m}\left{1+ \frac{mr}{R}(\vec{n}\cdot\vec{N})+ \frac{mr^2}{2R^2} \left[-1+(m+2)(\vec{n}\cdot \vec{N})^2\right] \right} \
	= &amp; \frac{1}{R^m} + \frac{mr}{R^{m+1}}(\vec{n}\cdot\vec{N})+ \frac{mr^2}{2R^{m+2}} \left[-1+(m+2)(\vec{n}\cdot \vec{N})^2\right]
\end{align}
$$
Getting rid of $m_3$， it is
$$
\begin{align}
	\vec{a} = &amp; - \frac{m}{r^2}\vec{n} -\frac{m_2r}{R^3}[\vec{n}-3(\vec{n}\cdot\vec{N})\vec{N}] + \bigg[ \left(\frac{9m_1^2}{2r^3} -\frac{m_1v^2}{r^2} \right)\vec{n} +\frac{4m_1}{r^2}(\vec{v}\cdot \vec{n})\vec{v} \bigg]\
	&amp; + \frac{9m_1m_2}{2r^2R}\vec{n} - \frac{9m_1m_2}{2rR^2}\left[ -\vec{N} + \vec{n}(\vec{N}\cdot \vec{n}) \right]\
	&amp;+ \frac{9m_1m_2}{4R^3}\left[ \vec{n}-6(\vec{N}\cdot \vec{n})\vec{N} + 3\vec{n}(\vec{n}\cdot\vec{N})^2 \right]\
	&amp;+\frac{m_2r}{R^3} \left{4\left[ \dot{r}-3(\vec{v}\cdot \vec{N})(\vec{n}\cdot\vec{N}) \right]\vec{v} -v^2\left[\vec{n}-3(\vec{n}\cdot\vec{N})\vec{N} \right] \right}\
	&amp;-\frac{m_2}{R^2}\left[4(\vec{v}\cdot\vec{N})\vec{v}  + v^2\vec{N} +V^2 \vec{N} +4(\vec{V}\cdot\vec{N})\vec{V} \right],.
\end{align}
$$</p>
<p>So the equation of motion is
$$
\begin{align}
	\ddot{r}-r\dot{\phi}^2 = &amp; -\frac{m}{r^2} - \frac{m_2r}{R^3} + \frac{3m_2r}{R^3}(\vec{n}\cdot \vec{N})^2 + \frac{9m_1^2}{2r^3} -\frac{m_1v^2}{r^2}+\frac{4m_1}{r^2}(\vec{v}\cdot \vec{n})\dot{r} \
	&amp; + \frac{9m_1m_2}{2r^2R} + \frac{9m_1m_2}{4R^3}\bigg[ 1 - 3(\vec{n}\cdot\vec{N})^2 \bigg] \
&amp; + \frac{m_2r}{R^3} \bigg{ 4\bigg[ \dot{r}^2 -3\dot{r}(\vec{v}\cdot\vec{N})(
	\vec{n}\cdot\vec{N}) \bigg] - v^2\bigg[ 1-3(\vec{n}\cdot \vec{N})^2 \bigg] \bigg} \
	&amp; - \frac{m_2}{R^2}\bigg{ 4(\vec{v}\cdot \vec{N})(\vec{v}\cdot \vec{n}) + (v^2+V^2)(\vec{n}\cdot\vec{N}) + 4(\vec{V}\cdot\vec{N})(\vec{V}\cdot\vec{n}) \bigg}
\end{align}
$$</p>
<p>$$
\begin{align}
	\frac{1}{r}\frac{d}{dt}(r^2\dot{\phi}) = &amp; \frac{3m_2r}{R^3}(\vec{n}\cdot\vec{N})(\vec{N}\cdot \vec{\lambda}) + \frac{4m_1}{r^2}(\vec{v}\cdot\vec{n})r\dot{\phi}\
	&amp; + \frac{9m_1m_2}{2rR^2}(\vec{N}\cdot\vec{\lambda})-\frac{54m_1m_2}{4R^3}(\vec{N}\cdot\vec{n})(\vec{N}\cdot\vec{\lambda})\
	&amp; + \frac{m_2r}{R^3}\bigg{ 4\bigg[\dot{r} - 3(\vec{v}\cdot\vec{N})(\vec{n}\cdot\vec{N})\bigg]r\dot{\phi} + 3v^2(\vec{n}\cdot\vec{N})(\vec{N}\cdot\vec{\lambda}) \bigg}\
	&amp; -\frac{m_2}{R^2}\bigg[ 4(\vec{v}\cdot\vec{N})r\dot{\phi} +(v^2+V^2)(\vec{N}\cdot\vec{\lambda}) +4(\vec{V}\cdot\vec{N})(\vec{V}\cdot\vec{\lambda})\bigg]
\end{align}
$$</p>
<p>Therefore, according to Will, the components of the perturbated in the Keplerian basis $(\vec{n},~\vec{\lambda},~\vec{e}_z)$ are
$$
\begin{align}
	\mathcal{R}:= \vec{f}\cdot\vec{n} = &amp;  - \frac{m_2r}{R^3} + \frac{3m_2r}{R^3}(\vec{n}\cdot \vec{N})^2 \
	&amp;+\frac{9m_1^2}{2r^3} -\frac{m_1v^2}{r^2}+\frac{4m_1}{r^2}(\vec{v}\cdot \vec{n})\dot{r} \
	&amp; + \frac{9m_1m_2}{2r^2R} + \frac{9m_1m_2}{4R^3}\bigg[ 1 - 3(\vec{n}\cdot\vec{N})^2 \bigg] \
&amp; + \frac{m_2r}{R^3} \bigg{ 4\bigg[ \dot{r}^2 -3\dot{r}(\vec{v}\cdot\vec{N})(
	\vec{n}\cdot\vec{N}) \bigg] - v^2\bigg[ 1-3(\vec{n}\cdot \vec{N})^2 \bigg] \bigg} \
	&amp; - \frac{m_2}{R^2}\bigg{ 4(\vec{v}\cdot \vec{N})(\vec{v}\cdot \vec{n}) + (v^2+V^2)(\vec{n}\cdot\vec{N}) + 4(\vec{V}\cdot\vec{N})(\vec{V}\cdot\vec{n}) \bigg}\
	\mathcal{S} := \vec{f}\cdot \vec{\lambda} = &amp; \frac{3m_2r}{R^3}(\vec{n}\cdot\vec{N})(\vec{N}\cdot \vec{\lambda}) + \frac{4m_1}{r^2}(\vec{v}\cdot\vec{n})r\dot{\phi}\
	&amp;+\frac{4m_1}{r^2}(\vec{v}\cdot\vec{n})r\dot{\phi} + \frac{9m_1m_2}{2rR^2}(\vec{N}\cdot\vec{\lambda})-\frac{54m_1m_2}{4R^3}(\vec{N}\cdot\vec{n})(\vec{N}\cdot\vec{\lambda})\
	&amp; + \frac{m_2r}{R^3}\bigg{ 4\bigg[\dot{r} - 3(\vec{v}\cdot\vec{N})(\vec{n}\cdot\vec{N})\bigg]r\dot{\phi} + 3v^2(\vec{n}\cdot\vec{N})(\vec{N}\cdot\vec{\lambda}) \bigg}\
	&amp; -\frac{m_2}{R^2}\bigg[ 4(\vec{v}\cdot\vec{N})r\dot{\phi} +(v^2+V^2)(\vec{N}\cdot\vec{\lambda}) +4(\vec{V}\cdot\vec{N})(\vec{V}\cdot\vec{\lambda})\bigg] \
	\mathcal{W}:= \vec{f}\cdot\vec{e}_z = &amp; 0
\end{align}
$$
And the direction to Saturn is
$$
\begin{align}
	\vec{N} = \vec{e}_X
\end{align}
$$
and direction to Mercury is
$$
\begin{align}
	\vec{n} = &amp; \cos(f+\omega)\vec{e}_X +\sin(f+\omega)\vec{e}_Y\
	\vec{\lambda} = &amp; -\sin(f+\omega)\vec{e}_X +\cos(f+\omega)\vec{e}_Y\
	\vec{e}_z = &amp;\vec{e}_Z
\end{align}
$$
From these expressions we find that
$$
\begin{align}
	\vec{n}\cdot\vec{N} = &amp; \cos(\omega+f)\
	\vec{\lambda}\cdot\vec{N} = &amp; -\sin(\omega+f)\
	\vec{e}_z\cdot\vec{N} = &amp; 0
\end{align}
$$
and the components of the perturbing force become
$$
\begin{align}
	\mathcal{R} = &amp;  - \frac{m_2r}{R^3} + \frac{3m_2r}{R^3}\cos^2(\omega+f) +\frac{9m_1^2}{2r^3} -\frac{m_1v^2}{r^2}+\frac{4m_1\dot{r}^2}{r^2} \
	&amp; + \frac{9m_1m_2}{2r^2R} + \frac{9m_1m_2}{4R^3}\bigg[ 1 - 3\cos^2(\omega+f) \bigg] \
&amp; + \frac{m_2r}{R^3} \bigg{ 4\bigg[ \dot{r}^2 -3\dot{r}\bigg(\dot{r}\cos(\omega+f)-r\dot{\phi}\sin(\omega+f)\bigg)\cos(\omega+f) \bigg] - v^2\bigg[ 1-3\cos^2(\omega+f) \bigg] \bigg} \
	&amp; - \frac{m_2}{R^2}\bigg{ 4\dot{r}\bigg(\dot{r}\cos(\omega+f)-r\dot{\phi}\sin(\omega+f)\bigg) + (v^2+V^2)\cos(\omega+f) \bigg}\
	= &amp;  - \frac{m_2r}{R^3} + \frac{3m_2r}{R^3}\cos^2(\omega+f) + \frac{9m_1^2}{2r^3} -\frac{m_1v^2}{r^2}+\frac{4m_1\dot{r}^2}{r^2} + \frac{9m_1m_2}{2r^2R} + \frac{9m_1m_2}{4R^3}\bigg[ 1 - 3\cos^2(\omega+f) \bigg] \
&amp; + \frac{m_2r}{R^3} \bigg{ 4\bigg[ \dot{r}^2 -3\dot{r}^2\cos^2(\omega+f) + 3r\dot{r}\dot{\phi}\cos(\omega+f)\sin(\omega+f) \bigg] - v^2\bigg[ 1-3\cos^2(\omega+f) \bigg] \bigg} \
	&amp; - \frac{m_2}{R^2}\bigg{ 4 \dot{r}^2\cos(\omega+f) - 4r\dot{r}\dot{\phi}\sin(\omega+f) + (v^2+V^2)\cos(\omega+f) \bigg}\
\end{align}
$$</p>
<p>$$
\begin{align}
	\mathcal{S} = &amp; -\frac{3m_2r}{R^3}\sin(\omega+f)\cos(\omega+f) +\frac{4m_1}{r}\dot{r}\dot{\phi} - \frac{9m_1m_2}{2rR^2}\sin(\omega+f) + \frac{54m_1m_2}{4R^3}\sin(\omega+f)\cos(\omega+f)\
	&amp; + \frac{m_2r}{R^3}\bigg{ 4\bigg[\dot{r} - 3\bigg(\dot{r}\cos(\omega+f)-r\dot{\phi}\sin(\omega+f)\bigg)\cos(\omega+f)\bigg]r\dot{\phi} - 3v^2\cos(\omega+f)\sin(\omega+f) \bigg}\
	&amp; -\frac{m_2}{R^2}\bigg[ 4\bigg(\dot{r}\cos(\omega+f)-r\dot{\phi}\sin(\omega+f)\bigg)r\dot{\phi} - (v^2+V^2)\sin(\omega+f) \bigg] \
= &amp; -\frac{3m_2r}{R^3}\sin(\omega+f)\cos(\omega+f) + \frac{4m_1}{r}\dot{r}\dot{\phi} - \frac{9m_1m_2}{2rR^2}\sin(\omega+f) + \frac{54m_1m_2}{4R^3}\sin(\omega+f)\cos(\omega+f)\
	&amp; + \frac{m_2r}{R^3}\bigg{ 4\bigg[ r\dot{r}\dot{\phi} -3r\dot{r}\dot{\phi}\cos^2(\omega+f)+3r^2\dot{\phi}^2\sin(\omega+f)\cos(\omega+f) \bigg]   - 3v^2\cos(\omega+f)\sin(\omega+f) \bigg}\
	&amp; -\frac{m_2}{R^2}\bigg[ 4\bigg(r\dot{r}\dot{\phi}\cos(\omega+f)-r^2\dot{\phi}^2\sin(\omega+f)\bigg) - (v^2+V^2)\sin(\omega+f) \bigg] \
\end{align}
$$</p>
<p>$$
\begin{align}
	\mathcal{W} = &amp; 0
\end{align}
$$</p>
<p>The quantities in perturbative force are given by zeroth solution
$$
\begin{align}
	\cos f = &amp; \frac{\cos u -e}{1-e\cos u} \
	\sin f = &amp; \frac{\sqrt{1-e^2}\sin u}{1-e\cos u} \
	\sin(\omega + f) = &amp; \sin \omega \cos f+ \cos\omega \sin f = \sin\omega \frac{\cos u -e}{1-e\cos u} + \cos\omega \frac{\sqrt{1-e^2}\sin u}{1-e\cos u} \
	= &amp; \frac{\sin\omega \cos u -e \sin\omega +\cos\omega \sin u\sqrt{1-e^2}}{1 - e\cos u} \
	\cos(\omega + f) = &amp; \cos\omega \cos f-\sin\omega \sin f = \cos\omega \frac{\cos u - e}{1-e\cos u} -\sin\omega \frac{\sqrt{1-e^2}\sin u}{1-e\cos u}\
= &amp; \frac{\cos\omega \cos u -e\cos\omega -\sqrt{1-e^2} \sin \omega \sin u}{1-e\cos u}\
1+e\cos f = &amp; 1+e \frac{\cos u - e}{1-e\cos u} = \frac{1-e\cos u + e\cos u -e^2}{1-e\cos u} = \frac{1-e^2}{1-e\cos u}
\end{align}
$$</p>
<p>$$
\begin{align}
	r = &amp; a(1-e\cos u)\
	r = &amp; \frac{p}{1+e\cos f} = \frac{a(1-e^2)}{1+e\cos f}\
	\dot{r} = &amp; \sqrt{\frac{Gm}{a}}\frac{e\sin u}{1-e\cos u} \
	\dot{r} = &amp; \sqrt{\frac{Gm}{a(1-e^2)}}e\sin f \
	\dot{\phi} = &amp; \sqrt{\frac{Gm}{a^3}} \frac{\sqrt{1-e^2}}{(1-e\cos u)^2} \
	\dot{\phi} = &amp; \sqrt{\frac{Gm}{a^3(1-e^2)^3}}[1+e\cos f]^2 \
	\dot{u} = &amp; \sqrt{\frac{Gm}{a^3}}\frac{1}{1-e\cos u} \
	v^2 = &amp; \frac{Gm}{a}\frac{1+e\cos u}{1-e\cos u} = Gm\left( \frac{2}{r} - \frac{1}{a} \right)\
	v^2 = &amp; \frac{Gm}{a(1-e^2)}[1+2e\cos f +e^2] \
	a:= &amp; \frac{p}{1-e^2} \
	p:= &amp; \frac{h^2}{Gm} = \frac{r^4\dot{\phi}^2}{Gm}
\end{align}
$$
So the perihelion of $\omega​$ satisfies
$$
\begin{align}
\frac{d\omega}{df}\approx &amp; \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} \bigg]\
	= &amp; \frac{1}{e}\frac{a^2(1-e^2)^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} \bigg] \
	= &amp; \frac{1}{e}\frac{a^2(1-e^2)^2}{Gm}\bigg[ -\frac{\cos f}{p^2}r^2\mathcal{R} + \frac{2+e\cos f}{p^3}r^3 \sin f ~\mathcal{S} \bigg] \
	= &amp; \frac{1}{Gme}\bigg[ -r^2\cos f \mathcal{R} + \frac{2+e\cos f}{a(1-e^2)}r^3 \sin f ~\mathcal{S} \bigg] \
	\frac{d\omega}{du} \approx &amp; \frac{1}{e}\frac{a^2}{Gm}\bigg{ \sqrt{1-e^2} (e - \cos u)\mathcal{R} + \bigg[ (2-e)\sin u + (1-2e)\cos u \sin u\bigg] \mathcal{S} \bigg}
\end{align}
$$
since the relation
$$
\begin{align}
	\frac{d\omega}{df}= &amp; \frac{d\omega}{d u}\frac{du}{df} = \frac{1-e\cos u}{\sqrt{1-e^2}}\frac{d\omega}{du}\
\approx &amp; \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{\cos f}{(1+e\cos f)^2}\mathcal{R} + \frac{2+e\cos f}{(1+e\cos f)^3}\sin f ~\mathcal{S} \bigg] \
	= &amp; \frac{1}{e}\frac{p^2}{Gm}\bigg[ -\frac{ (1-e\cos u)(\cos u -e)}{(1-e^2)^2}\mathcal{R} + \frac{(1-e\cos u)(2-2e\cos u +\cos u -e )}{(1-e^2)^{5/2}}\sin u ~\mathcal{S} \bigg] \
	= &amp; \frac{1}{e}\frac{p^2 (1-e\cos u) }{Gm(1-e^2)^2}\bigg[ (e - \cos u)\mathcal{R} + \frac{(2-2e\cos u +\cos u -e )}{\sqrt{(1-e^2)}}\sin u ~\mathcal{S} \bigg]\
	= &amp; \frac{1}{e}\frac{a^2(1-e\cos u)}{Gm}\bigg[ (e - \cos u)\mathcal{R} + \frac{(2-e)\sin u + (1-2e)\cos u \sin u}{\sqrt{1-e^2}} ~\mathcal{S} \bigg]
\end{align}
$$
Thus we can seperate the terms according to $r^n$, which says that employs the $d\omega/df$ for $n&lt;0$ and $d\omega / du$ for $n&gt;0$.</p>
<p>The advanced perihelion is
$$
\begin{align}
	\Delta \omega = \int_0^{2\pi} \frac{d\omega_1}{df}\bigg|<em>{suitable~terms} df + \int_0^{2\pi}\frac{d\omega_2}{d u} \bigg|</em>{suitable ~terms}du
\end{align}
$$</p>
<p>$$
\begin{align}
	\mathcal{R} =  &amp;  - \frac{m_2r}{R^3} + \frac{3m_2r}{R^3}\cos^2(\omega+f) + \frac{9m_1^2}{2r^3} -\frac{m_1v^2}{r^2}+\frac{4m_1\dot{r}^2}{r^2} + \frac{9m_1m_2}{2r^2R} + \frac{9m_1m_2}{4R^3}\bigg[ 1 - 3\cos^2(\omega+f) \bigg] \
&amp; + \frac{m_2r}{R^3} \bigg{ 4\bigg[ \dot{r}^2 -3\dot{r}^2\cos^2(\omega+f) + 3r\dot{r}\dot{\phi}\cos(\omega+f)\sin(\omega+f) \bigg] - v^2\bigg[ 1-3\cos^2(\omega+f) \bigg] \bigg} \
	&amp; - \frac{m_2}{R^2}\bigg{ 4 \dot{r}^2\cos(\omega+f) - 4r\dot{r}\dot{\phi}\sin(\omega+f) + (v^2+V^2)\cos(\omega+f) \bigg}\
\end{align}
$$</p>
<p>$$
\begin{align}
	r^2\mathcal{R} = &amp;  - \frac{m_2r^3}{R^3} + \frac{3m_2r^3}{R^3}\cos^2(\omega+f) + \frac{9m_1^2}{2r} - m_1v^2 + 4m_1\dot{r}^2 + \frac{9m_1m_2}{2R} \
&amp; + \frac{9m_1m_2r^2}{4R^3}\bigg[ 1 - 3\cos^2(\omega+f) \bigg] \
&amp; + \frac{m_2r^3}{R^3} \bigg{ 4\bigg[ \dot{r}^2 -3\dot{r}^2\cos^2(\omega+f) + 3r\dot{r}\dot{\phi}\cos(\omega+f)\sin(\omega+f) \bigg] - v^2\bigg[ 1-3\cos^2(\omega+f) \bigg] \bigg} \
	&amp; - \frac{m_2r^2}{R^2}\bigg{ 4 \dot{r}^2\cos(\omega+f) - 4r\dot{r}\dot{\phi}\sin(\omega+f) + (v^2+V^2)\cos(\omega+f) \bigg}\
\end{align}
$$</p>
<p>$$
\begin{align}
	\Delta\omega = &amp; \frac{3\pi(1-e^2)^{1/2}}{2}\frac{m_2}{m} \left( \frac{a}{R}\right)^3(1+5\cos 2\omega)\
&amp;-\frac{\pi  m_1 \left(e \left(9 a^3 \left(e^2-1\right)^2 m_2+2 \sqrt{1-e^2} R^3 (9 m_1-20 m)\right)\right)}{4 a e \left(1-e^2\right)^{3/2} m R^3}\
	&amp; +\frac{9 a \left(e^2-1\right)^{1/2} m_2 (9 a e \cos 2 \omega +4 R \cos \omega )}{4  e m R^3} \
	&amp; -\frac{7 \sqrt{1-e^2} \pi  a^2 m_2 }{2 R^3}\
	&amp;+\frac{3 \left(4 e^6+2 \left(7 \sqrt{1-e^2}-10\right) e^2-12 \left(\sqrt{1-e^2}-1\right)+\left(5 \sqrt{1-e^2}+4\right) e^4\right) \cos (2 \omega )}{2 e^4 R^3}\
	&amp; +\frac{\pi  a \sqrt{1-e^2} \left(e^2-20 \sqrt{1-e^2}+20\right) m_2 \cos (\omega )}{e^3 R^2}\
	&amp;+ \frac{3 a^2 \left(\pi  \sqrt{1-e^2} (e (e (-2 e ((e-4) e-6)-23)-8)+14)-2 \pi  \left(e^2-1\right)^2 (e (e+4)-7)\right) m_2 \cos 2 \omega }{e^5 R^3}
\end{align}
$$</p>
<p>Therefore the average advanced perihelion is ($m_1\approx m$)
$$
\begin{align}
\langle\Delta\omega\rangle = &amp; \frac{3\pi(1-e^2)^{1/2}}{2}\frac{m_2}{m} \left( \frac{a}{R}\right)^3+ \frac{11\pi}{2(1-e^2)}\left( \frac{m}{a} \right) \
&amp;- \frac{7\pi\sqrt{1-e^2}}{2}\left( \frac{m_2}{R} \right)\left(\frac{a}{R} \right)^2 - \frac{9\pi\sqrt{1-e^2}}{4}\left(\frac{m_2}{R} \right)\left( \frac{a}{R} \right)^2
\end{align}
$$
while Will gives the result
$$
\begin{align}
\langle \Delta\omega \rangle_{\text{Will}} = &amp; \frac{3\pi(1-e^2)^{1/2}}{2}\frac{m_2}{m} \left( \frac{a}{R}\right)^3 + \frac{6\pi }{(1-e^2)}\left( \frac{m}{a} \right) + \frac{21\pi}{(1-e^2)^{3/2}}\left( \frac{m_2}{R} \right)\left(\frac{a}{R} \right)^2 \
	&amp;+ \frac{141\pi e^2}{4(1-e^2)^{3/2}}\left( \frac{m_2}{R} \right)\left(\frac{a}{R} \right)^2 + 4\pi \frac{m_2}{a}\left( \frac{a}{R}\right)^{5/2}
\end{align}
$$
The first term is Newtonian 3-body contribution and the second term is relativitistic 2-body contribution which is should be $\frac{6\pi m}{a(1-e^2)}$.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/08/英语记录/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/08/英语记录/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-08T21:49:00+08:00">
                2018-11-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>单词、词组、句子</h1>
<p>take for granted</p>
<p>tyranny</p>
<p>common sense</p>
<p>come across   偶遇，明白清楚</p>
<p>inadequate</p>
<p>stormy present</p>
<p>occasion</p>
<p>disenthrall / set free</p>
<p>fascinate</p>
<p>be formed</p>
<p>meet circumstances</p>
<p>copy with</p>
<p>fiducial</p>
<p>standardize</p>
<p>tremendously</p>
<p>aptitude altitute attitude</p>
<p>metaphor</p>
<p>manufacture 制造，捏造   manufacturer 制造商，厂商 manufacturing 制造业</p>
<p>batch 分批处理</p>
<p>flourish  v.繁华，昌盛</p>
<p>get involved in 卷入</p>
<p>vital 至关重要的，有活力的</p>
<p>visible</p>
<p>make up 组成，化妆，编造，补足</p>
<p>make of</p>
<p>substance</p>
<p>assignment</p>
<p>discipline</p>
<p>curator</p>
<p>authentic</p>
<p>appear to be</p>
<p>element</p>
<p>discover</p>
<p>characteristic</p>
<p>strike / stroke</p>
<p>thick / thin</p>
<p>ingredient</p>
<p>pigment</p>
<p>binding agent 粘贴剂</p>
<p>invasive</p>
<p>restoration</p>
<p>touch up</p>
<p>cover up</p>
<p>deteriorate</p>
<p>outcome</p>
<p>chronically</p>
<p>the full range of 全方位的</p>
<p>qualify 合格</p>
<p>attributable to</p>
<p>it is possible that ...</p>
<p>govern</p>
<p>put it in another way</p>
<p>hormone</p>
<p>manipulation 操作；处理；篡改</p>
<p>intervention 介入，调停，妨碍</p>
<p>either ... or ...</p>
<p>pose</p>
<p>vial 小瓶，药水瓶，装入小瓶</p>
<p>prime adj.主要的，最好的，基本的；adv. 极好地；n. 初期，青年，精华，全盛时期; vt. 做好准备，装填; vi. 作准备</p>
<p>a series of</p>
<p>gamble   v. n. 赌博, 冒险， 孤注一掷</p>
<p>salive 唾液</p>
<p>risk tolerance 风险承受能力，敢于冒险</p>
<p>whopping adj. adv. 巨大的，天大的，非常地，异常地    whop v. 打，抽出，征服；n. 重击，打击声；</p>
<p>whopping significant difference 巨大的不同</p>
<p>here's … 这儿就是 ...   e.g. Here's what we find on testosterone.</p>
<p>assertive adj. 肯定的；独断的；坚定而自信的</p>
<p>stress-reactive adj. 应激反应，压力反应的</p>
<p>a remarkable moment in time 一个非凡的时刻</p>
<p>face over 面临</p>
<p>a completely different prospect</p>
<p>jam 堵塞</p>
<p>polluted</p>
<p>come about v. 产生，发生，改变方向</p>
<p>At the same time</p>
<p>in that period</p>
<p>lift out of 从... 中脱离出来</p>
<p>part of</p>
<p>a fundamental change</p>
<p>in the structure of</p>
<p>account for</p>
<p>a third of 1/3的</p>
<p>output</p>
<p>highlight</p>
<p>Now, the first of <s>these transformations</s> is the basic structural change of the economies and
societies that I've already begun to illustrate through the description of <s>Beijing</s>.</p>
<p>put on 穿上；上演；增加；假装；使…上场</p>
<p>profound structural change</p>
<p>in a negligent or a shortsighted way 以疏忽或短视的方式</p>
<p>waste, pollution, congestion, destruction of land and forests</p>
<p>negotiate with</p>
<p>stakes 赌注，</p>
<p>paying for</p>
<p>low-carbon economy</p>
<p>I've come to realize that</p>
<p>enormous opportunity</p>
<p>think ahead 预见，事先考虑</p>
<p>well established</p>
<p>renewal 更新</p>
<p>investment in 投资</p>
<p>regulating  e.g. regulating coal within a few years</p>
<p>reduced rapidly</p>
<p>striking results</p>
<p>intimately intertwined 紧密相连的</p>
<p>fossil fuels 化石燃料</p>
<p>We have to invest strongly in energy, we have to use it much more efficiently, and we have to make it clean.</p>
<p>bring back to 使恢复</p>
<p>renewables 可再生</p>
<p>striking achievement</p>
<p>the hosts to valuable plant and animal species</p>
<p>Portugal</p>
<p>cutting emissions 减少排放</p>
<p>The depth of understanding of the immense risks of climate change are not there</p>
<p>need political pressure to build</p>
<p>step up 提高，增加，走进</p>
<p>marine 海产的，航海的，海生的； 海运业，舰队，水兵</p>
<p>Oceania</p>
<p>We're expecting that ...</p>
<p>arable land 耕地</p>
<p>decline</p>
<p>head for 前往，出发，取向于</p>
<p>abundant</p>
<p>As far back as we can go</p>
<p>the amount of</p>
<p>amounts of</p>
<p>harvest</p>
<p>turn around 转到相反方向，好转，船只留港</p>
<p>turn out 发生；最后是，结果是；出席，参加，前去观看；关掉，熄灭（电灯、煤气等）；生产，制造</p>
<p>coastal areas</p>
<p>jurisdictions 司法权</p>
<p>control ove 支配，控制</p>
<p>quota 配额；定额；限额</p>
<p>bycatch 副捕捞</p>
<p>habitats 栖息地</p>
<p>nursery areas 育苗区</p>
<p>spawning areas 产卵区域，播种区</p>
<p>herring 鲱鱼</p>
<p>Norway</p>
<p>come down 下来，降落；流传下来；倒塌；落魄，失势</p>
<p>cost-effective 划算的；成本效益好的</p>
<p>irrigate 灌溉</p>
<p>graze 放牧</p>
<p>footprint 对环境的影响，脚注</p>
<p>obesity 肥胖</p>
<p>biodiversity 生物多样性</p>
<p>there's a catch 有一个棘手的问题</p>
<p>undermines 逐渐损毁；暗中破坏；在…下挖掘</p>
<p>sustainable 可以忍受的；足可支撑的；养得起的；可持续的</p>
<p>fraud 欺骗；骗子；诡计</p>
<p>traceability 可追溯性；跟踪能力；可描绘</p>
<p>Congress 国会；代表大会；会议；社交</p>
<p>bill [法] 法案；广告；账单；[金融] 票据；钞票；清单;宣布；开账单；用海报宣传</p>
<p>controvert 驳斥；就…展开争论;争论；辩论</p>
<p>attempt to</p>
<p>discernible 可辨别的；可识别的</p>
<p>profitably 有利地；有益地</p>
<p>lay hands on 找到，得到，攻击</p>
<p>in this regard to 考虑到</p>
<p>it is related to 和...相关</p>
<p>originate from 来自于</p>
<p>benefit from</p>
<p>Inspired by</p>
<p>extraordinarily high</p>
<p>Our purpose in theoretical physics is not just to describe the world as we find it, but to explain why the world is the way it is.</p>
<p>​														—————————Steven Weinberg</p>
<p>aside from</p>
<p>arise from</p>
<p>suspect that</p>
<p>strictly speaking</p>
<p>brush up on 温习，复习</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/07/Questions_records_with_MASTER/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/07/Questions_records_with_MASTER/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-07T14:51:26+08:00">
                2018-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>Q: 7/11/2018</h1>
<p>PN展开时候到底用了什么额外的条件？不要用坐标变换理解，这就变成了避开这个问题，而应该需要在Clifford Will书上寻找答案。</p>
<p>我要研究的问题开始于水星近日点的近动 <em>New General Relativistic Contribution to Mercury’s Perihelion Advance</em></p>
<p>Will根据他自己书上的得到了最终的加速度，up to 1PN。</p>
<p>现在我们从广义相对论出发BSSN formulation，使用punture condition 得到$K_{ij}$，其满足栋动量约束方程，再从Hamiltonian约束出发得到$\psi$，其形式非常简单，做到1PN近似，与Will的结果相同。我们希望得到一个准稳态的过程，即从演化方程中得到坐标条件Lapse和shift。</p>
<p>整个故事到这儿，我们实际上已经解了Einstein场方程，原则上整个时空就已经知道了。但是和Will不相同的就是坐标选取不同，即导致lapse和shift不相同。这是工作的第一阶段。</p>
<p>第二阶段：如何从我们的坐标变成Will的坐标？</p>
<p>我们从Harmonic condition 出发，得到我们的Isotropic坐标下的Harmonic 坐标，但是代价就是其不满足Einstein场方程。即使如此，在演化方程计算的时候，仍旧发现这个不满足的阶数与Will的1PN结果相同。至此，我们有理由相信最后我们与Will之间只是差一个在Harmonic坐标下的一个坐标变换。</p>
<p>第三段故事：问题：Will到底选取了什么样的额外的条件，使得$\alpha$和$\beta^i$有他写出来的样子？这就需要查书<strong><em>Poisson E., Will C.M.-Gravity_ Newtonian, Post-Newtonian, Relativistic-CUP (2014)</em></strong>，但是没找到，具体解决问题再问。</p>
<h1>Q: 14/11/2018</h1>
<p>在Will的书上，1PN的出发点就是 Einstein场方程+harmonic gauge condition 这就导致了后面的基本方程
$$
\begin{align}
\Box_{\eta} h^{\mu\nu} = \frac{16\pi G}{c^4}\tau^{\mu\nu}
\end{align}
$$
其中$\tau^{\mu\nu}$包含物质的能动张量，Landau-Lifshitz赝张量，harmonic gauge的规范potential，所以这个方程本身右边就是含着$h^{\mu\nu}$，这实际上就导致了方程的非线性性。对于这个方程的1PN来说，只有物质的能动张量才是非零贡献，而点源粒子又是给出$\delta$函数的样子。</p>
<p>对于我们的方程来说，满足的harmonic方程是
$$
\begin{align}
	(\partial_t -\beta^i\partial_i)\alpha = &amp; -2\alpha K,,\
	(\partial_t-\beta^j\partial_j)\beta^i = &amp; -\alpha^2(\gamma^{ij}\partial_j \log \alpha + \gamma^{jk}\Gamma^i_{jk})
\end{align}
$$
这里实际上存在两个问题：一个是方程都是几何量，没有物质的$\delta $函数的来源，看不出$\alpha$和$\beta$的解的形式，所以在这个意义上，将上面的方程改造为二阶导数的$\Box_\eta \alpha,~\Box_\eta\beta^i$，然后配合着Hamiltonian约束和momentum约束可以在后面出现点源里物质； 另一个问题，也是本质的问题，我们采取的是punture condition 和maximal slice condition将$K=0$变成我们的假设，但实际上在Will的1PN计算时，得到的$K$是$c^{-3}$的量，可以从演化方程看出
$$
\begin{align}
	\partial_t\log \psi  = -\frac{1}{6}\alpha K + \frac{1}{6}D_i \beta^i
\end{align}
$$
若$\psi$不含时间，则$K$和$\beta^i$的阶数是一样的，这就导致了我们的情况就是$K =0$时候，$\beta^i =0$，而这时候Will给出$\beta^i \sim c^{-3}$就意味着$K\sim c^{-3}$不可能会等于零，也就是说maximal slice condition与1PN计算是有矛盾之处的。</p>
<p>实际上第一个问题在第二个问题提出之后已经没有必要回答了，因为如果$\Box\alpha$和$\Box\beta^i$右边仍会出现$K$，或者$K_{ij}$，那么解$\alpha$和$\beta^i$的时候仍会出现和Will不同的结果。</p>
<h2>Solution Method</h2>
<p>这里我们发现没有任何办法解决这个问题，这本质就是假设的出发点的矛盾带来的效应，所以我们只能使用我们的conditions/gauge conditions 计算水星近日点的近动。</p>
<h1>Q: 10/1/2019</h1>
<h2>4 things to do with lessons</h2>
<ol>
<li>
<p>roughly check my calculation to ensure the accuracy YES</p>
</li>
<li>
<p>repeat the work in PRL of Shao, especially the orbital dynamics part, especially focus on the perihelion advance $\Delta\omega$ if it propotional to $1/e$. YUS</p>
</li>
<li>
<p>Why the unit described the advance is XX second/century? The observing data owns too long time scale or just simply enlarge the quantity? or other reasons. NO</p>
</li>
<li>
<p>repeat the figure 1 and specify our case.  YET</p>
</li>
<li>
<p>substitute the coefficients in $a_5$ and obtain the rough quantity.  ROUGHLY YES</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/25/Research-Records20181025/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/25/Research-Records20181025/" itemprop="url">Research Records</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-25T12:23:18+08:00">
                2018-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1>Records on 25/10/2018</h1>
<p>复习《概率论和数理统计》，需要完成《计算天文》作业。完成英语课后作业。</p>
<h2>随机变量及其概率密度</h2>
<p>对于随机变量$X$的分布函数$F(x)$， 存在非负可积函数$f(x)$， 使得对于任意实数$x$，有
$$
\begin{align}
	F(x) = \int_{-\infty}^x f(t)dt,,
\end{align}
$$
则称$X$为<strong>连续型随机变量</strong>， $f(x)$称为$X$的概率密度函数，简称为<strong>概率密度</strong> ，所以$F(x)$的意思就是概率$P(X\leq x)$。若随机变量$X$满足的概率密度为</p>
<p>​	
$$
\begin{align}
	f(x) = \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{(x-\mu)^2}{2\sigma^2
}},,~<s>\text{for}</s>~-\infty&lt; x &lt; \infty,,
\end{align}
$$
其中$\mu,\sigma~(\sigma&gt;0)$为常数，则称$X$服从参数为$\mu,\sigma$的<strong>正态分布</strong>或<strong>高斯</strong>分布，记为$X\sim N(\mu,\sigma)$。</p>
<p>#Records on 26/10/2018</p>
<p>学习数理统计的三章内容，包含参数估计(点估计和区间估计)、假设检验、方差分析及回归分析。</p>
<h2>1. 参数估计</h2>
<h3>1.1点估计</h3>
<h3>1.2区间估计</h3>
<p>​	<strong>置信区间</strong>	： 设总体样本$X$的分布函数$F(x;\theta)$ 含有一个未知参数$\theta,~\theta\in\Theta$ ($\Theta$是$\theta$可能取值的范围)， 对于给定值$\alpha~(0&lt;\alpha&lt;1)$ ， 若由来自$X$的样本$X_1,X_2,\cdots, X_n$确定的两个统计量$\underline{\theta} = \underline\theta(X_1,\cdots,X_n)$和$\bar{\theta}=\bar{\theta}(X_1,\cdots,X_n) (\underline\theta&lt;\bar\theta)$，对于任意$\theta\in\Theta$满足
$$
\begin{align}
	P{\underline\theta(X_1,\cdots,X_n)&lt;\theta&lt;\bar\theta(X_1,\cdots,X_n)} \geq 1-\alpha,,
\end{align}
$$
则称随机区间$(\underline\theta,\bar\theta)$是$\theta$的置信水平为$1-\alpha$的<strong>置信区间</strong>，$\underline\theta$和$\bar\theta$分别为置信水平为$1-\alpha$的双侧置信区间的<strong>置信下限</strong>和<strong>置信上限</strong>，$1-\alpha$称为<strong>置信水平</strong>.</p>
<p>​	对于正态分布，$X\sim N(\mu,\sigma^2)$，$\sigma^2$为已知，$\mu$未知，我们知道$\bar X$是$\mu$的无偏估计，且有</p>
<p>​	
$$
\begin{align}
	\frac{\bar X -\mu}{\sigma /\sqrt{n}} \sim N(0,1),.
\end{align}
$$
按照标准正态分布的上$\alpha$分位点的定义，有
$$
\begin{align}
	P\left{\left|\frac{\bar X -\mu}{\sigma\sqrt{n}} \right|&lt; z_{\alpha/2}\right} = 1-\alpha,,
\end{align}
$$
即
$$
\begin{align}
P\left{&lt; \bar X - \frac{\sigma}{\sqrt n} z_{\alpha/2}\mu &lt; \bar X + \frac{\sigma}{\sqrt n} z_{\alpha/2}\right} = 1-\alpha,.
\end{align}
$$
这样，我们就得到了$\mu$的置信水平为$1-\alpha$的置信区间</p>
<p>​	
$$
\begin{align}
	\left( \bar X -\frac{\sigma}{\sqrt n}z_{\alpha/2},\bar X +\frac{\alpha}{\sqrt n}z_{\alpha/2} \right),,
\end{align}
$$
这样的置信区间写成
$$
\begin{align}
\left( \bar X \pm \frac{\sigma}{\sqrt n}z_{\alpha/2} \right),.
\end{align}
$$</p>
<p>​	像正态分布那样，可以寻找未知参数$\theta$的置信区间的具体做法如下：</p>
<ol>
<li>
<p>寻找一个样本$X_1,\cdots,X_n$和$\theta$的函数$W=W(X_1,\cdots, X_n,\theta)$，使得$W$的分布不依赖于$\theta$以及其他未知参数，称具有这种性质的函数$W$为<strong>枢轴量</strong>。</p>
</li>
<li>
<p>对于给定的置信水平$1-\alpha$，定出两个常数$a,b$使得
$$
\begin{align}
P{\alpha &lt; W(X_1,X_2,\cdots,X_n;\theta)&lt;b } = 1-\alpha,.
\end{align}
$$
若能从$\alpha &lt; W(X_1,X_2,\cdots,X_n;\theta)&lt;b$得到与之等价的$\theta$不等式$\underline \theta&lt;\theta&lt;\bar\theta$，其中$\underline\theta = \underline \theta(X_1,X_2,\cdots,X_n)$，$\bar\theta = \bar\theta (X_1,\cdots,X_n)$都是统计量。那么$(\bar\theta,\underline\theta)$就是$\theta$的一个置信水平为$1-\alpha $的置信区间。</p>
</li>
</ol>
<p>枢轴量$W(X_1,\cdots,X_n;\theta)$的构造，通常可以从$\theta$的点估计着手考虑。常用的正太总体的参数的置信区间可以用上述的步骤获得。</p>
<h3>1.3正态总体均值与方差的区间估计</h3>
<p>设一给定置信水平为$1-\alpha$，并设$X_1,\cdots,X_n$为总体$N(\mu,\sigma^2)$的样本。$\bar X,~S^2$分别是样本均值和样本方差。</p>
<ol>
<li>
<p>假设$\mu$未知，$\sigma^2$已知：</p>
<p>此时可由上一节可知，取枢轴量$\frac {\bar X -\mu }{\sigma \sqrt n}$，已得到$\mu$的一个置信水平为$1-\alpha$的置信区间为
$$
\begin{align}
\left( \bar X \pm \frac{\sigma}{\sqrt n}z_{\alpha/2} \right),.
\end{align}
$$</p>
</li>
<li>
<p>假设$\mu$未知，$\sigma^2$未知：</p>
<p>此时就不能用上述的公式，因其含有未知参数$\sigma$。考虑到$S^2$是$\sigma^2$的无偏估计，将$\sigma$换成$S = \sqrt{S^2}$，由定理可知
$$
\begin{align}
	\frac{\bar X-\mu}{S\sqrt n } \sim t(n-1),,
\end{align}
$$
并且右边分布不依赖于任何未知参数，使用$\frac{\bar X-\mu}{S\sqrt n }$作为枢轴量可得
$$
\begin{align}
	P\left{ -t_{\alpha/2}(n-1)&lt;\frac{\bar X-\mu}{S\sqrt n }&lt; t_{\alpha/2}(n-1) \right} = 1-\alpha
\end{align}
$$
于是得$\mu$的一个置信水平为$1-\alpha$的置信区间
$$
\begin{align}
\left( \bar X \pm \frac{S}{\sqrt n}t_{\alpha/2}(n-1) \right),.
\end{align}
$$</p>
</li>
</ol>
<ol start="3">
<li>
<p>假设$\mu$未知，$\sigma$未知：</p>
<p>$\sigma^2$的无偏估计就是$S^2$，由定理可知
$$
\begin{align}
	\frac{(n-1)S^2}{\sigma^2} \sim \chi^2(n-1),,
\end{align}
$$
并且上式右端的分布不依于任何未知参数，取$\frac{(n-1)S^2}{\sigma^2}$作为枢轴量，即得
$$
\begin{align}
	P\left{ \chi^2_{1-\alpha/2}(n-1)&lt; \frac{(n-1)S^2}{\sigma^2}&lt; \chi^2_{\alpha/2}(n-1) \right} = 1-\alpha,.
\end{align}
$$</p>
<p>即
$$
\begin{align}
	P\left{ \frac{(n-1)S^2}{\chi^2_{\alpha/2}(n-1)}&lt;\sigma^2 &lt; \frac{(n-1)S^2}{\chi^2_{1-\alpha/2}(n-1)} \right} = 1-\alpha,.
\end{align}
$$
这就得到了方差$\sigma^2$的一个置信水平为$1-\alpha$的置信区间
$$
\begin{align}
	\left(\frac{(n-1)S^2}{\chi^2_{\alpha/2}(n-1)},\frac{(n-1)S^2}{\chi^2_{1-\alpha/2}(n-1)}\right),.
\end{align}
$$
这也告诉我们标准差$\sigma$的一个置信水平为$1-\alpha$的置信区间
$$
\begin{align}
	\left(\frac{\sqrt{(n-1)} S}{\sqrt {\chi^2_{\alpha/2}(n-1)}},\frac{\sqrt{(n-1)}S}{\sqrt{\chi^2_{1-\alpha/2}(n-1)}}\right),.
\end{align}
$$</p>
</li>
</ol>
<h3>1.4两个总体样本$N(\mu_1,\sigma^2_1),~N(\mu_2,\sigma^2_2)$的情况</h3>
<ol>
<li>
<p>两个总体均值差$\mu_1-\mu_2$的置信区间：</p>
<p>（1）$\sigma_1,\sigma_2$均为已知。因$\bar{X}, \bar{Y}$分别是$\mu_1,\mu_2$的无偏估计，故$\bar X- \bar Y$是$\mu_1-\mu_2$的无偏估计。由$\bar X, \bar Y$的独立性以及$\bar X\sim N(\mu_1,\sigma^2/n_1),~bar Y\sim N(\mu_2,\sigma^2/n_2)$得到
$$
\begin{align}
	\bar X-\bar Y \sim N\left(\mu_1-\mu_2,\frac{\sigma_1^2}{n_1}+\frac{\sigma_2^2}{n_2}\right)
\end{align}
$$
或者
$$
\begin{align}
	\frac{(\bar X-\bar Y) - (\mu_1-\mu_2)}{\sqrt{\frac{\sigma_1^2}{n_1}+\frac{\sigma_2^2}{n_2}}} \sim N(0,1)
\end{align}
$$
取$\frac{(\bar X-\bar Y) - (\mu_1-\mu_2)}{\sqrt{\frac{\sigma_1^2}{n_1}+\frac{\sigma_2^2}{n_2}}}$为枢轴量，即得$\mu_1-\mu_2$的一个置信水平为$1-\alpha$得置信区间
$$
\begin{align}
	\left( \bar X-\bar Y \pm z_{\alpha/2}\sqrt{\frac{\sigma_1^2}{n_1}+\frac{\sigma_2^2}{n_2}}\right)
\end{align}
$$
(2) $\sigma_1= \sigma_2 = \sigma$ ，但$\sigma^2$未知，此时由定理可知，构造枢轴量
$$
\begin{align}
	\frac{(\bar X-\bar Y) - (\mu_1-\mu_2)}{S_w \sqrt{\frac{1}{n_1}+\frac{1}{n_2}}} \sim t(n_1+n_2-2)
\end{align}
$$
可以得到$\mu_1-\mu_2$的一个置信水平为$1-\alpha$的置信区间为
$$
\begin{align}
	\left( \bar X- \bar Y \pm t_{\alpha/2}(n_1+n_2-2)S_w\sqrt{\frac{1}{n_1}+\frac{1}{n_2}} \right)
\end{align}
$$
此处	
$$
\begin{align}
	S_w^2 = \frac{(n_1-1)S_1^2 +(n_2-1)S_2^2}{n_1+n_2-2},,~~~S_w = \sqrt{S_w^2}
\end{align}
$$</p>
</li>
<li>
<p>两个总体方差比$\sigma_1^2/\sigma_2^2$的置信区间：</p>
</li>
</ol>
<p>当总体均值$\mu_1,~\mu_2$均未知，则由定理可以得到</p>
<p>​	
$$
\begin{align}
	\frac{S_1^2/S_2^2}{\sigma_1^2/\sigma_2^2} \sim F(n_1-1,n_2-1),,
\end{align}
$$
并且分布$F(n_1-1,n_2-1)$不依赖于任何未知的情况。取$\frac{S_1^2/S_2^2}{\sigma_1^2/\sigma_2^2} $为枢轴量得</p>
<p>​	
$$
\begin{align}
	P\left{ F_{1-\alpha/2}(n_1-1,n_2-1) &lt; \frac{S_1^2/S_2^2}{\sigma_1^2/\sigma_2^2}  &lt; F_{\alpha/2}(n_1-1,n_2-1) \right} = 1-\alpha
\end{align}
$$
即
$$
\begin{align}
	P\left{ \frac{S_1^2}{S_2^2} \frac{1}{F_{\alpha/2}(n_1-1,n_2-1)} &lt;\frac{\sigma_1^2}{\sigma_2^2} &lt;\frac{S_1^2}{S_2^2} \frac{1}{F_{1-\alpha/2}(n_1-1,n_2-1)} \right} = 1-\alpha,.
\end{align}
$$</p>
<h3>1.5 (0—1)分布参数的区间估计</h3>
<p>已知$(0—1)$ 分布的均值和方差分别为</p>
<p>​	
$$
\begin{align}
	\mu = P ,, ~~\sigma^2 = p(1-p),.
\end{align}
$$
设$X_1,\cdots, X_n$ 是一个样本。因样本容量$n$较大，由中心极限定理可知
$$
\begin{align}
	\frac{\sum_{i=1}^n X_i -n p}{\sqrt{np(1-p)}} = \frac{n\bar{X} -np}{\sqrt{np(1-p)}}
\end{align}
$$
近似服从$N(0,1)$分布，于是有
$$
\begin{align}
	P\left{ -z_{\alpha/2}&lt; \frac{n\bar{X} - np}{\sqrt{np(1-p)}}&lt;z_{\alpha/2} \right} \approx 1-\alpha
\end{align}
$$
而不等式$-z_{\alpha/2}&lt; \frac{n\bar{X} - np}{\sqrt{np(1-p)}}&lt;z_{\alpha/2}$等价于
$$
\begin{align}
	(n+z_{\alpha/2}^2)p^2-(2n\bar{X}+z_{\alpha/2}^2)p+n\bar{X}^2 &lt;0,,
\end{align}
$$
记
$$
\begin{align}
	p_1 = &amp; \frac{1}{2a}(-b-\sqrt{b^2-4ac})\
	p_2 = &amp; \frac{1}{2a}(-b+\sqrt{b^2-4ac})
\end{align}
$$</p>
<p>此处$a = n+z_{\alpha/2}^2,~b=-(2n\bar{X}+z_{\alpha/2}^2),~c = n\bar{X}^2$。于是我们得到一个置信水平为$1-\alpha$的置信区间
$$
\begin{align}
	(p_1,p_2),.
\end{align}
$$</p>
<h3>1.6单侧置信区间</h3>
<p>在某些时候我们需要研究未知参数的上限或者下限，这就引出了单侧置信区间的概念。</p>
<p>对于给定值$\alpha~(0&lt;\alpha&lt;1)$，若由样本$X_1,\cdots,X_n$确定的统计量$\underline{\theta}=\underline{\theta}(X_1,\cdots,X_n)$，对于任意$\theta\in\Theta$满足
$$
\begin{align}
	P(\theta&gt;\underline{\theta})\geq 1-\alpha,,
\end{align}
$$
则称随机区间$(\underline{\theta},\infty)$是$\theta$的置信水平为$1-\alpha$的<strong>单侧置信区间</strong>，$\underline{\theta}$称为$\theta$的置信水平为$1-\alpha$的<strong>单侧置信下限</strong>。</p>
<p>又若统计量$\bar{\theta}=\bar{\theta}(X_1,\cdots,X_n)$，对于任意$\theta\in\Theta$满足
$$
\begin{align}
	P(\theta&lt;\bar{\theta})\geq 1-\alpha,,
\end{align}
$$
则称随机区间$(-\infty,\bar{\theta})$是$\theta$的置信水平为$1-\alpha$的<strong>单侧置信区间</strong>，$\bar{\theta}$称为$\theta$的置信水平为$1-\alpha$的<strong>单侧置信下限</strong>。</p>
<h2>2. 假设检验</h2>
<h3>2.1.假设检验</h3>
<p>统计推断的另一个重要问题就是假设检验问题。在总体样本的分布函数完全未知或者只知其形式，但不知其参数的情况下，为了推断总体样本的某些位置特性，提出某些关于总体样本的假设。例如，提出总体样本服从泊松分布的假设，又如，对于真太分布总体样本提出数学期望等于$\mu_0$的假设等等。我们要根据样本对所提出的假设作出接受还是拒绝的决策。假设检验是作出这一决策的过程。</p>
<p>在显著性水平$\alpha$下，假设检验
$$
\begin{align}
	H_0:~\mu=\mu_0,,\
	H_1:~\mu\neq \mu_0,.
\end{align}
$$
也常说成&quot;在县属性水平$\alpha$下，针对$H_1$检验$H_0$&quot;。$H_0$称之为<strong>原假设</strong>或<strong>零假设</strong>，$H_1$称为<strong>备择假设</strong>。我们要进行的工作是，根据样本，按上述检验方法作出决策在$H_0$和$H_1$两者之间接受其一。</p>
<p>当检验统计量取在某个区域$C$中的值时，我们拒绝原假设$H_0$，则称区域$C$为<strong>拒绝域</strong>，拒绝域的边界点称为<strong>临界点</strong>。</p>
<p>由于检验法则是根据样本做出的，总有可能作出错误的决策。在假设$H_0$实际上为真时，我们可能犯拒绝$H_0$的错误，称这类“弃真”的错误为第1类错误。当$H_0$为不真时，我们也有可能接受$H_0$，称这类“取伪”的错误为第2类错误。记犯第2类错误的概率为
$$
\begin{align}
	P\left{ 当H_0不真接受H_0 \right}~<s>或</s>~P_{p\in H_1}\left{ 接受H_0 \right}
\end{align}
$$
为此，在确定检验法则时，我们应尽可能使犯两类错误的概率都较小。但是，一般来说，当样本容量固定时，若减小犯一类错误的概率，则犯另一类错误的概率往往会增大。若要使犯两类错误的概率都减小，除非增加样本容量。在给定样本容量的情况下，一般来说，我们总是控制犯第一类错误的概率，使它不大于$\alpha$，$\alpha$的大小视情况而定。通常取$\alpha$为$0.1,0.05,0.01,0.005$等值。这种只对犯第一类错误加以控制，而不考虑犯第二类错误的概率的检验，称为<strong>显著性检验</strong>。</p>
<p>形如$H_1:~\mu\neq \mu_0$的备择假设$H_1$，表示$\mu$可能大于$\mu_0$，也可能小于$\mu_0$，称之为<strong>双边备择假设</strong>，而称这样的$H_0,H_1$的假设检验为<strong>双边假设检验</strong>。</p>
<p>有时，我们只关心总体样本均值是否增大。此时，我们需要检验假设:
$$
\begin{align}
	H_0:~\mu\leq \mu_0,,\
	H_1:~\mu&gt; \mu_0,.
\end{align}
$$
这样的假设称为<strong>右边检验</strong>。类似地，我们有时需要检验假设
$$
\begin{align}
	H_0:~\mu\geq \mu_0,,\
	H_1:~\mu &lt;\mu_0,.
\end{align}
$$
这样的假设检验，称为<strong>左边检验</strong>。右边检验和左边检验统称为<strong>单边检验</strong>。</p>
<p>下边我们讨论单边检验的<strong>拒绝域</strong>。</p>
<p>设总体样本$X\sim N(\mu,\sigma)$，$\mu$是未知参数，$\sigma$已知，$X_1,\cdots,X_n$是来自于$X$的样本，给定显著性水平$\alpha$，我们来求检验问题
$$
\begin{align}
	H_0:~\mu\leq \mu_0,,\
	H_1:~\mu&gt; \mu_0,.
\end{align}
$$
的拒绝域。</p>
<p>因$H_0$中的全部$\mu$都比$H_1$中的$\mu$要小，当$H_1$为真时，观察值$\bar{x}$往往偏大，因此拒绝域的形式为
$$
\begin{align}
	\bar{x}\geq k~~~(k是某一个正常数).
\end{align}
$$
下面来确定$k$。
$$
\begin{align}
	P\left{ 当H_0为真拒绝H_0 \right} =&amp; P_{p\in H_0}\left{ \bar{X}\geq k \right}\
	=&amp;P_{\mu\leq \mu_0}\left{ \frac{\bar{X}-\mu_0}{\sigma\sqrt{n}} \geq \frac{k-\mu_0}{\sigma \sqrt{n}} \right}\
	\leq &amp;P_{\mu\leq \mu_0}\left{ \frac{\bar{X}-\mu}{\sigma\sqrt{n}} \geq \frac{k-\mu_0}{\sigma \sqrt{n}} \right}
\end{align}
$$
要控制$P\left{ 当H_0为真拒绝H_0 \right}\leq \alpha$，只需令
$$
\begin{align}
	P_{\mu\leq \mu_0}\left{ \frac{\bar{X}-\mu}{\sigma\sqrt{n}} \geq \frac{k-\mu_0}{\sigma \sqrt{n}} \right} = \alpha
\end{align}
$$
由于$\frac{\bar{X}-\mu}{\sigma\sqrt{n}}  \sim N(0,1)$，得到$\frac{k-\mu_0}{\sigma \sqrt{n}} =z_{\alpha}$，$k=\mu_0+\frac{\sigma}{\sqrt{n}}z_\alpha$，即得检验问题的拒绝域为
$$
\begin{align}
	\bar{x}\geq \mu_0+\frac{\sigma}{\sqrt{n}}z_\alpha,,
\end{align}
$$
即
$$
\begin{align}
	z = \frac{\bar{x}-\mu_0}{\sigma\sqrt{n}}\geq z_\alpha,.
\end{align}
$$
类似地，可以得到左边检验问题的拒绝域为
$$
\begin{align}
	z = \frac{\bar{x}-\mu_0}{\sigma\sqrt{n}}\leq z_\alpha,.
\end{align}
$$</p>
<p>对于正态总体方差的检验假设同样可以使用。只需要将$\mu$和$\mu_0$相应地替换成$\sigma$和$\sigma_0$即可。同理对于成对出现的数据，我们可以统计推断$\mu_1-\mu_2$和$\sigma_1^2/\sigma_2^2$的检验假设。</p>
<p>综合上述，可得处理参数的假设检验问题的步骤如下：</p>
<ol>
<li>根据实际问题的要求，提出原假设$H_0$及备择假设$H_1$;</li>
<li>给定显著性水平$\alpha$一级样本容量$n$;</li>
<li>确定检验统计量一级拒绝域的形式；</li>
<li>按$P\left{ 当H_0为真拒绝H_0 \right} \leq \alpha$求出拒绝域；</li>
<li>取样，根据样本观察值作出决策，是接受$H_0$还是拒绝$H_0$。</li>
</ol>
<h3>2.2.正态总体的假设检验</h3>
<h4>2.2.1 	<strong>Z检验法</strong></h4>
<h4>2.2.2	<strong>t检验法</strong></h4>
<h4>2.2.3	 (逐对比较法)成对数据的t检验法</h4>
<h4>2.2.4	 $\chi^2$检验法</h4>
<h4>2.2.5	$F$检验法</h4>
<h3>2.3.置信区间与假设检验之间的关系</h3>
<p>置信区间就是置信水平为$1-\alpha$的区间，假设检验将$\alpha$说成针对$H_1$的检验$H_0$的显著性水平。因而，显然两者之间有对应的联系。实际上，置信区间就是接受$H_0$的范围，在置信区间之外就在拒绝域之中了。</p>
<h3>2.4.样本容量的选取</h3>
<p>以上我们在进行假设检验时，总是根据问题的要求，预选给出显著性水平以控制犯第1类错误的概率，而犯第2类错误的概率则依赖于样本容量的选择，在实际问题中，我们除了希望控制犯第1类错误的概率之外，往往还希望控制犯第2类错误的概率。我们将说明如何选取样本的容量使得犯第2类错误的概率控制在预先给定的限度内。</p>
<p>我们先引入施行特征函数：</p>
<p><strong>定义</strong>  若$C$是参数$\theta$的某检验问题的一个检验法，
$$
\begin{align}
	\beta(\theta) = P_\theta(接受H_0)
\end{align}
$$
称为检验法$C$的<strong>施行特征函数</strong>或<strong>OC函数</strong>，其图形称为<strong>OC曲线</strong>。</p>
<p>由定义可知，若此检验法的显著性水平为$\alpha$，那么当真值$\theta\in H_0$时，$\beta(\theta)$就是作出正确判断的概率，故此时$\beta(\theta)\geq 1-\alpha$；而当$\theta\in H_1$时，则$\beta(\theta)$就是犯第2类错误的概率，而$1-\beta(\theta)$是作出正确判断的概率。函数$1-\beta(\theta)$称为检验法$C$的<strong>功效函数</strong>。当$\theta^<em>\in H_1$时，值$1-\beta(\theta^</em>)$称为检验法$C$在点$\theta^<em>$的</em><em>功效</em>*。它表示当参数$\theta$的真值为$\theta^*$时，检验法$C$作出正确判断的概率。</p>
<h4>2.4.1 Z检验法的OC函数</h4>
<p>右边检验问题。$H_0:\mu\leq \mu_0$，$H_1:\mu &gt;\mu_0$的OC函数是
$$
\begin{align}
	\beta(\mu) = P_{\mu}(接受H_0)= P_\mu \left{ \frac{\bar{X}-\mu_0}{\sigma\sqrt{n}} &lt;z_\alpha \right}= P_\mu \left{ \frac{\bar{X}-\mu}{\sigma\sqrt{n}} &lt;z_\alpha=\frac{\mu-\mu_0}{\sigma /\sqrt{n}} \right} = \Phi(z_\alpha -\lambda)
\end{align}
$$
其中$\lambda = \frac{\mu-\mu_0}{\sigma/\sqrt{n}}$. 此函数告诉我们，真值$\mu~(\mu&gt;\mu_0)$在$ \mu_0$附近时，检验法功效低，即$\beta(\mu)$很大，亦即犯第2类错误的概率很大。</p>
<p>这里我们可以使用OC函数$\beta(\mu)$来确定样本容量$n$，使党真值$\mu\geq \mu_0+\delta~(\delta&gt;0)$时，犯第2类错误的概率不超过给定的$\beta$。这是由于$\beta(\mu)$是$\mu$的递减函数，故当$\mu\geq\mu_0+\delta$时有
$$
\begin{align}
	\beta(\mu_0+\delta) \geq \beta(\mu)
\end{align}
$$
于是只要$\beta(\mu_0+\delta) = \Phi(z_\alpha -\sqrt{n}\delta /\sigma)\leq \beta$，亦即只要$n$满足
$$
\begin{align}
	z_\alpha -\sqrt{n}\delta/\sigma  \leq z_\beta
\end{align}
$$
即可。这就是说，只要
$$
\begin{align}
	\sqrt{n}\geq \frac{(z_\alpha+z_\beta)\sigma}{\delta}
\end{align}
$$
就能使当$\mu\in H_1$且$\mu\geq \mu_0+\delta$时犯第2类错误的概率不超过$\beta$。</p>
<p>类似地，可得左边检验问题$H_0:\mu\geq \mu_0$，$H_1:\mu  &lt;\mu_0$的OC函数是
$$
\begin{align}
	\beta(\mu) =\Phi(z_\alpha+\lambda),,~~~\lambda = \frac{\mu-\mu_0}{\sigma/\sqrt{n}}
\end{align}
$$
当真值$\mu\geq \mu_0$时 $\beta(\mu)$为作出正确判断的概率；当真值$\mu&lt;\mu_0$时，$\beta(\mu)$给出犯第2类错误的概率。只要样本容量$n$满足
$$
\begin{align}
	\sqrt{n} \geq \frac{(z_\alpha+z_\beta)\sigma}{\delta}
\end{align}
$$
就能使当$\mu\in H_1$且$\mu\leq \mu_0-\delta~(\delta&gt;0)$时，犯第2类错误的概率不超过给定的值$\beta$.</p>
<p>同理，双边检验。</p>
<h4>2.4.2 $t$检验法的OC函数</h4>
<p>右边检验问题$H_0: ~\mu\leq \mu_0$，$H_1:~\mu &gt;\mu_0$的$t$检验法的OC函数为
$$
\begin{align}
	\beta(\mu) = P_\mu\left{ 接受H_0 \right} = P_\mu\left{ \frac{\bar{X}-\mu_0}{S/\sqrt{n}} &lt; t_\alpha(n-1) \right}
\end{align}
$$
其中变量
$$
\begin{align}
	\frac{\bar{X}-\mu_0}{S/\sqrt{n}} = \left( \frac{\bar{X}-\mu}{\sigma/\sqrt{n}}  \right)\bigg/\left( \frac{S}{\sigma}\right),,~~~\lambda = \frac{\mu-\mu_0}{\sigma/\sqrt{n}},.
\end{align}
$$
我们称变量$\frac{\bar{X}-\mu_0}{S/\sqrt{n}}$服从非中心参数为$\lambda$、自由度为$n-1$的非中心$t$分布。在$\lambda = 0$时，它是通常的$t(n-1)$变量。</p>
<p>若给定$\alpha,\beta$以及$\delta&gt;0$，则可以得到所需的容量$n$，使得当$\mu\in H_1$且$\frac{\mu-\mu_0}{\sigma}\geq \delta$时犯第2类错误的概率不超过$\beta$。</p>
<p>若给定$\alpha,\beta$以及$\delta&gt;0$，对于左边检验问题$H_0: ~\mu\geq \mu_0$，$H_1:~\mu &lt; \mu_0$的$t$检验法，也可以得到所需的容量$n$，使得当$\mu\in H_1$且$\frac{\mu-\mu_0}{\sigma}\leq -\delta$时犯第2类错误的概率不超过$\beta$。</p>
<p>若给定$\alpha,\beta$以及$\delta&gt;0$，对于双边检验问题$H_0: ~\mu = \mu_0$，$H_1:~\mu \neq \mu_0$的$t$检验法，也可以得到所需的容量$n$，使得当$\mu\in H_1$且$\frac{\mu-\mu_0}{\sigma}\geq \delta$时犯第2类错误的概率不超过$\beta$。</p>
<p>同理可以得到两个正态总体均值差的$t$检验。</p>
<h3>2.5. 分布拟合检验</h3>
<p>上面介绍的各种检验法都是在总体分布形式已知的情况下进行讨论的。但在实际问题中，有时不能知道总体服从什么类型的分布，这时就需要根据样本来检验关于分布的假设。我们主要讲$\chi^2$拟合检验法。它可以用来检验总体是否具有某一个指定的分布或属于某一个分布族，还介绍专门用于检验分布是否为正态分布的&quot;偏度、峰度检验法&quot;。</p>
<h4>2.5.1 单个分布的$\chi^2$拟合检验法</h4>
<p>设总体$X$的分布未知，$x_1,\cdots,x_n$是来自$X$的样本值。我们来检验假设
$$
\begin{align}
	&amp;H_0:~总体X的分布函数为F(x),,\
	&amp;H_1:~总体X的分布函数不是F(x),.
\end{align}
$$
其中设$F(x)$不含未知参数。</p>
<p>下面来定义检验统计量。讲在$H_0$下$X$可能去治的全体$\Omega$分成互不相交的子集$A_1,\cdots,A_n$，以$f_i(i=1,2,\cdots,k )$记样本观察值$x_1,\cdots,x_n$中落在$A_i$的个数，这表示时间$A_i = {X的值落在子集A_i内}$在$n$此独立试验中发生$f_i$次，于是在这$n$此试验中时间$A_i$发生的概率为$f_i/n$。另一方面，当$H_0$为真时，我们可以根据$H_0$中所假设的$X$的分布函数来计算事件$A_i$的概率，得到$p_i=P(A_i)$，$i=1,2,\cdots,k$。频率$f_i/n$和概率$p_i$会有差异，但一般来说，当$H_0$为真时，且试验的次数又甚多时，这种差异不应太大，因此$\left( \frac{f_i}{n}-p_i \right)^2$不应太大。我们采用如下形式
$$
\begin{align}
	\sum_{i=1}^k C_i\left( \frac{f_i}{n}-p_i \right)^2
\end{align}
$$
的统计量来度量样本与$H_0$中所假设的分布的吻合程度，其中$C_i~(i=1,2,\cdots,k)$为给定的常数。如果选取$C_i = n/p_i$，则这个呃统计量具有如下描述的定力中所述的简单性质。我们因此采用
$$
\begin{align}
	\chi^2 = \sum_{i=1}^k \frac{n}{p_i}\left( \frac{f_i}{n}-p_i \right)^2 = \sum_{i=1}^k \frac{f_i^2}{np_i}-n
\end{align}
$$
作为检验统计量。</p>
<p><strong>定理</strong>  若$n$充分大$(n\geq 50)$，则当$H_0$为真时，上述的统计量近似服从$\chi^2(k-1)$分布。</p>
<p>根据以上的讨论，当$H_0$为真时，$\chi^2$不应太大，如$\chi^2$太大就拒绝$H_0$，拒绝域的形式为	
$$
\begin{align}
	\chi^2 \geq G~~~(G为正常数)
\end{align}
$$
对于给定的显著性水平$\alpha$，确定$G$使
$$
\begin{align}
	P\left{ 当H_0位真时拒绝H_0 \right} = P_{H_0}\left{ \chi^2\geq G \right} = \alpha
\end{align}
$$
由上述定理得到$G = \chi^2_\alpha(k-1)$。即当样本观察值使$\chi^2$的值有
$$
\begin{align}
	\chi^2\geq \chi^2_\alpha(k-1),,
\end{align}
$$
则在显著性水平$\alpha$下拒绝$H_0$；否则就接受$H_0$。这就是单个分布的**$\chi^2$拟合检验法**。</p>
<p>$\chi^2$拟合检验法是机遇上述定理得到的，所以使用时必须注意$n$不能小于50. 此外$np_i$不能太小，应有$np_i\geq 5$，否则应适当合并$A_i$，以满足这个要求。</p>
<h4>2.5.2 分布族的$\chi^2$拟合检验</h4>
<p>上面要求总体$X$的分布函数是$F(x)$，其中$F(x)$是已知的，这种情况是不多的。我们经常遇到的所需检验的原假设是
$$
\begin{align}
	H_0:~总体X的分布函数是F(x;\theta_1,\cdots,\theta_r),,
\end{align}
$$
其中$F$的形式已知，而$\mathbf {\theta}= (\theta_1,\cdots,\theta_n)$是未知参数。不同的$\theta_i$给出不同的分布，因而$F(x;\theta_1,\cdots,\theta_n)$代表一族分布。上面的$H_0$表示总体$X$的分布属于分布族$F(x;\theta_1,\cdots,\theta_n)$。采用类似于上一节的方法来定义检验统计量，将在$H_0$下$X$可能取值的全体$\Omega$分成$k~(k&gt;r+1)$个互不相交的子集$A_1,\cdots,A_k$，以$f_i~(i=1,2,\cdots,k)$记样本观察值$x_1,\cdots,x_n$落在$A_i$的个数，则事件$A_i = { X的值落在A_i内 }$的频率为$f_i/n$。另一方面，当$H_0$为真时，由$H_0$所假设的分布函数来计算$P(A_i)$，得到$P(A_i) = p(\theta_1,\cdots,\theta_r) = p(\theta) = p_i$。此时，需先利用样本求出未知参数的最大似然估计，以估计值作为参数值，求出$p_i$的估计值$\hat{p} = \hat{P}(A_i)$，取
$$
\begin{align}
	\chi^2 = \sum_{i=1}^k \frac{f_i^2}{np_i} - n
\end{align}
$$
作为假设检验$H_0$的统计量。可以证明，在某些条件下，在$H_0$为真时近似地有
$$
\begin{align}
	\chi^2  = \sum_{i=1}^k \frac{f_i^2}{n p_i} - n \sim \chi^2(k-r-1)
\end{align}
$$
可以得到假设检验的拒绝域为
$$
\begin{align}
	\chi^2 \geq \chi^2_\alpha (k-r-1),,
\end{align}
$$
$\alpha$为显著性水平。以上就是用来检验分布族的$\chi^2$拟合检验法。</p>
<h3>2.8 假设检验问题的$p$值法</h3>
<p>以上我们讨论的检验假设的方法称为<strong>临界法</strong>。我们现在介绍另一种被称为$p$值法的检验方法。</p>
<p><strong>定义</strong> 假设检验问题的$p$值可以根据检验统计量的样本观察得出原假设可能被拒绝的最小显著性水平。</p>
<p>常用的检验问题的$p$值可以根据检验统计量的样本观察值一级检验统计量在$H_0$下一个特定的参数值(一般是$H_0$和$H_1$所规定的参数的分界点)对应的分布求出。例如在正态总体$N(\mu,\sigma)$均值的检验中，当$\sigma$未知时，可采用检验统计量$t = \frac{\bar{X}-\mu_0}{S/\sqrt{n}}$，在以下三个检验问题中，当$\mu=\mu_0$时$t\sim t(n-1)$。如果由样本求得统计量$t$得观测值为$t_0$，那么在检验问题
$$
\begin{align}
	&amp;H_0:~\mu\leq \mu_0,~~H_1:~\mu&gt;\mu_0中,,\
	&amp;P值=P_{\mu_0}\left{ t\geq t_0\right} = t_0右侧尾部面积,,\
	&amp;H_0:~\mu\geq \mu_0,~~H_1:~\mu&lt;\mu_0中,,\
	&amp;P值=P_{\mu_0}\left{ t\leq t_0\right} = t_0左侧尾部面积,,\
	&amp;H_0:~\mu = \mu_0,<s>H_1:~\mu\neq \mu_0中,,\
	&amp;</s>(1)当t_0&gt;0时\
	&amp;~~~~~~~~~~~~<s>p值=P_{\mu_0}\left{ |t|\geq t_0 \right}=2\times (t_0右侧尾部面积) \
	&amp;</s>(2)当t_0&lt;0时\
	&amp;~~~~~~~~~~~~~~p值=P_{\mu_0}\left{ |t|\geq -t_0 \right}=2\times (t_0左侧尾部面积)
\end{align}
$$
按照$p$值法的定义，对于任意指定的显著水平$\alpha$就有</p>
<p>​	(1) 若$p$值$\leq \alpha$，则在显著水平$\alpha$下拒绝$H_0$，</p>
<p>​	(2) 若$p$值$&gt; \alpha$，则在显著水平$\alpha$下接受$H_0$。</p>
<p>有了这两条结论就能方便地确定是否拒绝$H_0$，这种方法就称为$p$值法。</p>
<h1>Records on 27/10/2018</h1>
<h3>Examine up to 1PN isotropic coordinate patch equivalent to harmonic coordinate system with lapse and shift expressions</h3>
<p>We give the initial data, follows,</p>
<p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(*coordinates and initial data*)</span></span><br><span class="line">coord = &#123;x, y, z&#125;;</span><br><span class="line">vz1 = <span class="number">0</span>; vz2 = <span class="number">0</span>; r1 = <span class="keyword">Sqrt</span>[x^<span class="number">2</span> + y^<span class="number">2</span> + z^<span class="number">2</span>]; r2 = </span><br><span class="line"> <span class="keyword">Sqrt</span>[x^<span class="number">2</span> + y^<span class="number">2</span> + z^<span class="number">2</span> + R^<span class="number">2</span> - </span><br><span class="line">   <span class="number">2</span> R y]; \[Theta]<span class="number">1</span> = \[Theta]; \[Theta]<span class="number">2</span> = </span><br><span class="line"> <span class="keyword">ArcCos</span>[r1/r2 <span class="keyword">Cos</span>[\[Theta]<span class="number">1</span>]]; v1 = </span><br><span class="line"> vx1^<span class="number">2</span> + vy1^<span class="number">2</span>; vn1 = (vx1  x/r1 + vy1 y/r1)^<span class="number">2</span>; v2 = <span class="number">0</span>; vn2 = <span class="number">0</span>;</span><br><span class="line">vx2 = <span class="number">0</span>;</span><br><span class="line">vy2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">(*lapse function*)</span> <span class="comment">(*note that here is alpha not g_&#123;00&#125;=-alpha^2*)</span></span><br><span class="line">\[Alpha][x_, y_, z_] := </span><br><span class="line">  <span class="number">1</span> + (-((G m1)/r1) - (G m2)/r2)/c^<span class="number">2</span> + </span><br><span class="line">  <span class="number">1</span>/c^<span class="number">4</span> ((G^<span class="number">2</span> m1^<span class="number">2</span>)/(<span class="number">2</span> r1^<span class="number">2</span>) + (<span class="number">5</span> G^<span class="number">2</span> m1 m2)/(<span class="number">4</span> R r1) + (</span><br><span class="line">     G^<span class="number">2</span> m1 m2 r1)/(<span class="number">4</span> R^<span class="number">3</span>) + (G^<span class="number">2</span> m2^<span class="number">2</span>)/(<span class="number">2</span> r2^<span class="number">2</span>) + (<span class="number">5</span> G^<span class="number">2</span> m1 m2)/(</span><br><span class="line">     <span class="number">4</span> R r2) + (G^<span class="number">2</span> m1 m2)/(r1 r2) - (G^<span class="number">2</span> m1 m2 r1^<span class="number">2</span>)/(<span class="number">4</span> R^<span class="number">3</span> r2) + (</span><br><span class="line">     G^<span class="number">2</span> m1 m2 r2)/(<span class="number">4</span> R^<span class="number">3</span>) - (G^<span class="number">2</span> m1 m2 r2^<span class="number">2</span>)/(<span class="number">4</span> R^<span class="number">3</span> r1) - (</span><br><span class="line">     <span class="number">2</span> G m1 v1)/r1 - (<span class="number">2</span> G m2 v2)/r2 + (G m1 vn1)/(<span class="number">2</span> r1) + (G m2 vn2)/(</span><br><span class="line">     <span class="number">2</span> r2));</span><br><span class="line"></span><br><span class="line"><span class="comment">(*shift vector*)</span></span><br><span class="line">\[<span class="keyword">Beta</span>] = &#123;-((4 G m1 vx1)/(c^3 r1)) - (4 G m2 vx2)/(</span><br><span class="line">    c^3 r2), -((4 G m1 vy1 )/(c^3 r1)) - (4 G m2 vy2 )/(</span><br><span class="line">    c^3 r2), -((4 G m1 vz1 )/(c^3 r1)) - (4 G m2 vz2 )/(c^3 r2)&#125;;</span><br><span class="line">\[Psi][x_, y_, z_] := <span class="number">1</span> + (<span class="number">2</span> G m1)/(c^<span class="number">2</span> r1) + (<span class="number">2</span> G m2)/(c^<span class="number">2</span> r2);</span><br><span class="line">\[Psi]<span class="number">1</span>[x_, y_, z_] := <span class="number">1</span> - (<span class="number">2</span> G m1)/(c^<span class="number">2</span> r1) - (<span class="number">2</span> G m2)/(c^<span class="number">2</span> r2);</span><br><span class="line"></span><br><span class="line"><span class="comment">(* 3-metric which is conformal to flat space in isotropic coordinates *)</span></span><br><span class="line">metric = &#123;&#123;\[Psi][x, y, z], 0, 0&#125;, &#123;0, \[Psi][x, y, z], 0&#125;, &#123;0, </span><br><span class="line">    0, \[Psi][x, y, z]&#125;&#125;;</span><br><span class="line"><span class="comment">(* inverse 3-metric *)</span></span><br><span class="line">inversemetric = &#123;&#123;\[Psi]1[x, y, z], 0, 0&#125;, &#123;0, \[Psi]1[x, y, z], </span><br><span class="line">    0&#125;, &#123;0, 0, \[Psi]1[x, y, z]&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">(*confomal 3-metric and its inverse metric*)</span>  </span><br><span class="line">confmetric = &#123;&#123;1, 0, 0&#125;, &#123;0, 1, 0&#125;, &#123;0, 0, 1&#125;&#125;;</span><br><span class="line">inverseconfmetric = &#123;&#123;1, 0, 0&#125;, &#123;0, 1, 0&#125;, &#123;0, 0, 1&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">(*derive affine connection and Ricci tensor*)</span></span><br><span class="line">affine := affine = <span class="keyword">Table</span>[(<span class="number">1</span>/<span class="number">2</span>)*<span class="keyword">Sum</span>[(inversemetric[[i, s]])*</span><br><span class="line">      (<span class="keyword">D</span>[metric[[s, j]], coord[[k]] ] +</span><br><span class="line">        <span class="keyword">D</span>[metric[[s, k]], coord[[j]] ] - </span><br><span class="line">        <span class="keyword">D</span>[metric[[j, k]], coord[[s]] ]), &#123;s, 1, 3&#125;],</span><br><span class="line">   &#123;i, 1, 3&#125;, &#123;j, 1, 3&#125;, &#123;k, 1, 3&#125;]  <span class="comment">(*Christoffel symbol*)</span></span><br><span class="line"></span><br><span class="line">riemann := riemann = <span class="keyword">Table</span>[</span><br><span class="line">   <span class="keyword">D</span>[affine[[i, j, l]], coord[[k]] ] - </span><br><span class="line">    <span class="keyword">D</span>[affine[[i, j, k]], coord[[l]] ] +</span><br><span class="line">    <span class="keyword">Sum</span>[affine[[s, j, l]] affine[[i, k, s]] - </span><br><span class="line">      affine[[s, j, k]] affine[[i, l, s]],</span><br><span class="line">     &#123;s, 1, 3&#125;],</span><br><span class="line">   &#123;i, 1, 3&#125;, &#123;j, 1, 3&#125;, &#123;k, 1, 3&#125;, &#123;l, 1, 3&#125;] <span class="comment">(*Riemann tensor*)</span></span><br><span class="line"></span><br><span class="line">RR := RR = </span><br><span class="line">  <span class="keyword">Table</span>[<span class="keyword">Sum</span>[riemann[[i, j, i, l]], &#123;i, 1, 3&#125;], &#123;j, 1, 3&#125;, &#123;l, 1, 3&#125;] <span class="comment">(*Ricci tensor*)</span></span><br><span class="line">RRR = <span class="keyword">Sum</span>[inversemetric[[i, j]] RR[[i, j]], &#123;i, 1, 3&#125;, &#123;j, 1, 3&#125;] ;  <span class="comment">(*Ricci scalar*)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">(*obtain 4-dimensional affine connection*)</span></span><br><span class="line">n = <span class="number">4</span>;</span><br><span class="line">coord1 = &#123;t, x, y, z&#125;;</span><br><span class="line">u[i_] := <span class="number">0</span> ;</span><br><span class="line"><span class="comment">(*4-velocity*)</span></span><br><span class="line">u[<span class="number">1</span>] = (\[Alpha][x, y, z])^<span class="number">-1</span>; </span><br><span class="line">u[<span class="number">2</span>] = - (\[Alpha][x, y, z])^<span class="number">-1</span> \[<span class="keyword">Beta</span>][[<span class="number">1</span>]]; </span><br><span class="line">u[<span class="number">3</span>] = - (\[Alpha][x, y, z])^<span class="number">-1</span> \[<span class="keyword">Beta</span>][[<span class="number">2</span>]]; </span><br><span class="line">u[<span class="number">4</span>] = - (\[Alpha][x, y, z])^<span class="number">-1</span> \[<span class="keyword">Beta</span>][[<span class="number">3</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">(*metric and its inverse*)</span></span><br><span class="line">g[i_, j_] = <span class="number">0</span>; g[<span class="number">1</span>, <span class="number">1</span>] = -\[Alpha][x, y, z]^<span class="number">2</span>; </span><br><span class="line">g[<span class="number">1</span>, <span class="number">2</span>] = <span class="keyword">Sum</span>[ metric[[<span class="number">1</span>, k]] \[<span class="keyword">Beta</span>][[k]], &#123;k, 1, 3&#125;]; </span><br><span class="line">g[<span class="number">2</span>, <span class="number">1</span>] = g[<span class="number">1</span>, <span class="number">2</span>]; </span><br><span class="line">g[<span class="number">1</span>, <span class="number">3</span>] = <span class="keyword">Sum</span>[ metric[[<span class="number">2</span>, k]] \[<span class="keyword">Beta</span>][[k]], &#123;k, 1, 3&#125;]; </span><br><span class="line">g[<span class="number">3</span>, <span class="number">1</span>] = g[<span class="number">1</span>, <span class="number">3</span>];</span><br><span class="line">g[<span class="number">1</span>, <span class="number">4</span>] = <span class="keyword">Sum</span>[ metric[[<span class="number">3</span>, k]] \[<span class="keyword">Beta</span>][[k]], &#123;k, 1, 3&#125;];</span><br><span class="line">g[<span class="number">4</span>, <span class="number">1</span>] = g[<span class="number">1</span>, <span class="number">4</span>];</span><br><span class="line">g[<span class="number">2</span>, <span class="number">2</span>] = metric[[<span class="number">1</span>, <span class="number">1</span>]]; g[<span class="number">2</span>, <span class="number">3</span>] = metric[[<span class="number">1</span>, <span class="number">2</span>]]; </span><br><span class="line">g[<span class="number">2</span>, <span class="number">4</span>] = metric[[<span class="number">1</span>, <span class="number">3</span>]];</span><br><span class="line">g[<span class="number">3</span>, <span class="number">2</span>] = metric[[<span class="number">2</span>, <span class="number">1</span>]]; g[<span class="number">3</span>, <span class="number">3</span>] = metric[[<span class="number">2</span>, <span class="number">2</span>]]; </span><br><span class="line">g[<span class="number">3</span>, <span class="number">4</span>] = metric[[<span class="number">2</span>, <span class="number">3</span>]];</span><br><span class="line">g[<span class="number">4</span>, <span class="number">2</span>] = metric[[<span class="number">3</span>, <span class="number">1</span>]]; g[<span class="number">4</span>, <span class="number">3</span>] = metric[[<span class="number">3</span>, <span class="number">2</span>]]; </span><br><span class="line">g[<span class="number">4</span>, <span class="number">4</span>] = metric[[<span class="number">3</span>, <span class="number">3</span>]];</span><br><span class="line"></span><br><span class="line">inverseg[i_, j_] := <span class="number">0</span>; inverseg[<span class="number">1</span>, <span class="number">1</span>] = -\[Alpha][x, y, z]^<span class="number">-2</span>;</span><br><span class="line">inverseg[<span class="number">1</span>, </span><br><span class="line">  <span class="number">2</span>] = -\[Alpha][x, y, z]^<span class="number">-2</span> <span class="keyword">Sum</span>[ </span><br><span class="line">   metric[[<span class="number">1</span>, k]] \[<span class="keyword">Beta</span>][[k]], &#123;k, 1, 3&#125;]; </span><br><span class="line">inverseg[<span class="number">2</span>, <span class="number">1</span>] = inverseg[<span class="number">1</span>, <span class="number">2</span>]; </span><br><span class="line">inverseg[<span class="number">1</span>, </span><br><span class="line">  <span class="number">3</span>] = -\[Alpha][x, y, z]^<span class="number">-2</span> <span class="keyword">Sum</span>[ </span><br><span class="line">   metric[[<span class="number">2</span>, k]] \[<span class="keyword">Beta</span>][[k]], &#123;k, 1, 3&#125;]; </span><br><span class="line">inverseg[<span class="number">3</span>, <span class="number">1</span>] = inverseg[<span class="number">1</span>, <span class="number">3</span>];</span><br><span class="line">inverseg[<span class="number">1</span>, </span><br><span class="line">   <span class="number">4</span>] = -\[Alpha][x, y, z]^<span class="number">-2</span> <span class="keyword">Sum</span>[ </span><br><span class="line">    metric[[<span class="number">3</span>, k]] \[<span class="keyword">Beta</span>][[k]], &#123;k, 1, 3&#125;];</span><br><span class="line">inverseg[<span class="number">4</span>, <span class="number">1</span>] = inverseg[<span class="number">1</span>, <span class="number">4</span>];</span><br><span class="line">inverseg[<span class="number">2</span>, <span class="number">2</span>] = inversemetric[[<span class="number">1</span>, <span class="number">1</span>]]; </span><br><span class="line">inverseg[<span class="number">2</span>, <span class="number">3</span>] = inversemetric[[<span class="number">1</span>, <span class="number">2</span>]]; </span><br><span class="line">inverseg[<span class="number">2</span>, <span class="number">4</span>] = inversemetric[[<span class="number">1</span>, <span class="number">3</span>]];</span><br><span class="line">inverseg[<span class="number">3</span>, <span class="number">2</span>] = inversemetric[[<span class="number">2</span>, <span class="number">1</span>]]; </span><br><span class="line">inverseg[<span class="number">3</span>, <span class="number">3</span>] = inversemetric[[<span class="number">2</span>, <span class="number">2</span>]]; </span><br><span class="line">inverseg[<span class="number">3</span>, <span class="number">4</span>] = inversemetric[[<span class="number">2</span>, <span class="number">3</span>]];</span><br><span class="line">inverseg[<span class="number">4</span>, <span class="number">2</span>] = inversemetric[[<span class="number">3</span>, <span class="number">1</span>]]; </span><br><span class="line">inverseg[<span class="number">4</span>, <span class="number">3</span>] = inversemetric[[<span class="number">3</span>, <span class="number">2</span>]]; </span><br><span class="line">inverseg[<span class="number">4</span>, <span class="number">4</span>] = inversemetric[[<span class="number">3</span>, <span class="number">3</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">(*Christoffel symbol*)</span></span><br><span class="line">affine1 := affine1 = <span class="keyword">Table</span>[(<span class="number">1</span>/<span class="number">2</span>)*<span class="keyword">Sum</span>[(inverseg[i, s])*</span><br><span class="line">      (<span class="keyword">D</span>[g[s, j], coord1[[k]] ] +</span><br><span class="line">        <span class="keyword">D</span>[g[s, k], coord1[[j]] ] - <span class="keyword">D</span>[g[j, k], coord1[[s]] ]), &#123;s, 1, </span><br><span class="line">      n&#125;],</span><br><span class="line">   &#123;i, 1, n&#125;, &#123;j, 1, n&#125;, &#123;k, 1, n&#125;] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">(* extrinsic curvature according to its definition and trace*)</span></span><br><span class="line">kkk[i_, j_] := -<span class="keyword">D</span>[u[i + <span class="number">1</span>], coord[j]] + </span><br><span class="line">   <span class="keyword">Sum</span>[affine1[[k, i + <span class="number">1</span>, j + <span class="number">1</span>]] u[k], &#123;k, 1, 4&#125;] - </span><br><span class="line">   u[i + <span class="number">1</span>] <span class="keyword">D</span>[<span class="keyword">Log</span>[\[Alpha][x, y, z]], coord[j]];</span><br><span class="line">kk = <span class="keyword">Sum</span>[inversemetric[[i, j]] kkk[i, j], &#123;i, 1, 3&#125;, &#123;j, 1, 3&#125;];</span><br><span class="line"> </span><br><span class="line"> <span class="comment">(* alternatively extrinsic curvature solved in isotropic coordinates, but here we use the above one*)</span></span><br><span class="line"> k[i_, j_] := (<span class="number">3</span> m1)/(</span><br><span class="line">   <span class="number">2</span> r1^<span class="number">2</span>) ( </span><br><span class="line">    v1[i] nn1[j] + </span><br><span class="line">     v1[j] nn1[i] - (confmetric[i, j] - nn1[i] nn1[j]) <span class="keyword">Sum</span>[</span><br><span class="line">       v1[k] nn1[k], &#123;k, 1, 3&#125;]) + (<span class="number">3</span> m2)/(</span><br><span class="line">   <span class="number">2</span> r2^<span class="number">2</span>) ( </span><br><span class="line">    v2[i] nn2[j] + </span><br><span class="line">     v2[j] nn2[i] - (confmetric[i, j] - nn2[i] nn2[j]) <span class="keyword">Sum</span>[</span><br><span class="line">       v2[k] nn2[k], &#123;k, 1, 3&#125;])</span><br><span class="line">k = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">(*conformal extrinsic curvature*)</span></span><br><span class="line">A[i_, j_] := (<span class="number">1</span> - <span class="number">3</span> m1/r1 - <span class="number">3</span> m2/r2) kkk[i, j];</span><br></pre></td></tr></table></figure></p>
<p>Now we calculate the evolution equations in terms of the quantities above</p>
<p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(*harmonic gauge condition*)</span></span><br><span class="line">ggg[l_] := </span><br><span class="line"> <span class="keyword">Series</span>[<span class="keyword">Sum</span>[</span><br><span class="line">   <span class="keyword">D</span>[<span class="keyword">Sqrt</span>[-<span class="keyword">Det</span>[  <span class="keyword">Table</span>[ g[i, j] , &#123;i, 1, 4&#125;, &#123;j, 1, 4&#125;] ]] inverseg[k,</span><br><span class="line">       l], coord1[[k]]], &#123;k, 1, 4&#125;], &#123;c, Infinity, 3&#125;]</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(*\partial_t\psi*)</span></span><br><span class="line"><span class="keyword">Dt</span>\[Psi] = </span><br><span class="line"> <span class="keyword">Series</span>[-(<span class="number">1</span>/<span class="number">6</span>) \[Alpha][x, y, z] \[Psi][x, y, z] kk + </span><br><span class="line">   <span class="keyword">Sum</span>[\[<span class="keyword">Beta</span>][[i]] <span class="keyword">D</span>[\[Psi][x, y, z], coord[[i]]], &#123;i, 1, 3&#125;] + </span><br><span class="line">   <span class="number">1</span>/<span class="number">6</span> <span class="keyword">Sum</span>[\[Psi][x, y, z] <span class="keyword">D</span>[\[<span class="keyword">Beta</span>][[i]], coord[[i]]], &#123;i, 1, </span><br><span class="line">      3&#125;], &#123;c, Infinity, 4&#125;]</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(*\partial_t\bar&#123;\gamma_&#123;ij&#125;&#125;*)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Dt</span>\[<span class="keyword">Gamma</span>][i_, j_] := </span><br><span class="line"> <span class="keyword">Series</span>[<span class="number">-2</span> \[Alpha][x, y, z] A[i, j] + </span><br><span class="line">   <span class="keyword">Sum</span>[confmetric[[i, k]] <span class="keyword">D</span>[\[<span class="keyword">Beta</span>][[k]], coord[[j]]], &#123;k, 1, 3&#125;] + </span><br><span class="line">   <span class="keyword">Sum</span>[confmetric[[j, k]] <span class="keyword">D</span>[\[<span class="keyword">Beta</span>][[k]], coord[[i]]], &#123;k, 1, 3&#125;] - </span><br><span class="line">   <span class="number">2</span>/<span class="number">3</span> confmetric[[i, j]] <span class="keyword">Sum</span>[</span><br><span class="line">     <span class="keyword">D</span>[\[<span class="keyword">Beta</span>][[k]], coord[[k]]], &#123;k, 1, 3&#125;], &#123;c, Infinity, 4&#125;]</span><br><span class="line">listgamma := </span><br><span class="line"> <span class="keyword">Table</span>[<span class="keyword">If</span>[<span class="keyword">UnsameQ</span>[<span class="keyword">Dt</span>\[<span class="keyword">Gamma</span>][j, l], </span><br><span class="line">    <span class="number">0</span>], &#123;ToString[paritialtgamma[j, l]], Dt\[Gamma][j, l]&#125;] , &#123;j, 1, </span><br><span class="line">   3&#125;, &#123;l, 1, j&#125;]</span><br><span class="line"><span class="keyword">TableForm</span>[<span class="keyword">Partition</span>[<span class="keyword">DeleteCases</span>[<span class="keyword">Flatten</span>[listgamma], <span class="keyword">Null</span>], <span class="number">2</span>], </span><br><span class="line"> <span class="keyword">TableSpacing</span> -&gt; &#123;2, 2&#125;]</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(*\partial_t K*)</span></span><br><span class="line"></span><br><span class="line">DtK = <span class="keyword">Series</span>[-<span class="keyword">Sum</span>[</span><br><span class="line">     inversemetric[[i, j]] <span class="keyword">D</span>[\[Alpha][x, y, z], coord[[i]], </span><br><span class="line">       coord[[j]]], &#123;i, 1, 3&#125;, &#123;j, 1, 3&#125;] + </span><br><span class="line">   <span class="keyword">Sum</span>[inversemetric[[i, j]] affine[[k, i, j]] <span class="keyword">D</span>[\[Alpha][x, y, z], </span><br><span class="line">      coord[[k]]], &#123;i, 1, 3&#125;, &#123;j, 1, 3&#125;, &#123;k, 1, 3&#125;] + \[Alpha][x, y, </span><br><span class="line">     z] (<span class="keyword">Sum</span>[A[i, j] A[i, j], &#123;i, 1, 3&#125;, &#123;j, 1, 3&#125;] + <span class="number">1</span>/<span class="number">3</span> kk^<span class="number">2</span>) + </span><br><span class="line">   <span class="keyword">Sum</span>[\[<span class="keyword">Beta</span>][[i]] <span class="keyword">D</span>[kk, coord[[i]]], &#123;i, 1, 3&#125;], &#123;c, Infinity, 3&#125;]</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(*\partial_t\bar&#123;A&#125;_&#123;ij&#125;*)</span></span><br><span class="line"></span><br><span class="line">nabla2alpha = </span><br><span class="line">  <span class="number">1</span>/(\[Alpha][x, y, z] \[Psi][x, y, z]^<span class="number">6</span>)</span><br><span class="line">    <span class="keyword">Sum</span>[<span class="keyword">D</span>[\[Alpha][x, y, z] \[Psi][x, y, </span><br><span class="line">       z]^<span class="number">6</span> inversemetric[[k, l]] <span class="keyword">D</span>[\[Alpha][x, y, z], coord[[k]]], </span><br><span class="line">     coord[[l]]], &#123;k, 1, 3&#125;, &#123;l, 1, 3&#125;];</span><br><span class="line"></span><br><span class="line">DtA[i_, j_] := </span><br><span class="line"> <span class="keyword">Series</span>[(<span class="number">1</span> - (G m1)/(<span class="number">2</span> c^<span class="number">2</span> r1) - (G m2)/(</span><br><span class="line">      <span class="number">2</span> c^<span class="number">2</span> r2))^<span class="number">4</span> (-(<span class="keyword">D</span>[<span class="keyword">D</span>[\[Alpha][x, y, z], coord[[i]]], </span><br><span class="line">          coord[[j]]] - </span><br><span class="line">         <span class="keyword">Sum</span>[affine[[k, i, j]] <span class="keyword">D</span>[\[Alpha][x, y, z], coord[[k]]], &#123;k, </span><br><span class="line">           1, 3&#125;] - <span class="number">1</span>/<span class="number">3</span> metric[[i, j]] nabla2alpha ) + \[Alpha][x, y, </span><br><span class="line">        z] (RR[[i, j]] - <span class="number">1</span>/<span class="number">3</span> metric[[i, j]] RRR)) + \[Alpha][x, y, </span><br><span class="line">     z] (kk A[i, j] - <span class="number">2</span> <span class="keyword">Sum</span>[A[i, k] A[j, k], &#123;k, 1, 3&#125;]) + </span><br><span class="line">   <span class="keyword">Sum</span>[\[<span class="keyword">Beta</span>][[k]] <span class="keyword">D</span>[A[i, j], coord[[k]]], &#123;k, 1, 3&#125;] + </span><br><span class="line">   <span class="keyword">Sum</span>[A[i, k] <span class="keyword">D</span>[\[<span class="keyword">Beta</span>][[k]], coord[[j]]], &#123;k, 1, 3&#125;] + </span><br><span class="line">   <span class="keyword">Sum</span>[A[j, k] <span class="keyword">D</span>[\[<span class="keyword">Beta</span>][[k]], coord[[i]]], &#123;k, 1, 3&#125;] - </span><br><span class="line">   <span class="number">2</span>/<span class="number">3</span> A[i, j] <span class="keyword">Sum</span>[<span class="keyword">D</span>[\[<span class="keyword">Beta</span>][[k]], coord[[k]]], &#123;k, 1, 3&#125;], &#123;c, </span><br><span class="line">   Infinity, 3&#125;]</span><br><span class="line">lista := <span class="keyword">Table</span>[</span><br><span class="line">  <span class="keyword">If</span>[<span class="keyword">UnsameQ</span>[DtA[j, l], <span class="number">0</span>], &#123;ToString[partialtA[j, l]], </span><br><span class="line">    DtA[j, l]&#125;] , &#123;j, 1, 3&#125;, &#123;l, 1, j&#125;]</span><br><span class="line">(<span class="keyword">Simplify</span>[</span><br><span class="line">   <span class="keyword">Assuming</span>[</span><br><span class="line">    <span class="keyword">Element</span>[rr1, <span class="keyword">Reals</span>] &amp;&amp; <span class="keyword">Element</span>[rr2, <span class="keyword">Reals</span>] &amp;&amp; rr1 &gt; <span class="number">0</span> &amp;&amp; rr2 &gt; <span class="number">0</span>, </span><br><span class="line">    <span class="keyword">TableForm</span>[<span class="keyword">Partition</span>[<span class="keyword">DeleteCases</span>[<span class="keyword">Flatten</span>[lista], <span class="keyword">Null</span>], <span class="number">2</span>], </span><br><span class="line">       <span class="keyword">TableSpacing</span> -&gt; &#123;2, 2&#125;] /. (x^<span class="number">2</span> + y^<span class="number">2</span> + z^<span class="number">2</span>) -&gt;  </span><br><span class="line">       rr1^<span class="number">2</span> /. (R^<span class="number">2</span> + rr1^<span class="number">2</span> - <span class="number">2</span> R y) -&gt; rr2^<span class="number">2</span>]]) // <span class="keyword">Expand</span></span><br></pre></td></tr></table></figure></p>
<p>Finally we give the result that they vanishes up to 1PN.</p>
<h1>Records on 6/11/2018</h1>
<p>The coordinate transformation is  explicitly
$$
\begin{align}
	t = &amp; \bar{t} + \frac{1}{c^2}f(\bar{t},\bar{x}^j)+\frac{1}{c^4}g(\bar{t},\bar{x}^j)+\mathcal{O}(c^{-6})\
	x^i = &amp; \bar{x}^i +r^i + \frac{1}{c^2}h^i(\bar{t},\bar{x}^j)+\mathcal{O}(c^{-4})
\end{align}
$$
in harmonic gauge, where
$$
\begin{align}
	f = &amp; A(\bar{t})+v_j\bar{x}^j\
	h^j = &amp; H^j(\bar{t})+H^j_k(\bar{t})\bar{x}^k +\frac{1}{2}H^j_{kn}(\bar{t})\bar{x}^k\bar{x}^n\
	g = &amp; \frac{1}{6}\ddot{A}(\bar{t}) \delta_{jk}\bar{x}^j \bar{x}^k + \frac{1}{30}(\delta_{jk}\dot{a}<em>n +\delta</em>{kn}\dot{a}<em>j + \delta</em>{jn}\dot{a}_k)\bar{x}^j\bar{x}^k\bar{x}^n+\gamma(\bar{t},\bar{x}^j),.
\end{align}
$$
Then the square of differentials are
$$
\begin{align}
	-\alpha^2c^2dt^2 = &amp; -c^2\alpha^2\left{ 1+\frac{2}{c^2}\frac{\partial A}{\partial t} + \frac{1}{c^4}\left[ \left( \frac{\partial A}{\partial t} \right)^2 +2\frac{\partial \gamma}{ \partial t} \right] \right}dt^2 \nonumber \
	&amp;-2\alpha^2 \left( \frac{\partial f}{\partial x^j} + \frac{1}{c^2}\frac{\partial g}{\partial x^j} + \frac{1}{c^2} \frac{\partial A}{\partial t} \frac{\partial f}{\partial x^j} \right)dtdx^j \nonumber\
	&amp;- \frac{\alpha^2}{c^2}\frac{\partial f}{\partial x^j}\frac{\partial f}{\partial x^k}dx^jdx^k\nonumber\
	= &amp; -c^2\psi^{-4}\left{ 1+\frac{2}{c^2}\frac{\partial A}{\partial t} + \frac{1}{c^4}\left[ \left( \frac{\partial A}{\partial t} \right)^2 +2\frac{\partial \gamma}{ \partial t} \right] \right}dt^2 \nonumber \
	&amp;-2\psi^{-4} \left( \frac{\partial f}{\partial x^j} + \frac{1}{c^2}\frac{\partial g}{\partial x^j} + \frac{1}{c^2} \frac{\partial A}{\partial t} \frac{\partial f}{\partial x^j} \right)dtdx^j \nonumber\
	&amp;- \frac{1}{c^2}\psi^{-4}\frac{\partial f}{\partial x^j}\frac{\partial f}{\partial x^k}dx^jdx^k
\end{align}
$$</p>
<p>$$
\begin{align}
	\gamma_{ij}dx^idx^j = &amp;\psi^4\delta_{ij}\left[ dx^i + v^idt +\frac{1}{c^2}\frac{\partial h^i}{\partial t} dt + \frac{1}{c^2}\frac{\partial h^i}{\partial x^k}dx^k \right] \nonumber\
	&amp; \times \left[ dx^j + v^idt +\frac{1}{c^2}\frac{\partial h^j}{\partial t} dt + \frac{1}{c^2}\frac{\partial h^j}{\partial x^l}dx^l \right]\nonumber\
	=&amp; \psi^4 \delta_{ij}\left[ dx^idx^j +\frac{2}{c^2} \frac{\partial h^i}{\partial x^k}dx^jdx^k \right]\nonumber\
	 &amp; +  \psi^4\delta_{ij}\left[ 2v^jdtdx^i + \frac{2}{c^2}\frac{\partial h^i}{\partial t} dtdx^j + \frac{2v^j}{c^2}\frac{\partial h^i}{\partial x^k} dx^kdt \right] \nonumber\
	 &amp; + \psi^4 \delta_{ij}\left[ v^iv^j + \frac{2v^j}{c^2}\frac{\partial h^i}{\partial t} \right]dt^2
\end{align}
$$</p>
<p>Summing them up and sortin  g in terms of $dt^2,~dx^i dt,~dx^i dx^j$,  the new metric reads as
$$
\begin{align}
	ds^2 = &amp; -c^2\psi^{-4}\left{ 1+\frac{2}{c^2}\frac{\partial A}{\partial t} + \frac{1}{c^4}\left[ \left( \frac{\partial A}{\partial t} \right)^2 +2\frac{\partial \gamma}{ \partial t} \right] \right}dt^2 -2\psi^{-4} \left( \frac{\partial f}{\partial x^j} + \frac{1}{c^2}\frac{\partial g}{\partial x^j} + \frac{1}{c^2} \frac{\partial A}{\partial t} \frac{\partial f}{\partial x^j} \right)dtdx^j \nonumber\
	&amp;- \frac{1}{c^2}\psi^{-4}\frac{\partial f}{\partial x^j}\frac{\partial f}{\partial x^k}dx^jdx^k + \psi^4 \delta_{ij}\left[ dx^idx^j +\frac{2}{c^2} \frac{\partial h^i}{\partial x^k}dx^jdx^k \right]\nonumber\
	 &amp; +  \psi^4\delta_{ij}\left[ 2v^jdtdx^i + \frac{2}{c^2}\frac{\partial h^i}{\partial t} dtdx^j + \frac{2v^j}{c^2}\frac{\partial h^i}{\partial x^k} dx^kdt \right] + \psi^4 \delta_{ij}\left[ v^iv^j + \frac{2v^j}{c^2}\frac{\partial h^i}{\partial t} \right]dt^2\nonumber\
	 = &amp; -c^2 \left{ \psi^{-4} + \frac{2}{c^2}\psi^{-4} \frac{\partial A}{\partial t} + \psi^4 \frac{ v^2}{c^2} +\frac{1}{c^4} \left[ \left( \frac{\partial A}{\partial t} \right)^2 + 2\frac{\partial \gamma}{\partial t} +2\psi^4 \delta_{ij}v^j \frac{\partial h^i}{\partial t} \right] \right}\nonumber\
	 &amp;-2\left(\psi^{-4}\frac{\partial f}{\partial x^i} - \psi^4 \delta_{ij}v^j\right) dtdx^i -\frac{2}{c^2}\left( \psi^{-4} \frac{\partial g}{\partial x^i}+ \psi^{-4}\frac{\partial A}{\partial t}\frac{\partial  f}{\partial x^i} - \psi^4 \delta_{ij} \frac{\partial h^j}{\partial t}  \right)dtdx^i \nonumber\
&amp;+\frac{2}{c^2}\psi^4\delta_{ij}v^i \frac{\partial h^i}{\partial x^k} dtdx^k\nonumber\
&amp;  +\psi^4 \delta_{ij}dx^idx^j - \frac{1}{c^2}\left(\psi^{-4}\frac{\partial f}{\partial x^i}\frac{\partial f}{\partial x^j}dx^idx^j + 2\psi^4\delta_{ij}\frac{\partial h^i}{\partial x^k } dx^k dx^j  \right)
\end{align}
$$</p>
<h1>Records on</h1>
<h1>Records on 12/11/2018</h1>
<p>To detect GW, I put forword one possibility which is a way to increase the amplitude of the wave. This wave can be GW or EM or neutrino wave.</p>
<p>The method could refer the boosting signal in electronics.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Bing</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bing</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
